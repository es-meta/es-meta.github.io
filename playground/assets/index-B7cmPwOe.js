import{o as qn,b9 as Kn,ba as yr,T as xr,r as C,j as b,g as _e,bb as Pt,u as wr,a1 as Ot,bc as Qn}from"./index-yaGGO9Zf.js";import{d as br,n as Sr,s as Me,a as on,b as Er,c as xt,e as wt,y as vr,p as Qe,z as Jn,i as Nr,t as Cr}from"./zoom-D7LLd22R.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=qn("ChevronsDownUp",[["path",{d:"m7 20 5-5 5 5",key:"13a0gw"}],["path",{d:"m7 4 5 5 5-5",key:"1kwcof"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=qn("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);function oe(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,o;n<e.length;n++)(o=oe(e[n]))!==""&&(t+=(t&&" ")+o);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const Xe=e=>()=>e;function At(e,{sourceEvent:t,subject:n,target:o,identifier:s,active:r,x:i,y:c,dx:l,dy:f,dispatch:g}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:f,enumerable:!0,configurable:!0},_:{value:g}})}At.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function kr(e){return!e.ctrlKey&&!e.button}function Pr(){return this.parentNode}function Ar(e,t){return t??{x:e.x,y:e.y}}function $r(){return navigator.maxTouchPoints||"ontouchstart"in this}function eo(){var e=kr,t=Pr,n=Ar,o=$r,s={},r=br("start","drag","end"),i=0,c,l,f,g,d=0;function a(m){m.on("mousedown.drag",u).filter(o).on("touchstart.drag",x).on("touchmove.drag",w,Sr).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function u(m,E){if(!(g||!e.call(this,m,E))){var N=h(this,t.call(this,m,E),m,E,"mouse");N&&(Me(m.view).on("mousemove.drag",y,on).on("mouseup.drag",p,on),Er(m.view),xt(m),f=!1,c=m.clientX,l=m.clientY,N("start",m))}}function y(m){if(wt(m),!f){var E=m.clientX-c,N=m.clientY-l;f=E*E+N*N>d}s.mouse("drag",m)}function p(m){Me(m.view).on("mousemove.drag mouseup.drag",null),vr(m.view,f),wt(m),s.mouse("end",m)}function x(m,E){if(e.call(this,m,E)){var N=m.changedTouches,S=t.call(this,m,E),M=N.length,k,A;for(k=0;k<M;++k)(A=h(this,S,m,E,N[k].identifier,N[k]))&&(xt(m),A("start",m,N[k]))}}function w(m){var E=m.changedTouches,N=E.length,S,M;for(S=0;S<N;++S)(M=s[E[S].identifier])&&(wt(m),M("drag",m,E[S]))}function v(m){var E=m.changedTouches,N=E.length,S,M;for(g&&clearTimeout(g),g=setTimeout(function(){g=null},500),S=0;S<N;++S)(M=s[E[S].identifier])&&(xt(m),M("end",m,E[S]))}function h(m,E,N,S,M,k){var A=r.copy(),$=Qe(k||N,E),H,_,I;if((I=n.call(m,new At("beforestart",{sourceEvent:N,target:a,identifier:M,active:i,x:$[0],y:$[1],dx:0,dy:0,dispatch:A}),S))!=null)return H=I.x-$[0]||0,_=I.y-$[1]||0,function D(z,P,R){var T=$,O;switch(z){case"start":s[M]=D,O=i++;break;case"end":delete s[M],--i;case"drag":$=Qe(R||P,E),O=i;break}A.call(z,m,new At(z,{sourceEvent:P,subject:I,target:a,identifier:M,active:O,x:$[0]+H,y:$[1]+_,dx:$[0]-T[0],dy:$[1]-T[1],dispatch:A}),S)}}return a.filter=function(m){return arguments.length?(e=typeof m=="function"?m:Xe(!!m),a):e},a.container=function(m){return arguments.length?(t=typeof m=="function"?m:Xe(m),a):t},a.subject=function(m){return arguments.length?(n=typeof m=="function"?m:Xe(m),a):n},a.touchable=function(m){return arguments.length?(o=typeof m=="function"?m:Xe(!!m),a):o},a.on=function(){var m=r.on.apply(r,arguments);return m===r?a:m},a.clickDistance=function(m){return arguments.length?(d=(m=+m)*m,a):Math.sqrt(d)},a}const ce={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:o}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},ze=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],to=["Enter"," ","Escape"];var Ie;(function(e){e.Strict="strict",e.Loose="loose"})(Ie||(Ie={}));var me;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(me||(me={}));var Oe;(function(e){e.Partial="partial",e.Full="full"})(Oe||(Oe={}));const no={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var ge;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(ge||(ge={}));var Je;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Je||(Je={}));var B;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(B||(B={}));const sn={[B.Left]:B.Right,[B.Right]:B.Left,[B.Top]:B.Bottom,[B.Bottom]:B.Top};function oo(e){return e===null?null:e?"valid":"invalid"}const so=e=>"id"in e&&"source"in e&&"target"in e,Dr=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Bt=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Fe=(e,t=[0,0])=>{const{width:n,height:o}=de(e),s=e.origin??t,r=n*s[0],i=o*s[1];return{x:e.position.x-r,y:e.position.y-i}},Hr=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((o,s)=>{const r=typeof s=="string";let i=!t.nodeLookup&&!r?s:void 0;t.nodeLookup&&(i=r?t.nodeLookup.get(s):Bt(s)?s:t.nodeLookup.get(s.id));const c=i?et(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return st(o,c)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return rt(n)},Ze=(e,t={})=>{if(e.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(o=>{if(t.filter===void 0||t.filter(o)){const s=et(o);n=st(n,s)}}),rt(n)},ro=(e,t,[n,o,s]=[0,0,1],r=!1,i=!1)=>{const c={...Ye(t,[n,o,s]),width:t.width/s,height:t.height/s},l=[];for(const f of e.values()){const{measured:g,selectable:d=!0,hidden:a=!1}=f;if(i&&!d||a)continue;const u=g.width??f.width??f.initialWidth??null,y=g.height??f.height??f.initialHeight??null,p=Be(c,Pe(f)),x=(u??0)*(y??0),w=r&&p>0;(!f.internals.handleBounds||w||p>=x||f.dragging)&&l.push(f)}return l},Tr=(e,t)=>{const n=new Set;return e.forEach(o=>{n.add(o.id)}),t.filter(o=>n.has(o.source)||n.has(o.target))};function _r(e,t){const n=new Map,o=t?.nodes?new Set(t.nodes.map(s=>s.id)):null;return e.forEach(s=>{s.measured.width&&s.measured.height&&(t?.includeHiddenNodes||!s.hidden)&&(!o||o.has(s.id))&&n.set(s.id,s)}),n}async function Rr({nodes:e,width:t,height:n,panZoom:o,minZoom:s,maxZoom:r},i){if(e.size===0)return Promise.resolve(!0);const c=_r(e,i),l=Ze(c),f=Vt(l,t,n,i?.minZoom??s,i?.maxZoom??r,i?.padding??.1);return await o.setViewport(f,{duration:i?.duration}),Promise.resolve(!0)}function io({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:s,onError:r}){const i=n.get(e),c=i.parentId?n.get(i.parentId):void 0,{x:l,y:f}=c?c.internals.positionAbsolute:{x:0,y:0},g=i.origin??o;let d=s;if(i.extent==="parent"&&!i.expandParent)if(!c)r?.("005",ce.error005());else{const u=c.measured.width,y=c.measured.height;u&&y&&(d=[[l,f],[l+u,f+y]])}else c&&Ae(i.extent)&&(d=[[i.extent[0][0]+l,i.extent[0][1]+f],[i.extent[1][0]+l,i.extent[1][1]+f]]);const a=Ae(d)?ye(t,d,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&r?.("015",ce.error015()),{position:{x:a.x-l+(i.measured.width??0)*g[0],y:a.y-f+(i.measured.height??0)*g[1]},positionAbsolute:a}}async function jr({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:s}){const r=new Set(e.map(a=>a.id)),i=[];for(const a of n){if(a.deletable===!1)continue;const u=r.has(a.id),y=!u&&a.parentId&&i.find(p=>p.id===a.parentId);(u||y)&&i.push(a)}const c=new Set(t.map(a=>a.id)),l=o.filter(a=>a.deletable!==!1),g=Tr(i,l);for(const a of l)c.has(a.id)&&!g.find(y=>y.id===a.id)&&g.push(a);if(!s)return{edges:g,nodes:i};const d=await s({nodes:i,edges:g});return typeof d=="boolean"?d?{edges:g,nodes:i}:{edges:[],nodes:[]}:d}const ke=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),ye=(e={x:0,y:0},t,n)=>({x:ke(e.x,t[0][0],t[1][0]-(n?.width??0)),y:ke(e.y,t[0][1],t[1][1]-(n?.height??0))});function co(e,t,n){const{width:o,height:s}=de(n),{x:r,y:i}=n.internals.positionAbsolute;return ye(e,[[r,i],[r+o,i+s]],t)}const rn=(e,t,n)=>e<t?ke(Math.abs(e-t),1,t)/t:e>n?-ke(Math.abs(e-n),1,t)/t:0,ao=(e,t,n=15,o=40)=>{const s=rn(e.x,o,t.width-o)*n,r=rn(e.y,o,t.height-o)*n;return[s,r]},st=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),$t=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),rt=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),Pe=(e,t=[0,0])=>{const{x:n,y:o}=Bt(e)?e.internals.positionAbsolute:Fe(e,t);return{x:n,y:o,width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}},et=(e,t=[0,0])=>{const{x:n,y:o}=Bt(e)?e.internals.positionAbsolute:Fe(e,t);return{x:n,y:o,x2:n+(e.measured?.width??e.width??e.initialWidth??0),y2:o+(e.measured?.height??e.height??e.initialHeight??0)}},lo=(e,t)=>rt(st($t(e),$t(t))),Be=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},cn=e=>ie(e.width)&&ie(e.height)&&ie(e.x)&&ie(e.y),ie=e=>!isNaN(e)&&isFinite(e),zr=(e,t)=>{},it=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Ye=({x:e,y:t},[n,o,s],r=!1,i=[1,1])=>{const c={x:(e-n)/s,y:(t-o)/s};return r?it(c,i):c},tt=({x:e,y:t},[n,o,s])=>({x:e*s+n,y:t*s+o});function Se(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Or(e,t,n){if(typeof e=="string"||typeof e=="number"){const o=Se(e,n),s=Se(e,t);return{top:o,right:s,bottom:o,left:s,x:s*2,y:o*2}}if(typeof e=="object"){const o=Se(e.top??e.y??0,n),s=Se(e.bottom??e.y??0,n),r=Se(e.left??e.x??0,t),i=Se(e.right??e.x??0,t);return{top:o,right:i,bottom:s,left:r,x:r+i,y:o+s}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Br(e,t,n,o,s,r){const{x:i,y:c}=tt(e,[t,n,o]),{x:l,y:f}=tt({x:e.x+e.width,y:e.y+e.height},[t,n,o]),g=s-l,d=r-f;return{left:Math.floor(i),top:Math.floor(c),right:Math.floor(g),bottom:Math.floor(d)}}const Vt=(e,t,n,o,s,r)=>{const i=Or(r,t,n),c=(t-i.x)/e.width,l=(n-i.y)/e.height,f=Math.min(c,l),g=ke(f,o,s),d=e.x+e.width/2,a=e.y+e.height/2,u=t/2-d*g,y=n/2-a*g,p=Br(e,u,y,g,t,n),x={left:Math.min(p.left-i.left,0),top:Math.min(p.top-i.top,0),right:Math.min(p.right-i.right,0),bottom:Math.min(p.bottom-i.bottom,0)};return{x:u-x.left+x.right,y:y-x.top+x.bottom,zoom:g}},nt=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function Ae(e){return e!==void 0&&e!=="parent"}function de(e){return{width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}}function uo(e){return(e.measured?.width??e.width??e.initialWidth)!==void 0&&(e.measured?.height??e.height??e.initialHeight)!==void 0}function fo(e,t={width:0,height:0},n,o,s){const r={...e},i=o.get(n);if(i){const c=i.origin||s;r.x+=i.internals.positionAbsolute.x-(t.width??0)*c[0],r.y+=i.internals.positionAbsolute.y-(t.height??0)*c[1]}return r}function an(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Vr(){let e,t;return{promise:new Promise((o,s)=>{e=o,t=s}),resolve:e,reject:t}}function Re(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:s}){const{x:r,y:i}=ae(e),c=Ye({x:r-(s?.left??0),y:i-(s?.top??0)},o),{x:l,y:f}=n?it(c,t):c;return{xSnapped:l,ySnapped:f,...c}}const Lt=e=>({width:e.offsetWidth,height:e.offsetHeight}),go=e=>e?.getRootNode?.()||window?.document,Lr=["INPUT","SELECT","TEXTAREA"];function ho(e){const t=e.composedPath?.()?.[0]||e.target;return t?.nodeType!==1?!1:Lr.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const po=e=>"clientX"in e,ae=(e,t)=>{const n=po(e),o=n?e.clientX:e.touches?.[0].clientX,s=n?e.clientY:e.touches?.[0].clientY;return{x:o-(t?.left??0),y:s-(t?.top??0)}},ln=(e,t,n,o,s)=>{const r=t.querySelectorAll(`.${e}`);return!r||!r.length?null:Array.from(r).map(i=>{const c=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:s,position:i.getAttribute("data-handlepos"),x:(c.left-n.left)/o,y:(c.top-n.top)/o,...Lt(i)}})};function mo({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:s,sourceControlY:r,targetControlX:i,targetControlY:c}){const l=e*.125+s*.375+i*.375+n*.125,f=t*.125+r*.375+c*.375+o*.125,g=Math.abs(l-e),d=Math.abs(f-t);return[l,f,g,d]}function Ge(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function dn({pos:e,x1:t,y1:n,x2:o,y2:s,c:r}){switch(e){case B.Left:return[t-Ge(t-o,r),n];case B.Right:return[t+Ge(o-t,r),n];case B.Top:return[t,n-Ge(n-s,r)];case B.Bottom:return[t,n+Ge(s-n,r)]}}function yo({sourceX:e,sourceY:t,sourcePosition:n=B.Bottom,targetX:o,targetY:s,targetPosition:r=B.Top,curvature:i=.25}){const[c,l]=dn({pos:n,x1:e,y1:t,x2:o,y2:s,c:i}),[f,g]=dn({pos:r,x1:o,y1:s,x2:e,y2:t,c:i}),[d,a,u,y]=mo({sourceX:e,sourceY:t,targetX:o,targetY:s,sourceControlX:c,sourceControlY:l,targetControlX:f,targetControlY:g});return[`M${e},${t} C${c},${l} ${f},${g} ${o},${s}`,d,a,u,y]}function xo({sourceX:e,sourceY:t,targetX:n,targetY:o}){const s=Math.abs(n-e)/2,r=n<e?n+s:n-s,i=Math.abs(o-t)/2,c=o<t?o+i:o-i;return[r,c,s,i]}function Fr({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o=0,elevateOnSelect:s=!1}){if(!s)return o;const r=n||t.selected||e.selected,i=Math.max(e.internals.z||0,t.internals.z||0,1e3);return o+(r?i:0)}function Zr({sourceNode:e,targetNode:t,width:n,height:o,transform:s}){const r=st(et(e),et(t));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const i={x:-s[0]/s[2],y:-s[1]/s[2],width:n/s[2],height:o/s[2]};return Be(i,rt(r))>0}const Yr=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,Wr=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Xr=(e,t)=>{if(!e.source||!e.target)return t;let n;return so(e)?n={...e}:n={...e,id:Yr(e)},Wr(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function wo({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[s,r,i,c]=xo({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,s,r,i,c]}const un={[B.Left]:{x:-1,y:0},[B.Right]:{x:1,y:0},[B.Top]:{x:0,y:-1},[B.Bottom]:{x:0,y:1}},Gr=({source:e,sourcePosition:t=B.Bottom,target:n})=>t===B.Left||t===B.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},fn=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Ur({source:e,sourcePosition:t=B.Bottom,target:n,targetPosition:o=B.Top,center:s,offset:r}){const i=un[t],c=un[o],l={x:e.x+i.x*r,y:e.y+i.y*r},f={x:n.x+c.x*r,y:n.y+c.y*r},g=Gr({source:l,sourcePosition:t,target:f}),d=g.x!==0?"x":"y",a=g[d];let u=[],y,p;const x={x:0,y:0},w={x:0,y:0},[v,h,m,E]=xo({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(i[d]*c[d]===-1){y=s.x??v,p=s.y??h;const S=[{x:y,y:l.y},{x:y,y:f.y}],M=[{x:l.x,y:p},{x:f.x,y:p}];i[d]===a?u=d==="x"?S:M:u=d==="x"?M:S}else{const S=[{x:l.x,y:f.y}],M=[{x:f.x,y:l.y}];if(d==="x"?u=i.x===a?M:S:u=i.y===a?S:M,t===o){const _=Math.abs(e[d]-n[d]);if(_<=r){const I=Math.min(r-1,r-_);i[d]===a?x[d]=(l[d]>e[d]?-1:1)*I:w[d]=(f[d]>n[d]?-1:1)*I}}if(t!==o){const _=d==="x"?"y":"x",I=i[d]===c[_],D=l[_]>f[_],z=l[_]<f[_];(i[d]===1&&(!I&&D||I&&z)||i[d]!==1&&(!I&&z||I&&D))&&(u=d==="x"?S:M)}const k={x:l.x+x.x,y:l.y+x.y},A={x:f.x+w.x,y:f.y+w.y},$=Math.max(Math.abs(k.x-u[0].x),Math.abs(A.x-u[0].x)),H=Math.max(Math.abs(k.y-u[0].y),Math.abs(A.y-u[0].y));$>=H?(y=(k.x+A.x)/2,p=u[0].y):(y=u[0].x,p=(k.y+A.y)/2)}return[[e,{x:l.x+x.x,y:l.y+x.y},...u,{x:f.x+w.x,y:f.y+w.y},n],y,p,m,E]}function qr(e,t,n,o){const s=Math.min(fn(e,t)/2,fn(t,n)/2,o),{x:r,y:i}=t;if(e.x===r&&r===n.x||e.y===i&&i===n.y)return`L${r} ${i}`;if(e.y===i){const f=e.x<n.x?-1:1,g=e.y<n.y?1:-1;return`L ${r+s*f},${i}Q ${r},${i} ${r},${i+s*g}`}const c=e.x<n.x?1:-1,l=e.y<n.y?-1:1;return`L ${r},${i+s*l}Q ${r},${i} ${r+s*c},${i}`}function Dt({sourceX:e,sourceY:t,sourcePosition:n=B.Bottom,targetX:o,targetY:s,targetPosition:r=B.Top,borderRadius:i=5,centerX:c,centerY:l,offset:f=20}){const[g,d,a,u,y]=Ur({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:s},targetPosition:r,center:{x:c,y:l},offset:f});return[g.reduce((x,w,v)=>{let h="";return v>0&&v<g.length-1?h=qr(g[v-1],w,g[v+1],i):h=`${v===0?"M":"L"}${w.x} ${w.y}`,x+=h,x},""),d,a,u,y]}function gn(e){return e&&!!(e.internals.handleBounds||e.handles?.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Kr(e){const{sourceNode:t,targetNode:n}=e;if(!gn(t)||!gn(n))return null;const o=t.internals.handleBounds||hn(t.handles),s=n.internals.handleBounds||hn(n.handles),r=pn(o?.source??[],e.sourceHandle),i=pn(e.connectionMode===Ie.Strict?s?.target??[]:(s?.target??[]).concat(s?.source??[]),e.targetHandle);if(!r||!i)return e.onError?.("008",ce.error008(r?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const c=r?.position||B.Bottom,l=i?.position||B.Top,f=Ve(t,r,c),g=Ve(n,i,l);return{sourceX:f.x,sourceY:f.y,targetX:g.x,targetY:g.y,sourcePosition:c,targetPosition:l}}function hn(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,o.type==="source"?t.push(o):o.type==="target"&&n.push(o);return{source:t,target:n}}function Ve(e,t,n=B.Left,o=!1){const s=(t?.x??0)+e.internals.positionAbsolute.x,r=(t?.y??0)+e.internals.positionAbsolute.y,{width:i,height:c}=t??de(e);if(o)return{x:s+i/2,y:r+c/2};switch(t?.position??n){case B.Top:return{x:s+i/2,y:r};case B.Right:return{x:s+i,y:r+c/2};case B.Bottom:return{x:s+i/2,y:r+c};case B.Left:return{x:s,y:r+c/2}}}function pn(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Ht(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(o=>`${o}=${e[o]}`).join("&")}`:""}function Qr(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:s}){const r=new Set;return e.reduce((i,c)=>([c.markerStart||o,c.markerEnd||s].forEach(l=>{if(l&&typeof l=="object"){const f=Ht(l,t);r.has(f)||(i.push({id:f,color:l.color||n,...l}),r.add(f))}}),i),[]).sort((i,c)=>i.id.localeCompare(c.id))}const Ft={nodeOrigin:[0,0],nodeExtent:ze,elevateNodesOnSelect:!0,defaults:{}},Jr={...Ft,checkEquality:!0};function Zt(e,t){const n={...e};for(const o in t)t[o]!==void 0&&(n[o]=t[o]);return n}function ei(e,t,n){const o=Zt(Ft,n);for(const s of e.values())if(s.parentId)Yt(s,e,t,o);else{const r=Fe(s,o.nodeOrigin),i=Ae(s.extent)?s.extent:o.nodeExtent,c=ye(r,i,de(s));s.internals.positionAbsolute=c}}function Tt(e,t,n,o){const s=Zt(Jr,o);let r=e.length>0;const i=new Map(t),c=s?.elevateNodesOnSelect?1e3:0;t.clear(),n.clear();for(const l of e){let f=i.get(l.id);if(s.checkEquality&&l===f?.internals.userNode)t.set(l.id,f);else{const g=Fe(l,s.nodeOrigin),d=Ae(l.extent)?l.extent:s.nodeExtent,a=ye(g,d,de(l));f={...s.defaults,...l,measured:{width:l.measured?.width,height:l.measured?.height},internals:{positionAbsolute:a,handleBounds:l.measured?f?.internals.handleBounds:void 0,z:bo(l,c),userNode:l}},t.set(l.id,f)}(f.measured===void 0||f.measured.width===void 0||f.measured.height===void 0)&&!f.hidden&&(r=!1),l.parentId&&Yt(f,t,n,o)}return r}function ti(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Yt(e,t,n,o){const{elevateNodesOnSelect:s,nodeOrigin:r,nodeExtent:i}=Zt(Ft,o),c=e.parentId,l=t.get(c);if(!l){console.warn(`Parent node ${c} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}ti(e,n);const f=s?1e3:0,{x:g,y:d,z:a}=ni(e,l,r,i,f),{positionAbsolute:u}=e.internals,y=g!==u.x||d!==u.y;(y||a!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:y?{x:g,y:d}:u,z:a}})}function bo(e,t){return(ie(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function ni(e,t,n,o,s){const{x:r,y:i}=t.internals.positionAbsolute,c=de(e),l=Fe(e,n),f=Ae(e.extent)?ye(l,e.extent,c):l;let g=ye({x:r+f.x,y:i+f.y},o,c);e.extent==="parent"&&(g=co(g,c,t));const d=bo(e,s),a=t.internals.z??0;return{x:g.x,y:g.y,z:a>d?a:d}}function Wt(e,t,n,o=[0,0]){const s=[],r=new Map;for(const i of e){const c=t.get(i.parentId);if(!c)continue;const l=r.get(i.parentId)?.expandedRect??Pe(c),f=lo(l,i.rect);r.set(i.parentId,{expandedRect:f,parent:c})}return r.size>0&&r.forEach(({expandedRect:i,parent:c},l)=>{const f=c.internals.positionAbsolute,g=de(c),d=c.origin??o,a=i.x<f.x?Math.round(Math.abs(f.x-i.x)):0,u=i.y<f.y?Math.round(Math.abs(f.y-i.y)):0,y=Math.max(g.width,Math.round(i.width)),p=Math.max(g.height,Math.round(i.height)),x=(y-g.width)*d[0],w=(p-g.height)*d[1];(a>0||u>0||x||w)&&(s.push({id:l,type:"position",position:{x:c.position.x-a+x,y:c.position.y-u+w}}),n.get(l)?.forEach(v=>{e.some(h=>h.id===v.id)||s.push({id:v.id,type:"position",position:{x:v.position.x+a,y:v.position.y+u}})})),(g.width<i.width||g.height<i.height||a||u)&&s.push({id:l,type:"dimensions",setAttributes:!0,dimensions:{width:y+(a?d[0]*a-x:0),height:p+(u?d[1]*u-w:0)}})}),s}function oi(e,t,n,o,s,r){const i=o?.querySelector(".xyflow__viewport");let c=!1;if(!i)return{changes:[],updatedInternals:c};const l=[],f=window.getComputedStyle(i),{m22:g}=new window.DOMMatrixReadOnly(f.transform),d=[];for(const a of e.values()){const u=t.get(a.id);if(!u)continue;if(u.hidden){t.set(u.id,{...u,internals:{...u.internals,handleBounds:void 0}}),c=!0;continue}const y=Lt(a.nodeElement),p=u.measured.width!==y.width||u.measured.height!==y.height;if(!!(y.width&&y.height&&(p||!u.internals.handleBounds||a.force))){const w=a.nodeElement.getBoundingClientRect(),v=Ae(u.extent)?u.extent:r;let{positionAbsolute:h}=u.internals;u.parentId&&u.extent==="parent"?h=co(h,y,t.get(u.parentId)):v&&(h=ye(h,v,y));const m={...u,measured:y,internals:{...u.internals,positionAbsolute:h,handleBounds:{source:ln("source",a.nodeElement,w,g,u.id),target:ln("target",a.nodeElement,w,g,u.id)}}};t.set(u.id,m),u.parentId&&Yt(m,t,n,{nodeOrigin:s}),c=!0,p&&(l.push({id:u.id,type:"dimensions",dimensions:y}),u.expandParent&&u.parentId&&d.push({id:u.id,parentId:u.parentId,rect:Pe(m,s)}))}}if(d.length>0){const a=Wt(d,t,n,s);l.push(...a)}return{changes:l,updatedInternals:c}}async function si({delta:e,panZoom:t,transform:n,translateExtent:o,width:s,height:r}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[s,r]],o),c=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(c)}function mn(e,t,n,o,s,r){let i=s;const c=o.get(i)||new Map;o.set(i,c.set(n,t)),i=`${s}-${e}`;const l=o.get(i)||new Map;if(o.set(i,l.set(n,t)),r){i=`${s}-${e}-${r}`;const f=o.get(i)||new Map;o.set(i,f.set(n,t))}}function So(e,t,n){e.clear(),t.clear();for(const o of n){const{source:s,target:r,sourceHandle:i=null,targetHandle:c=null}=o,l={edgeId:o.id,source:s,target:r,sourceHandle:i,targetHandle:c},f=`${s}-${i}--${r}-${c}`,g=`${r}-${c}--${s}-${i}`;mn("source",l,g,e,s,i),mn("target",l,f,e,r,c),t.set(o.id,o)}}function Eo(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:Eo(n,t):!1}function yn(e,t,n){let o=e;do{if(o?.matches?.(t))return!0;if(o===n)return!1;o=o?.parentElement}while(o);return!1}function ri(e,t,n,o){const s=new Map;for(const[r,i]of e)if((i.selected||i.id===o)&&(!i.parentId||!Eo(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const c=e.get(r);c&&s.set(r,{id:r,position:c.position||{x:0,y:0},distance:{x:n.x-c.internals.positionAbsolute.x,y:n.y-c.internals.positionAbsolute.y},extent:c.extent,parentId:c.parentId,origin:c.origin,expandParent:c.expandParent,internals:{positionAbsolute:c.internals.positionAbsolute||{x:0,y:0}},measured:{width:c.measured.width??0,height:c.measured.height??0}})}return s}function bt({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){const s=[];for(const[i,c]of t){const l=n.get(i)?.internals.userNode;l&&s.push({...l,position:c.position,dragging:o})}if(!e)return[s[0],s];const r=n.get(e)?.internals.userNode;return[r?{...r,position:t.get(e)?.position||r.position,dragging:o}:s[0],s]}function ii({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:o,onDragStop:s}){let r={x:null,y:null},i=0,c=new Map,l=!1,f={x:0,y:0},g=null,d=!1,a=null,u=!1;function y({noDragClassName:x,handleSelector:w,domNode:v,isSelectable:h,nodeId:m,nodeClickDistance:E=0}){a=Me(v);function N({x:A,y:$},H){const{nodeLookup:_,nodeExtent:I,snapGrid:D,snapToGrid:z,nodeOrigin:P,onNodeDrag:R,onSelectionDrag:T,onError:O,updateNodePositions:j}=t();r={x:A,y:$};let L=!1,Z={x:0,y:0,x2:0,y2:0};if(c.size>1&&I){const U=Ze(c);Z=$t(U)}for(const[U,X]of c){if(!_.has(U))continue;let Y={x:A-X.distance.x,y:$-X.distance.y};z&&(Y=it(Y,D));let V=[[I[0][0],I[0][1]],[I[1][0],I[1][1]]];if(c.size>1&&I&&!X.extent){const{positionAbsolute:Q}=X.internals,K=Q.x-Z.x+I[0][0],F=Q.x+X.measured.width-Z.x2+I[1][0],ne=Q.y-Z.y+I[0][1],J=Q.y+X.measured.height-Z.y2+I[1][1];V=[[K,ne],[F,J]]}const{position:W,positionAbsolute:G}=io({nodeId:U,nextPosition:Y,nodeLookup:_,nodeExtent:V,nodeOrigin:P,onError:O});L=L||X.position.x!==W.x||X.position.y!==W.y,X.position=W,X.internals.positionAbsolute=G}if(L&&(j(c,!0),H&&(o||R||!m&&T))){const[U,X]=bt({nodeId:m,dragItems:c,nodeLookup:_});o?.(H,c,U,X),R?.(H,U,X),m||T?.(H,X)}}async function S(){if(!g)return;const{transform:A,panBy:$,autoPanSpeed:H,autoPanOnNodeDrag:_}=t();if(!_){l=!1,cancelAnimationFrame(i);return}const[I,D]=ao(f,g,H);(I!==0||D!==0)&&(r.x=(r.x??0)-I/A[2],r.y=(r.y??0)-D/A[2],await $({x:I,y:D})&&N(r,null)),i=requestAnimationFrame(S)}function M(A){const{nodeLookup:$,multiSelectionActive:H,nodesDraggable:_,transform:I,snapGrid:D,snapToGrid:z,selectNodesOnDrag:P,onNodeDragStart:R,onSelectionDragStart:T,unselectNodesAndEdges:O}=t();d=!0,(!P||!h)&&!H&&m&&($.get(m)?.selected||O()),h&&P&&m&&e?.(m);const j=Re(A.sourceEvent,{transform:I,snapGrid:D,snapToGrid:z,containerBounds:g});if(r=j,c=ri($,_,j,m),c.size>0&&(n||R||!m&&T)){const[L,Z]=bt({nodeId:m,dragItems:c,nodeLookup:$});n?.(A.sourceEvent,c,L,Z),R?.(A.sourceEvent,L,Z),m||T?.(A.sourceEvent,Z)}}const k=eo().clickDistance(E).on("start",A=>{const{domNode:$,nodeDragThreshold:H,transform:_,snapGrid:I,snapToGrid:D}=t();g=$?.getBoundingClientRect()||null,u=!1,H===0&&M(A),r=Re(A.sourceEvent,{transform:_,snapGrid:I,snapToGrid:D,containerBounds:g}),f=ae(A.sourceEvent,g)}).on("drag",A=>{const{autoPanOnNodeDrag:$,transform:H,snapGrid:_,snapToGrid:I,nodeDragThreshold:D,nodeLookup:z}=t(),P=Re(A.sourceEvent,{transform:H,snapGrid:_,snapToGrid:I,containerBounds:g});if((A.sourceEvent.type==="touchmove"&&A.sourceEvent.touches.length>1||m&&!z.has(m))&&(u=!0),!u){if(!l&&$&&d&&(l=!0,S()),!d){const R=P.xSnapped-(r.x??0),T=P.ySnapped-(r.y??0);Math.sqrt(R*R+T*T)>D&&M(A)}(r.x!==P.xSnapped||r.y!==P.ySnapped)&&c&&d&&(f=ae(A.sourceEvent,g),N(P,A.sourceEvent))}}).on("end",A=>{if(!(!d||u)&&(l=!1,d=!1,cancelAnimationFrame(i),c.size>0)){const{nodeLookup:$,updateNodePositions:H,onNodeDragStop:_,onSelectionDragStop:I}=t();if(H(c,!1),s||_||!m&&I){const[D,z]=bt({nodeId:m,dragItems:c,nodeLookup:$,dragging:!1});s?.(A.sourceEvent,c,D,z),_?.(A.sourceEvent,D,z),m||I?.(A.sourceEvent,z)}}}).filter(A=>{const $=A.target;return!A.button&&(!x||!yn($,`.${x}`,v))&&(!w||yn($,w,v))});a.call(k)}function p(){a?.on(".drag",null)}return{update:y,destroy:p}}function ci(e,t,n){const o=[],s={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const r of t.values())Be(s,Pe(r))>0&&o.push(r);return o}const ai=250;function li(e,t,n,o){let s=[],r=1/0;const i=ci(e,n,t+ai);for(const c of i){const l=[...c.internals.handleBounds?.source??[],...c.internals.handleBounds?.target??[]];for(const f of l){if(o.nodeId===f.nodeId&&o.type===f.type&&o.id===f.id)continue;const{x:g,y:d}=Ve(c,f,f.position,!0),a=Math.sqrt(Math.pow(g-e.x,2)+Math.pow(d-e.y,2));a>t||(a<r?(s=[{...f,x:g,y:d}],r=a):a===r&&s.push({...f,x:g,y:d}))}}if(!s.length)return null;if(s.length>1){const c=o.type==="source"?"target":"source";return s.find(l=>l.type===c)??s[0]}return s[0]}function vo(e,t,n,o,s,r=!1){const i=o.get(e);if(!i)return null;const c=s==="strict"?i.internals.handleBounds?.[t]:[...i.internals.handleBounds?.source??[],...i.internals.handleBounds?.target??[]],l=(n?c?.find(f=>f.id===n):c?.[0])??null;return l&&r?{...l,...Ve(i,l,l.position,!0)}:l}function No(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function di(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const Co=()=>!0;function ui(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:s,edgeUpdaterType:r,isTarget:i,domNode:c,nodeLookup:l,lib:f,autoPanOnConnect:g,flowId:d,panBy:a,cancelConnection:u,onConnectStart:y,onConnect:p,onConnectEnd:x,isValidConnection:w=Co,onReconnectEnd:v,updateConnection:h,getTransform:m,getFromHandle:E,autoPanSpeed:N}){const S=go(e.target);let M=0,k;const{x:A,y:$}=ae(e),H=S?.elementFromPoint(A,$),_=No(r,H),I=c?.getBoundingClientRect();if(!I||!_)return;const D=vo(s,_,o,l,t);if(!D)return;let z=ae(e,I),P=!1,R=null,T=!1,O=null;function j(){if(!g||!I)return;const[G,Q]=ao(z,I,N);a({x:G,y:Q}),M=requestAnimationFrame(j)}const L={...D,nodeId:s,type:_,position:D.position},Z=l.get(s),X={inProgress:!0,isValid:null,from:Ve(Z,L,B.Left,!0),fromHandle:L,fromPosition:L.position,fromNode:Z,to:z,toHandle:null,toPosition:sn[L.position],toNode:null};h(X);let Y=X;y?.(e,{nodeId:s,handleId:o,handleType:_});function V(G){if(!E()||!L){W(G);return}const Q=m();z=ae(G,I),k=li(Ye(z,Q,!1,[1,1]),n,l,L),P||(j(),P=!0);const K=Mo(G,{handle:k,connectionMode:t,fromNodeId:s,fromHandleId:o,fromType:i?"target":"source",isValidConnection:w,doc:S,lib:f,flowId:d,nodeLookup:l});O=K.handleDomNode,R=K.connection,T=di(!!k,K.isValid);const F={...Y,isValid:T,to:K.toHandle&&T?tt({x:K.toHandle.x,y:K.toHandle.y},Q):z,toHandle:K.toHandle,toPosition:T&&K.toHandle?K.toHandle.position:sn[L.position],toNode:K.toHandle?l.get(K.toHandle.nodeId):null};T&&k&&Y.toHandle&&F.toHandle&&Y.toHandle.type===F.toHandle.type&&Y.toHandle.nodeId===F.toHandle.nodeId&&Y.toHandle.id===F.toHandle.id&&Y.to.x===F.to.x&&Y.to.y===F.to.y||(h(F),Y=F)}function W(G){(k||O)&&R&&T&&p?.(R);const{inProgress:Q,...K}=Y,F={...K,toPosition:Y.toHandle?Y.toPosition:null};x?.(G,F),r&&v?.(G,F),u(),cancelAnimationFrame(M),P=!1,T=!1,R=null,O=null,S.removeEventListener("mousemove",V),S.removeEventListener("mouseup",W),S.removeEventListener("touchmove",V),S.removeEventListener("touchend",W)}S.addEventListener("mousemove",V),S.addEventListener("mouseup",W),S.addEventListener("touchmove",V),S.addEventListener("touchend",W)}function Mo(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:s,fromType:r,doc:i,lib:c,flowId:l,isValidConnection:f=Co,nodeLookup:g}){const d=r==="target",a=t?i.querySelector(`.${c}-flow__handle[data-id="${l}-${t?.nodeId}-${t?.id}-${t?.type}"]`):null,{x:u,y}=ae(e),p=i.elementFromPoint(u,y),x=p?.classList.contains(`${c}-flow__handle`)?p:a,w={handleDomNode:x,isValid:!1,connection:null,toHandle:null};if(x){const v=No(void 0,x),h=x.getAttribute("data-nodeid"),m=x.getAttribute("data-handleid"),E=x.classList.contains("connectable"),N=x.classList.contains("connectableend");if(!h||!v)return w;const S={source:d?h:o,sourceHandle:d?m:s,target:d?o:h,targetHandle:d?s:m};w.connection=S;const k=E&&N&&(n===Ie.Strict?d&&v==="source"||!d&&v==="target":h!==o||m!==s);w.isValid=k&&f(S),w.toHandle=vo(h,v,m,g,n,!0)}return w}const _t={onPointerDown:ui,isValid:Mo};function fi({domNode:e,panZoom:t,getTransform:n,getViewScale:o}){const s=Me(e);function r({translateExtent:c,width:l,height:f,zoomStep:g=10,pannable:d=!0,zoomable:a=!0,inversePan:u=!1}){const y=h=>{const m=n();if(h.sourceEvent.type!=="wheel"||!t)return;const E=-h.sourceEvent.deltaY*(h.sourceEvent.deltaMode===1?.05:h.sourceEvent.deltaMode?1:.002)*g,N=m[2]*Math.pow(2,E);t.scaleTo(N)};let p=[0,0];const x=h=>{(h.sourceEvent.type==="mousedown"||h.sourceEvent.type==="touchstart")&&(p=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY])},w=h=>{const m=n();if(h.sourceEvent.type!=="mousemove"&&h.sourceEvent.type!=="touchmove"||!t)return;const E=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY],N=[E[0]-p[0],E[1]-p[1]];p=E;const S=o()*Math.max(m[2],Math.log(m[2]))*(u?-1:1),M={x:m[0]-N[0]*S,y:m[1]-N[1]*S},k=[[0,0],[l,f]];t.setViewportConstrained({x:M.x,y:M.y,zoom:m[2]},k,c)},v=Jn().on("start",x).on("zoom",d?w:null).on("zoom.wheel",a?y:null);s.call(v,{})}function i(){s.on("zoom",null)}return{update:r,destroy:i,pointer:Qe}}const gi=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,ct=e=>({x:e.x,y:e.y,zoom:e.k}),St=({x:e,y:t,zoom:n})=>Nr.translate(e,t).scale(n),Ne=(e,t)=>e.target.closest(`.${t}`),Io=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Et=(e,t=0,n=()=>{})=>{const o=typeof t=="number"&&t>0;return o||n(),o?e.transition().duration(t).on("end",n):e},ko=e=>{const t=e.ctrlKey&&nt()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function hi({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:o,panOnScrollMode:s,panOnScrollSpeed:r,zoomOnPinch:i,onPanZoomStart:c,onPanZoom:l,onPanZoomEnd:f}){return g=>{if(Ne(g,t))return!1;g.preventDefault(),g.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(g.ctrlKey&&i){const x=Qe(g),w=ko(g),v=d*Math.pow(2,w);o.scaleTo(n,v,x,g);return}const a=g.deltaMode===1?20:1;let u=s===me.Vertical?0:g.deltaX*a,y=s===me.Horizontal?0:g.deltaY*a;!nt()&&g.shiftKey&&s!==me.Vertical&&(u=g.deltaY*a,y=0),o.translateBy(n,-(u/d)*r,-(y/d)*r,{internal:!0});const p=ct(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,c?.(g,p)),e.isPanScrolling&&(l?.(g,p),e.panScrollTimeout=setTimeout(()=>{f?.(g,p),e.isPanScrolling=!1},150))}}function pi({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,s){const r=o.type==="wheel",i=!t&&r&&!o.ctrlKey,c=Ne(o,e);if(o.ctrlKey&&r&&c&&o.preventDefault(),i||c)return null;o.preventDefault(),n.call(this,o,s)}}function mi({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{if(o.sourceEvent?.internal)return;const s=ct(o.transform);e.mouseButton=o.sourceEvent?.button||0,e.isZoomingOrPanning=!0,e.prevViewport=s,o.sourceEvent?.type==="mousedown"&&t(!0),n&&n?.(o.sourceEvent,s)}}function yi({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:s}){return r=>{e.usedRightMouseButton=!!(n&&Io(t,e.mouseButton??0)),r.sourceEvent?.sync||o([r.transform.x,r.transform.y,r.transform.k]),s&&!r.sourceEvent?.internal&&s?.(r.sourceEvent,ct(r.transform))}}function xi({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:s,onPaneContextMenu:r}){return i=>{if(!i.sourceEvent?.internal&&(e.isZoomingOrPanning=!1,r&&Io(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&r(i.sourceEvent),e.usedRightMouseButton=!1,o(!1),s&&gi(e.prevViewport,i.transform))){const c=ct(i.transform);e.prevViewport=c,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{s?.(i.sourceEvent,c)},n?150:0)}}}function wi({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:s,zoomOnDoubleClick:r,userSelectionActive:i,noWheelClassName:c,noPanClassName:l,lib:f}){return g=>{const d=e||t,a=n&&g.ctrlKey;if(g.button===1&&g.type==="mousedown"&&(Ne(g,`${f}-flow__node`)||Ne(g,`${f}-flow__edge`)))return!0;if(!o&&!d&&!s&&!r&&!n||i||Ne(g,c)&&g.type==="wheel"||Ne(g,l)&&(g.type!=="wheel"||s&&g.type==="wheel"&&!e)||!n&&g.ctrlKey&&g.type==="wheel")return!1;if(!n&&g.type==="touchstart"&&g.touches?.length>1)return g.preventDefault(),!1;if(!d&&!s&&!a&&g.type==="wheel"||!o&&(g.type==="mousedown"||g.type==="touchstart")||Array.isArray(o)&&!o.includes(g.button)&&g.type==="mousedown")return!1;const u=Array.isArray(o)&&o.includes(g.button)||!g.button||g.button<=1;return(!g.ctrlKey||g.type==="wheel")&&u}}function bi({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:o,translateExtent:s,viewport:r,onPanZoom:i,onPanZoomStart:c,onPanZoomEnd:l,onDraggingChange:f}){const g={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),a=Jn().clickDistance(!ie(o)||o<0?0:o).scaleExtent([t,n]).translateExtent(s),u=Me(e).call(a);h({x:r.x,y:r.y,zoom:ke(r.zoom,t,n)},[[0,0],[d.width,d.height]],s);const y=u.on("wheel.zoom"),p=u.on("dblclick.zoom");a.wheelDelta(ko);function x(H,_){return u?new Promise(I=>{a?.transform(Et(u,_?.duration,()=>I(!0)),H)}):Promise.resolve(!1)}function w({noWheelClassName:H,noPanClassName:_,onPaneContextMenu:I,userSelectionActive:D,panOnScroll:z,panOnDrag:P,panOnScrollMode:R,panOnScrollSpeed:T,preventScrolling:O,zoomOnPinch:j,zoomOnScroll:L,zoomOnDoubleClick:Z,zoomActivationKeyPressed:U,lib:X,onTransformChange:Y}){D&&!g.isZoomingOrPanning&&v();const W=z&&!U&&!D?hi({zoomPanValues:g,noWheelClassName:H,d3Selection:u,d3Zoom:a,panOnScrollMode:R,panOnScrollSpeed:T,zoomOnPinch:j,onPanZoomStart:c,onPanZoom:i,onPanZoomEnd:l}):pi({noWheelClassName:H,preventScrolling:O,d3ZoomHandler:y});if(u.on("wheel.zoom",W,{passive:!1}),!D){const Q=mi({zoomPanValues:g,onDraggingChange:f,onPanZoomStart:c});a.on("start",Q);const K=yi({zoomPanValues:g,panOnDrag:P,onPaneContextMenu:!!I,onPanZoom:i,onTransformChange:Y});a.on("zoom",K);const F=xi({zoomPanValues:g,panOnDrag:P,panOnScroll:z,onPaneContextMenu:I,onPanZoomEnd:l,onDraggingChange:f});a.on("end",F)}const G=wi({zoomActivationKeyPressed:U,panOnDrag:P,zoomOnScroll:L,panOnScroll:z,zoomOnDoubleClick:Z,zoomOnPinch:j,userSelectionActive:D,noPanClassName:_,noWheelClassName:H,lib:X});a.filter(G),Z?u.on("dblclick.zoom",p):u.on("dblclick.zoom",null)}function v(){a.on("zoom",null)}async function h(H,_,I){const D=St(H),z=a?.constrain()(D,_,I);return z&&await x(z),new Promise(P=>P(z))}async function m(H,_){const I=St(H);return await x(I,_),new Promise(D=>D(I))}function E(H){if(u){const _=St(H),I=u.property("__zoom");(I.k!==H.zoom||I.x!==H.x||I.y!==H.y)&&a?.transform(u,_,null,{sync:!0})}}function N(){const H=u?Cr(u.node()):{x:0,y:0,k:1};return{x:H.x,y:H.y,zoom:H.k}}function S(H,_){return u?new Promise(I=>{a?.scaleTo(Et(u,_?.duration,()=>I(!0)),H)}):Promise.resolve(!1)}function M(H,_){return u?new Promise(I=>{a?.scaleBy(Et(u,_?.duration,()=>I(!0)),H)}):Promise.resolve(!1)}function k(H){a?.scaleExtent(H)}function A(H){a?.translateExtent(H)}function $(H){const _=!ie(H)||H<0?0:H;a?.clickDistance(_)}return{update:w,destroy:v,setViewport:m,setViewportConstrained:h,getViewport:N,scaleTo:S,scaleBy:M,setScaleExtent:k,setTranslateExtent:A,syncViewport:E,setClickDistance:$}}var je;(function(e){e.Line="line",e.Handle="handle"})(je||(je={}));function Si({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:s,affectsY:r}){const i=e-t,c=n-o,l=[i>0?1:i<0?-1:0,c>0?1:c<0?-1:0];return i&&s&&(l[0]=l[0]*-1),c&&r&&(l[1]=l[1]*-1),l}function Ei(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),o=e.includes("left"),s=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:o,affectsY:s}}function ue(e,t){return Math.max(0,t-e)}function fe(e,t){return Math.max(0,e-t)}function Ue(e,t,n){return Math.max(0,t-e,e-n)}function xn(e,t){return e?!t:t}function vi(e,t,n,o,s,r,i,c){let{affectsX:l,affectsY:f}=t;const{isHorizontal:g,isVertical:d}=t,a=g&&d,{xSnapped:u,ySnapped:y}=n,{minWidth:p,maxWidth:x,minHeight:w,maxHeight:v}=o,{x:h,y:m,width:E,height:N,aspectRatio:S}=e;let M=Math.floor(g?u-e.pointerX:0),k=Math.floor(d?y-e.pointerY:0);const A=E+(l?-M:M),$=N+(f?-k:k),H=-r[0]*E,_=-r[1]*N;let I=Ue(A,p,x),D=Ue($,w,v);if(i){let R=0,T=0;l&&M<0?R=ue(h+M+H,i[0][0]):!l&&M>0&&(R=fe(h+A+H,i[1][0])),f&&k<0?T=ue(m+k+_,i[0][1]):!f&&k>0&&(T=fe(m+$+_,i[1][1])),I=Math.max(I,R),D=Math.max(D,T)}if(c){let R=0,T=0;l&&M>0?R=fe(h+M,c[0][0]):!l&&M<0&&(R=ue(h+A,c[1][0])),f&&k>0?T=fe(m+k,c[0][1]):!f&&k<0&&(T=ue(m+$,c[1][1])),I=Math.max(I,R),D=Math.max(D,T)}if(s){if(g){const R=Ue(A/S,w,v)*S;if(I=Math.max(I,R),i){let T=0;!l&&!f||l&&!f&&a?T=fe(m+_+A/S,i[1][1])*S:T=ue(m+_+(l?M:-M)/S,i[0][1])*S,I=Math.max(I,T)}if(c){let T=0;!l&&!f||l&&!f&&a?T=ue(m+A/S,c[1][1])*S:T=fe(m+(l?M:-M)/S,c[0][1])*S,I=Math.max(I,T)}}if(d){const R=Ue($*S,p,x)/S;if(D=Math.max(D,R),i){let T=0;!l&&!f||f&&!l&&a?T=fe(h+$*S+H,i[1][0])/S:T=ue(h+(f?k:-k)*S+H,i[0][0])/S,D=Math.max(D,T)}if(c){let T=0;!l&&!f||f&&!l&&a?T=ue(h+$*S,c[1][0])/S:T=fe(h+(f?k:-k)*S,c[0][0])/S,D=Math.max(D,T)}}}k=k+(k<0?D:-D),M=M+(M<0?I:-I),s&&(a?A>$*S?k=(xn(l,f)?-M:M)/S:M=(xn(l,f)?-k:k)*S:g?(k=M/S,f=l):(M=k*S,l=f));const z=l?h+M:h,P=f?m+k:m;return{width:E+(l?-M:M),height:N+(f?-k:k),x:r[0]*M*(l?-1:1)+z,y:r[1]*k*(f?-1:1)+P}}const Po={width:0,height:0,x:0,y:0},Ni={...Po,pointerX:0,pointerY:0,aspectRatio:1};function Ci(e){return[[0,0],[e.measured.width,e.measured.height]]}function Mi(e,t,n){const o=t.position.x+e.position.x,s=t.position.y+e.position.y,r=e.measured.width??0,i=e.measured.height??0,c=n[0]*r,l=n[1]*i;return[[o-c,s-l],[o+r-c,s+i-l]]}function Ii({domNode:e,nodeId:t,getStoreItems:n,onChange:o,onEnd:s}){const r=Me(e);function i({controlPosition:l,boundaries:f,keepAspectRatio:g,resizeDirection:d,onResizeStart:a,onResize:u,onResizeEnd:y,shouldResize:p}){let x={...Po},w={...Ni};const v=Ei(l);let h,m=null,E=[],N,S,M;const k=eo().on("start",A=>{const{nodeLookup:$,transform:H,snapGrid:_,snapToGrid:I,nodeOrigin:D,paneDomNode:z}=n();if(h=$.get(t),!h)return;m=z?.getBoundingClientRect()??null;const{xSnapped:P,ySnapped:R}=Re(A.sourceEvent,{transform:H,snapGrid:_,snapToGrid:I,containerBounds:m});x={width:h.measured.width??0,height:h.measured.height??0,x:h.position.x??0,y:h.position.y??0},w={...x,pointerX:P,pointerY:R,aspectRatio:x.width/x.height},N=void 0,h.parentId&&(h.extent==="parent"||h.expandParent)&&(N=$.get(h.parentId),S=N&&h.extent==="parent"?Ci(N):void 0),E=[],M=void 0;for(const[T,O]of $)if(O.parentId===t&&(E.push({id:T,position:{...O.position},extent:O.extent}),O.extent==="parent"||O.expandParent)){const j=Mi(O,h,O.origin??D);M?M=[[Math.min(j[0][0],M[0][0]),Math.min(j[0][1],M[0][1])],[Math.max(j[1][0],M[1][0]),Math.max(j[1][1],M[1][1])]]:M=j}a?.(A,{...x})}).on("drag",A=>{const{transform:$,snapGrid:H,snapToGrid:_,nodeOrigin:I}=n(),D=Re(A.sourceEvent,{transform:$,snapGrid:H,snapToGrid:_,containerBounds:m}),z=[];if(!h)return;const{x:P,y:R,width:T,height:O}=x,j={},L=h.origin??I,{width:Z,height:U,x:X,y:Y}=vi(w,v,D,f,g,L,S,M),V=Z!==T,W=U!==O,G=X!==P&&V,Q=Y!==R&&W;if(!G&&!Q&&!V&&!W)return;if((G||Q||L[0]===1||L[1]===1)&&(j.x=G?X:x.x,j.y=Q?Y:x.y,x.x=j.x,x.y=j.y,E.length>0)){const J=X-P,se=Y-R;for(const re of E)re.position={x:re.position.x-J+L[0]*(Z-T),y:re.position.y-se+L[1]*(U-O)},z.push(re)}if((V||W)&&(j.width=V&&(!d||d==="horizontal")?Z:x.width,j.height=W&&(!d||d==="vertical")?U:x.height,x.width=j.width,x.height=j.height),N&&h.expandParent){const J=L[0]*(j.width??0);j.x&&j.x<J&&(x.x=J,w.x=w.x-(j.x-J));const se=L[1]*(j.height??0);j.y&&j.y<se&&(x.y=se,w.y=w.y-(j.y-se))}const K=Si({width:x.width,prevWidth:T,height:x.height,prevHeight:O,affectsX:v.affectsX,affectsY:v.affectsY}),F={...x,direction:K};p?.(A,F)!==!1&&(u?.(A,F),o(j,z))}).on("end",A=>{y?.(A,{...x}),s?.({...x})});r.call(k)}function c(){r.on(".drag",null)}return{update:i,destroy:c}}var vt={exports:{}},Nt={},Ct={exports:{}},Mt={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wn;function ki(){if(wn)return Mt;wn=1;var e=Kn();function t(d,a){return d===a&&(d!==0||1/d===1/a)||d!==d&&a!==a}var n=typeof Object.is=="function"?Object.is:t,o=e.useState,s=e.useEffect,r=e.useLayoutEffect,i=e.useDebugValue;function c(d,a){var u=a(),y=o({inst:{value:u,getSnapshot:a}}),p=y[0].inst,x=y[1];return r(function(){p.value=u,p.getSnapshot=a,l(p)&&x({inst:p})},[d,u,a]),s(function(){return l(p)&&x({inst:p}),d(function(){l(p)&&x({inst:p})})},[d]),i(u),u}function l(d){var a=d.getSnapshot;d=d.value;try{var u=a();return!n(d,u)}catch{return!0}}function f(d,a){return a()}var g=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:c;return Mt.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:g,Mt}var bn;function Pi(){return bn||(bn=1,Ct.exports=ki()),Ct.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sn;function Ai(){if(Sn)return Nt;Sn=1;var e=Kn(),t=Pi();function n(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var o=typeof Object.is=="function"?Object.is:n,s=t.useSyncExternalStore,r=e.useRef,i=e.useEffect,c=e.useMemo,l=e.useDebugValue;return Nt.useSyncExternalStoreWithSelector=function(f,g,d,a,u){var y=r(null);if(y.current===null){var p={hasValue:!1,value:null};y.current=p}else p=y.current;y=c(function(){function w(N){if(!v){if(v=!0,h=N,N=a(N),u!==void 0&&p.hasValue){var S=p.value;if(u(S,N))return m=S}return m=N}if(S=m,o(h,N))return S;var M=a(N);return u!==void 0&&u(S,M)?(h=N,S):(h=N,m=M)}var v=!1,h,m,E=d===void 0?null:d;return[function(){return w(g())},E===null?void 0:function(){return w(E())}]},[g,d,a,u]);var x=s(f,y[0],y[1]);return i(function(){p.hasValue=!0,p.value=x},[x]),l(x),x},Nt}var En;function $i(){return En||(En=1,vt.exports=Ai()),vt.exports}var Di=$i();const Hi=yr(Di),Ti={BASE_URL:"/playground",DEV:!1,MODE:"production",PROD:!0,SSR:!1},vn=e=>{let t;const n=new Set,o=(g,d)=>{const a=typeof g=="function"?g(t):g;if(!Object.is(a,t)){const u=t;t=d??(typeof a!="object"||a===null)?a:Object.assign({},t,a),n.forEach(y=>y(t,u))}},s=()=>t,l={setState:o,getState:s,getInitialState:()=>f,subscribe:g=>(n.add(g),()=>n.delete(g)),destroy:()=>{(Ti?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},f=t=e(o,s,l);return l},_i=e=>e?vn(e):vn,{useDebugValue:Ri}=xr,{useSyncExternalStoreWithSelector:ji}=Hi,zi=e=>e;function Ao(e,t=zi,n){const o=ji(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Ri(o),o}const Nn=(e,t)=>{const n=_i(e),o=(s,r=t)=>Ao(n,s,r);return Object.assign(o,n),o},Oi=(e,t)=>e?Nn(e,t):Nn;function te(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[o,s]of e)if(!Object.is(s,t.get(o)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}const at=C.createContext(null),Bi=at.Provider,$o=ce.error001();function q(e,t){const n=C.useContext(at);if(n===null)throw new Error($o);return Ao(n,e,t)}function ee(){const e=C.useContext(at);if(e===null)throw new Error($o);return C.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Cn={display:"none"},Vi={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Do="react-flow__node-desc",Ho="react-flow__edge-desc",Li="react-flow__aria-live",Fi=e=>e.ariaLiveMessage;function Zi({rfId:e}){const t=q(Fi);return b.jsx("div",{id:`${Li}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Vi,children:t})}function Yi({rfId:e,disableKeyboardA11y:t}){return b.jsxs(b.Fragment,{children:[b.jsxs("div",{id:`${Do}-${e}`,style:Cn,children:["Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "]}),b.jsx("div",{id:`${Ho}-${e}`,style:Cn,children:"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."}),!t&&b.jsx(Zi,{rfId:e})]})}const Wi=e=>e.userSelectionActive?"none":"all",lt=C.forwardRef(({position:e="top-left",children:t,className:n,style:o,...s},r)=>{const i=q(Wi),c=`${e}`.split("-");return b.jsx("div",{className:oe(["react-flow__panel",n,...c]),style:{...o,pointerEvents:i},ref:r,...s,children:t})});lt.displayName="Panel";function Xi({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:b.jsx(lt,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:b.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Gi=e=>{const t=[],n=[];for(const[,o]of e.nodeLookup)o.selected&&t.push(o.internals.userNode);for(const[,o]of e.edgeLookup)o.selected&&n.push(o);return{selectedNodes:t,selectedEdges:n}},qe=e=>e.id;function Ui(e,t){return te(e.selectedNodes.map(qe),t.selectedNodes.map(qe))&&te(e.selectedEdges.map(qe),t.selectedEdges.map(qe))}function qi({onSelectionChange:e}){const t=ee(),{selectedNodes:n,selectedEdges:o}=q(Gi,Ui);return C.useEffect(()=>{const s={nodes:n,edges:o};e?.(s),t.getState().onSelectionChangeHandlers.forEach(r=>r(s))},[n,o,e]),null}const Ki=e=>!!e.onSelectionChangeHandlers;function Qi({onSelectionChange:e}){const t=q(Ki);return e||t?b.jsx(qi,{onSelectionChange:e}):null}const To=[0,0],Ji={x:0,y:0,zoom:1},ec=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance"],Mn=[...ec,"rfId"],tc=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),In={translateExtent:ze,nodeOrigin:To,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function nc(e){const{setNodes:t,setEdges:n,setMinZoom:o,setMaxZoom:s,setTranslateExtent:r,setNodeExtent:i,reset:c,setDefaultNodesAndEdges:l,setPaneClickDistance:f}=q(tc,te),g=ee();C.useEffect(()=>(l(e.defaultNodes,e.defaultEdges),()=>{d.current=In,c()}),[]);const d=C.useRef(In);return C.useEffect(()=>{for(const a of Mn){const u=e[a],y=d.current[a];u!==y&&(typeof e[a]>"u"||(a==="nodes"?t(u):a==="edges"?n(u):a==="minZoom"?o(u):a==="maxZoom"?s(u):a==="translateExtent"?r(u):a==="nodeExtent"?i(u):a==="paneClickDistance"?f(u):a==="fitView"?g.setState({fitViewQueued:u}):a==="fitViewOptions"?g.setState({fitViewOptions:u}):g.setState({[a]:u})))}d.current=e},Mn.map(a=>e[a])),null}function kn(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function oc(e){const[t,n]=C.useState(e==="system"?null:e);return C.useEffect(()=>{if(e!=="system"){n(e);return}const o=kn(),s=()=>n(o?.matches?"dark":"light");return s(),o?.addEventListener("change",s),()=>{o?.removeEventListener("change",s)}},[e]),t!==null?t:kn()?.matches?"dark":"light"}const Pn=typeof document<"u"?document:null;function Le(e=null,t={target:Pn,actInsideInputWithModifier:!0}){const[n,o]=C.useState(!1),s=C.useRef(!1),r=C.useRef(new Set([])),[i,c]=C.useMemo(()=>{if(e!==null){const f=(Array.isArray(e)?e:[e]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),g=f.reduce((d,a)=>d.concat(...a),[]);return[f,g]}return[[],[]]},[e]);return C.useEffect(()=>{const l=t?.target??Pn,f=t?.actInsideInputWithModifier??!0;if(e!==null){const g=u=>{if(s.current=u.ctrlKey||u.metaKey||u.shiftKey||u.altKey,(!s.current||s.current&&!f)&&ho(u))return!1;const p=$n(u.code,c);if(r.current.add(u[p]),An(i,r.current,!1)){const x=u.composedPath?.()?.[0]||u.target,w=x?.nodeName==="BUTTON"||x?.nodeName==="A";t.preventDefault!==!1&&(s.current||!w)&&u.preventDefault(),o(!0)}},d=u=>{const y=$n(u.code,c);An(i,r.current,!0)?(o(!1),r.current.clear()):r.current.delete(u[y]),u.key==="Meta"&&r.current.clear(),s.current=!1},a=()=>{r.current.clear(),o(!1)};return l?.addEventListener("keydown",g),l?.addEventListener("keyup",d),window.addEventListener("blur",a),window.addEventListener("contextmenu",a),()=>{l?.removeEventListener("keydown",g),l?.removeEventListener("keyup",d),window.removeEventListener("blur",a),window.removeEventListener("contextmenu",a)}}},[e,o]),n}function An(e,t,n){return e.filter(o=>n||o.length===t.size).some(o=>o.every(s=>t.has(s)))}function $n(e,t){return t.includes(e)?"code":"key"}const sc=()=>{const e=ee();return C.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:o}=e.getState();return o?o.scaleTo(t,{duration:n?.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[o,s,r],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??o,y:t.y??s,zoom:t.zoom??r},{duration:n?.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},setCenter:async(t,n,o)=>{const{width:s,height:r,maxZoom:i,panZoom:c}=e.getState(),l=typeof o?.zoom<"u"?o.zoom:i,f=s/2-t*l,g=r/2-n*l;return c?(await c.setViewport({x:f,y:g,zoom:l},{duration:o?.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitBounds:async(t,n)=>{const{width:o,height:s,minZoom:r,maxZoom:i,panZoom:c}=e.getState(),l=Vt(t,o,s,r,i,n?.padding??.1);return c?(await c.setViewport(l,{duration:n?.duration}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:o,snapGrid:s,snapToGrid:r,domNode:i}=e.getState();if(!i)return t;const{x:c,y:l}=i.getBoundingClientRect(),f={x:t.x-c,y:t.y-l},g=n.snapGrid??s,d=n.snapToGrid??r;return Ye(f,o,d,g)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:s,y:r}=o.getBoundingClientRect(),i=tt(t,n);return{x:i.x+s,y:i.y+r}}}),[])};function _o(e,t){const n=[],o=new Map,s=[];for(const r of e)if(r.type==="add"){s.push(r);continue}else if(r.type==="remove"||r.type==="replace")o.set(r.id,[r]);else{const i=o.get(r.id);i?i.push(r):o.set(r.id,[r])}for(const r of t){const i=o.get(r.id);if(!i){n.push(r);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const c={...r};for(const l of i)rc(l,c);n.push(c)}return s.length&&s.forEach(r=>{r.index!==void 0?n.splice(r.index,0,{...r.item}):n.push({...r.item})}),n}function rc(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??={},t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Ro(e,t){return _o(e,t)}function jo(e,t){return _o(e,t)}function pe(e,t){return{id:e,type:"select",selected:t}}function Ce(e,t=new Set,n=!1){const o=[];for(const[s,r]of e){const i=t.has(s);!(r.selected===void 0&&!i)&&r.selected!==i&&(n&&(r.selected=i),o.push(pe(r.id,i)))}return o}function Dn({items:e=[],lookup:t}){const n=[],o=new Map(e.map(s=>[s.id,s]));for(const[s,r]of e.entries()){const i=t.get(r.id),c=i?.internals?.userNode??i;c!==void 0&&c!==r&&n.push({id:r.id,item:r,type:"replace"}),c===void 0&&n.push({item:r,type:"add",index:s})}for(const[s]of t)o.get(s)===void 0&&n.push({id:s,type:"remove"});return n}function Hn(e){return{id:e.id,type:"remove"}}const Tn=e=>Dr(e),ic=e=>so(e);function zo(e){return C.forwardRef(e)}const cc=typeof window<"u"?C.useLayoutEffect:C.useEffect;function _n(e){const[t,n]=C.useState(BigInt(0)),[o]=C.useState(()=>ac(()=>n(s=>s+BigInt(1))));return cc(()=>{const s=o.get();s.length&&(e(s),o.reset())},[t]),o}function ac(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Oo=C.createContext(null);function lc({children:e}){const t=ee(),n=C.useCallback(c=>{const{nodes:l=[],setNodes:f,hasDefaultNodes:g,onNodesChange:d,nodeLookup:a,fitViewQueued:u}=t.getState();let y=l;for(const x of c)y=typeof x=="function"?x(y):x;const p=Dn({items:y,lookup:a});g&&f(y),p.length>0?d?.(p):u&&window.requestAnimationFrame(()=>{const{fitViewQueued:x,nodes:w,setNodes:v}=t.getState();x&&v(w)})},[]),o=_n(n),s=C.useCallback(c=>{const{edges:l=[],setEdges:f,hasDefaultEdges:g,onEdgesChange:d,edgeLookup:a}=t.getState();let u=l;for(const y of c)u=typeof y=="function"?y(u):y;g?f(u):d&&d(Dn({items:u,lookup:a}))},[]),r=_n(s),i=C.useMemo(()=>({nodeQueue:o,edgeQueue:r}),[]);return b.jsx(Oo.Provider,{value:i,children:e})}function dc(){const e=C.useContext(Oo);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const uc=e=>!!e.panZoom;function Xt(){const e=sc(),t=ee(),n=dc(),o=q(uc),s=C.useMemo(()=>{const r=d=>t.getState().nodeLookup.get(d),i=d=>{n.nodeQueue.push(d)},c=d=>{n.edgeQueue.push(d)},l=d=>{const{nodeLookup:a,nodeOrigin:u}=t.getState(),y=Tn(d)?d:a.get(d.id),p=y.parentId?fo(y.position,y.measured,y.parentId,a,u):y.position,x={...y,position:p,width:y.measured?.width??y.width,height:y.measured?.height??y.height};return Pe(x)},f=(d,a,u={replace:!1})=>{i(y=>y.map(p=>{if(p.id===d){const x=typeof a=="function"?a(p):a;return u.replace&&Tn(x)?x:{...p,...x}}return p}))},g=(d,a,u={replace:!1})=>{c(y=>y.map(p=>{if(p.id===d){const x=typeof a=="function"?a(p):a;return u.replace&&ic(x)?x:{...p,...x}}return p}))};return{getNodes:()=>t.getState().nodes.map(d=>({...d})),getNode:d=>r(d)?.internals.userNode,getInternalNode:r,getEdges:()=>{const{edges:d=[]}=t.getState();return d.map(a=>({...a}))},getEdge:d=>t.getState().edgeLookup.get(d),setNodes:i,setEdges:c,addNodes:d=>{const a=Array.isArray(d)?d:[d];n.nodeQueue.push(u=>[...u,...a])},addEdges:d=>{const a=Array.isArray(d)?d:[d];n.edgeQueue.push(u=>[...u,...a])},toObject:()=>{const{nodes:d=[],edges:a=[],transform:u}=t.getState(),[y,p,x]=u;return{nodes:d.map(w=>({...w})),edges:a.map(w=>({...w})),viewport:{x:y,y:p,zoom:x}}},deleteElements:async({nodes:d=[],edges:a=[]})=>{const{nodes:u,edges:y,onNodesDelete:p,onEdgesDelete:x,triggerNodeChanges:w,triggerEdgeChanges:v,onDelete:h,onBeforeDelete:m}=t.getState(),{nodes:E,edges:N}=await jr({nodesToRemove:d,edgesToRemove:a,nodes:u,edges:y,onBeforeDelete:m}),S=N.length>0,M=E.length>0;if(S){const k=N.map(Hn);x?.(N),v(k)}if(M){const k=E.map(Hn);p?.(E),w(k)}return(M||S)&&h?.({nodes:E,edges:N}),{deletedNodes:E,deletedEdges:N}},getIntersectingNodes:(d,a=!0,u)=>{const y=cn(d),p=y?d:l(d),x=u!==void 0;return p?(u||t.getState().nodes).filter(w=>{const v=t.getState().nodeLookup.get(w.id);if(v&&!y&&(w.id===d.id||!v.internals.positionAbsolute))return!1;const h=Pe(x?w:v),m=Be(h,p);return a&&m>0||m>=p.width*p.height}):[]},isNodeIntersecting:(d,a,u=!0)=>{const p=cn(d)?d:l(d);if(!p)return!1;const x=Be(p,a);return u&&x>0||x>=p.width*p.height},updateNode:f,updateNodeData:(d,a,u={replace:!1})=>{f(d,y=>{const p=typeof a=="function"?a(y):a;return u.replace?{...y,data:p}:{...y,data:{...y.data,...p}}},u)},updateEdge:g,updateEdgeData:(d,a,u={replace:!1})=>{g(d,y=>{const p=typeof a=="function"?a(y):a;return u.replace?{...y,data:p}:{...y,data:{...y.data,...p}}},u)},getNodesBounds:d=>{const{nodeLookup:a,nodeOrigin:u}=t.getState();return Hr(d,{nodeLookup:a,nodeOrigin:u})},getHandleConnections:({type:d,id:a,nodeId:u})=>Array.from(t.getState().connectionLookup.get(`${u}-${d}${a?`-${a}`:""}`)?.values()??[]),getNodeConnections:({type:d,handleId:a,nodeId:u})=>Array.from(t.getState().connectionLookup.get(`${u}${d?a?`-${d}-${a}`:`-${d}`:""}`)?.values()??[]),fitView:async d=>{const a=t.getState().fitViewResolver??Vr();return t.setState({fitViewQueued:!0,fitViewOptions:d,fitViewResolver:a}),n.nodeQueue.push(u=>[...u]),a.promise}}},[]);return C.useMemo(()=>({...s,...e,viewportInitialized:o}),[o])}const Rn=e=>e.selected,fc=typeof window<"u"?window:void 0;function gc({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=ee(),{deleteElements:o}=Xt(),s=Le(e,{actInsideInputWithModifier:!1}),r=Le(t,{target:fc});C.useEffect(()=>{if(s){const{edges:i,nodes:c}=n.getState();o({nodes:c.filter(Rn),edges:i.filter(Rn)}),n.setState({nodesSelectionActive:!1})}},[s]),C.useEffect(()=>{n.setState({multiSelectionActive:r})},[r])}function hc(e){const t=ee();C.useEffect(()=>{const n=()=>{if(!e.current)return!1;const o=Lt(e.current);(o.height===0||o.width===0)&&t.getState().onError?.("004",ce.error004()),t.setState({width:o.width||500,height:o.height||500})};if(e.current){n(),window.addEventListener("resize",n);const o=new ResizeObserver(()=>n());return o.observe(e.current),()=>{window.removeEventListener("resize",n),o&&e.current&&o.unobserve(e.current)}}},[])}const dt={position:"absolute",width:"100%",height:"100%",top:0,left:0},pc=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function mc({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:o=!1,panOnScrollSpeed:s=.5,panOnScrollMode:r=me.Free,zoomOnDoubleClick:i=!0,panOnDrag:c=!0,defaultViewport:l,translateExtent:f,minZoom:g,maxZoom:d,zoomActivationKeyCode:a,preventScrolling:u=!0,children:y,noWheelClassName:p,noPanClassName:x,onViewportChange:w,isControlledViewport:v,paneClickDistance:h}){const m=ee(),E=C.useRef(null),{userSelectionActive:N,lib:S}=q(pc,te),M=Le(a),k=C.useRef();hc(E);const A=C.useCallback($=>{w?.({x:$[0],y:$[1],zoom:$[2]}),v||m.setState({transform:$})},[w,v]);return C.useEffect(()=>{if(E.current){k.current=bi({domNode:E.current,minZoom:g,maxZoom:d,translateExtent:f,viewport:l,paneClickDistance:h,onDraggingChange:I=>m.setState({paneDragging:I}),onPanZoomStart:(I,D)=>{const{onViewportChangeStart:z,onMoveStart:P}=m.getState();P?.(I,D),z?.(D)},onPanZoom:(I,D)=>{const{onViewportChange:z,onMove:P}=m.getState();P?.(I,D),z?.(D)},onPanZoomEnd:(I,D)=>{const{onViewportChangeEnd:z,onMoveEnd:P}=m.getState();P?.(I,D),z?.(D)}});const{x:$,y:H,zoom:_}=k.current.getViewport();return m.setState({panZoom:k.current,transform:[$,H,_],domNode:E.current.closest(".react-flow")}),()=>{k.current?.destroy()}}},[]),C.useEffect(()=>{k.current?.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:o,panOnScrollSpeed:s,panOnScrollMode:r,zoomOnDoubleClick:i,panOnDrag:c,zoomActivationKeyPressed:M,preventScrolling:u,noPanClassName:x,userSelectionActive:N,noWheelClassName:p,lib:S,onTransformChange:A})},[e,t,n,o,s,r,i,c,M,u,x,N,p,S,A]),b.jsx("div",{className:"react-flow__renderer",ref:E,style:dt,children:y})}const yc=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function xc(){const{userSelectionActive:e,userSelectionRect:t}=q(yc,te);return e&&t?b.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const It=(e,t)=>n=>{n.target===t.current&&e?.(n)},wc=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function bc({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Oe.Full,panOnDrag:o,selectionOnDrag:s,onSelectionStart:r,onSelectionEnd:i,onPaneClick:c,onPaneContextMenu:l,onPaneScroll:f,onPaneMouseEnter:g,onPaneMouseMove:d,onPaneMouseLeave:a,children:u}){const y=ee(),{userSelectionActive:p,elementsSelectable:x,dragging:w,connectionInProgress:v}=q(wc,te),h=x&&(e||p),m=C.useRef(null),E=C.useRef(),N=C.useRef(new Set),S=C.useRef(new Set),M=C.useRef(!1),k=C.useRef(!1),A=P=>{if(M.current||v){M.current=!1;return}c?.(P),y.getState().resetSelectedElements(),y.setState({nodesSelectionActive:!1})},$=P=>{if(Array.isArray(o)&&o?.includes(2)){P.preventDefault();return}l?.(P)},H=f?P=>f(P):void 0,_=P=>{const{resetSelectedElements:R,domNode:T}=y.getState();if(E.current=T?.getBoundingClientRect(),!x||!e||P.button!==0||P.target!==m.current||!E.current)return;P.target?.setPointerCapture?.(P.pointerId),k.current=!0,M.current=!1;const{x:O,y:j}=ae(P.nativeEvent,E.current);R(),y.setState({userSelectionRect:{width:0,height:0,startX:O,startY:j,x:O,y:j}}),r?.(P)},I=P=>{const{userSelectionRect:R,transform:T,nodeLookup:O,edgeLookup:j,connectionLookup:L,triggerNodeChanges:Z,triggerEdgeChanges:U,defaultEdgeOptions:X}=y.getState();if(!E.current||!R)return;M.current=!0;const{x:Y,y:V}=ae(P.nativeEvent,E.current),{startX:W,startY:G}=R,Q={startX:W,startY:G,x:Y<W?Y:W,y:V<G?V:G,width:Math.abs(Y-W),height:Math.abs(V-G)},K=N.current,F=S.current;N.current=new Set(ro(O,Q,T,n===Oe.Partial,!0).map(J=>J.id)),S.current=new Set;const ne=X?.selectable??!0;for(const J of N.current){const se=L.get(J);if(se)for(const{edgeId:re}of se.values()){const xe=j.get(re);xe&&(xe.selectable??ne)&&S.current.add(re)}}if(!an(K,N.current)){const J=Ce(O,N.current,!0);Z(J)}if(!an(F,S.current)){const J=Ce(j,S.current);U(J)}y.setState({userSelectionRect:Q,userSelectionActive:!0,nodesSelectionActive:!1})},D=P=>{if(P.button!==0||!k.current)return;P.target?.releasePointerCapture?.(P.pointerId);const{userSelectionRect:R}=y.getState();!p&&R&&P.target===m.current&&A?.(P),y.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:N.current.size>0}),i?.(P),(t||s)&&(M.current=!1),k.current=!1},z=o===!0||Array.isArray(o)&&o.includes(0);return b.jsxs("div",{className:oe(["react-flow__pane",{draggable:z,dragging:w,selection:e}]),onClick:h?void 0:It(A,m),onContextMenu:It($,m),onWheel:It(H,m),onPointerEnter:h?void 0:g,onPointerDown:h?_:d,onPointerMove:h?I:d,onPointerUp:h?D:void 0,onPointerLeave:a,ref:m,style:dt,children:[u,b.jsx(xc,{})]})}function Rt({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:s,unselectNodesAndEdges:r,multiSelectionActive:i,nodeLookup:c,onError:l}=t.getState(),f=c.get(e);if(!f){l?.("012",ce.error012(e));return}t.setState({nodesSelectionActive:!1}),f.selected?(n||f.selected&&i)&&(r({nodes:[f],edges:[]}),requestAnimationFrame(()=>o?.current?.blur())):s([e])}function Bo({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:s,isSelectable:r,nodeClickDistance:i}){const c=ee(),[l,f]=C.useState(!1),g=C.useRef();return C.useEffect(()=>{g.current=ii({getStoreItems:()=>c.getState(),onNodeMouseDown:d=>{Rt({id:d,store:c,nodeRef:e})},onDragStart:()=>{f(!0)},onDragStop:()=>{f(!1)}})},[]),C.useEffect(()=>{if(t)g.current?.destroy();else if(e.current)return g.current?.update({noDragClassName:n,handleSelector:o,domNode:e.current,isSelectable:r,nodeId:s,nodeClickDistance:i}),()=>{g.current?.destroy()}},[n,o,t,r,e,s]),l}const Sc=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Vo(){const e=ee();return C.useCallback(n=>{const{nodeExtent:o,snapToGrid:s,snapGrid:r,nodesDraggable:i,onError:c,updateNodePositions:l,nodeLookup:f,nodeOrigin:g}=e.getState(),d=new Map,a=Sc(i),u=s?r[0]:5,y=s?r[1]:5,p=n.direction.x*u*n.factor,x=n.direction.y*y*n.factor;for(const[,w]of f){if(!a(w))continue;let v={x:w.internals.positionAbsolute.x+p,y:w.internals.positionAbsolute.y+x};s&&(v=it(v,r));const{position:h,positionAbsolute:m}=io({nodeId:w.id,nextPosition:v,nodeLookup:f,nodeExtent:o,nodeOrigin:g,onError:c});w.position=h,w.internals.positionAbsolute=m,d.set(w.id,w)}l(d)},[])}const Gt=C.createContext(null),Ec=Gt.Provider;Gt.Consumer;const Lo=()=>C.useContext(Gt),vc=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),Nc=(e,t,n)=>o=>{const{connectionClickStartHandle:s,connectionMode:r,connection:i}=o,{fromHandle:c,toHandle:l,isValid:f}=i,g=l?.nodeId===e&&l?.id===t&&l?.type===n;return{connectingFrom:c?.nodeId===e&&c?.id===t&&c?.type===n,connectingTo:g,clickConnecting:s?.nodeId===e&&s?.id===t&&s?.type===n,isPossibleEndHandle:r===Ie.Strict?c?.type!==n:e!==c?.nodeId||t!==c?.id,connectionInProcess:!!c,clickConnectionInProcess:!!s,valid:g&&f}};function Cc({type:e="source",position:t=B.Top,isValidConnection:n,isConnectable:o=!0,isConnectableStart:s=!0,isConnectableEnd:r=!0,id:i,onConnect:c,children:l,className:f,onMouseDown:g,onTouchStart:d,...a},u){const y=i||null,p=e==="target",x=ee(),w=Lo(),{connectOnClick:v,noPanClassName:h,rfId:m}=q(vc,te),{connectingFrom:E,connectingTo:N,clickConnecting:S,isPossibleEndHandle:M,connectionInProcess:k,clickConnectionInProcess:A,valid:$}=q(Nc(w,y,e),te);w||x.getState().onError?.("010",ce.error010());const H=D=>{const{defaultEdgeOptions:z,onConnect:P,hasDefaultEdges:R}=x.getState(),T={...z,...D};if(R){const{edges:O,setEdges:j}=x.getState();j(Xr(T,O))}P?.(T),c?.(T)},_=D=>{if(!w)return;const z=po(D.nativeEvent);if(s&&(z&&D.button===0||!z)){const P=x.getState();_t.onPointerDown(D.nativeEvent,{autoPanOnConnect:P.autoPanOnConnect,connectionMode:P.connectionMode,connectionRadius:P.connectionRadius,domNode:P.domNode,nodeLookup:P.nodeLookup,lib:P.lib,isTarget:p,handleId:y,nodeId:w,flowId:P.rfId,panBy:P.panBy,cancelConnection:P.cancelConnection,onConnectStart:P.onConnectStart,onConnectEnd:P.onConnectEnd,updateConnection:P.updateConnection,onConnect:H,isValidConnection:n||P.isValidConnection,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,autoPanSpeed:P.autoPanSpeed})}z?g?.(D):d?.(D)},I=D=>{const{onClickConnectStart:z,onClickConnectEnd:P,connectionClickStartHandle:R,connectionMode:T,isValidConnection:O,lib:j,rfId:L,nodeLookup:Z,connection:U}=x.getState();if(!w||!R&&!s)return;if(!R){z?.(D.nativeEvent,{nodeId:w,handleId:y,handleType:e}),x.setState({connectionClickStartHandle:{nodeId:w,type:e,id:y}});return}const X=go(D.target),Y=n||O,{connection:V,isValid:W}=_t.isValid(D.nativeEvent,{handle:{nodeId:w,id:y,type:e},connectionMode:T,fromNodeId:R.nodeId,fromHandleId:R.id||null,fromType:R.type,isValidConnection:Y,flowId:L,doc:X,lib:j,nodeLookup:Z});W&&V&&H(V);const G=structuredClone(U);delete G.inProgress,G.toPosition=G.toHandle?G.toHandle.position:null,P?.(D,G),x.setState({connectionClickStartHandle:null})};return b.jsx("div",{"data-handleid":y,"data-nodeid":w,"data-handlepos":t,"data-id":`${m}-${w}-${y}-${e}`,className:oe(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",h,f,{source:!p,target:p,connectable:o,connectablestart:s,connectableend:r,clickconnecting:S,connectingfrom:E,connectingto:N,valid:$,connectionindicator:o&&(!k||M)&&(k||A?r:s)}]),onMouseDown:_,onTouchStart:_,onClick:v?I:void 0,ref:u,...a,children:l})}const he=C.memo(zo(Cc));function Mc({data:e,isConnectable:t,sourcePosition:n=B.Bottom}){return b.jsxs(b.Fragment,{children:[e?.label,b.jsx(he,{type:"source",position:n,isConnectable:t})]})}function Ic({data:e,isConnectable:t,targetPosition:n=B.Top,sourcePosition:o=B.Bottom}){return b.jsxs(b.Fragment,{children:[b.jsx(he,{type:"target",position:n,isConnectable:t}),e?.label,b.jsx(he,{type:"source",position:o,isConnectable:t})]})}function kc(){return null}function Pc({data:e,isConnectable:t,targetPosition:n=B.Top}){return b.jsxs(b.Fragment,{children:[b.jsx(he,{type:"target",position:n,isConnectable:t}),e?.label]})}const ot={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},jn={input:Mc,default:Ic,output:Pc,group:kc};function Ac(e){return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??e.style?.width,height:e.height??e.initialHeight??e.style?.height}:{width:e.width??e.style?.width,height:e.height??e.style?.height}}const $c=e=>{const{width:t,height:n,x:o,y:s}=Ze(e.nodeLookup,{filter:r=>!!r.selected});return{width:ie(t)?t:null,height:ie(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${o}px,${s}px)`}};function Dc({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const o=ee(),{width:s,height:r,transformString:i,userSelectionActive:c}=q($c,te),l=Vo(),f=C.useRef(null);if(C.useEffect(()=>{n||f.current?.focus({preventScroll:!0})},[n]),Bo({nodeRef:f}),c||!s||!r)return null;const g=e?a=>{const u=o.getState().nodes.filter(y=>y.selected);e(a,u)}:void 0,d=a=>{Object.prototype.hasOwnProperty.call(ot,a.key)&&(a.preventDefault(),l({direction:ot[a.key],factor:a.shiftKey?4:1}))};return b.jsx("div",{className:oe(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:b.jsx("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:g,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:s,height:r}})})}const zn=typeof window<"u"?window:void 0,Hc=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Fo({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:s,onPaneContextMenu:r,onPaneScroll:i,paneClickDistance:c,deleteKeyCode:l,selectionKeyCode:f,selectionOnDrag:g,selectionMode:d,onSelectionStart:a,onSelectionEnd:u,multiSelectionKeyCode:y,panActivationKeyCode:p,zoomActivationKeyCode:x,elementsSelectable:w,zoomOnScroll:v,zoomOnPinch:h,panOnScroll:m,panOnScrollSpeed:E,panOnScrollMode:N,zoomOnDoubleClick:S,panOnDrag:M,defaultViewport:k,translateExtent:A,minZoom:$,maxZoom:H,preventScrolling:_,onSelectionContextMenu:I,noWheelClassName:D,noPanClassName:z,disableKeyboardA11y:P,onViewportChange:R,isControlledViewport:T}){const{nodesSelectionActive:O,userSelectionActive:j}=q(Hc),L=Le(f,{target:zn}),Z=Le(p,{target:zn}),U=Z||M,X=Z||m,Y=g&&U!==!0,V=L||j||Y;return gc({deleteKeyCode:l,multiSelectionKeyCode:y}),b.jsx(mc,{onPaneContextMenu:r,elementsSelectable:w,zoomOnScroll:v,zoomOnPinch:h,panOnScroll:X,panOnScrollSpeed:E,panOnScrollMode:N,zoomOnDoubleClick:S,panOnDrag:!L&&U,defaultViewport:k,translateExtent:A,minZoom:$,maxZoom:H,zoomActivationKeyCode:x,preventScrolling:_,noWheelClassName:D,noPanClassName:z,onViewportChange:R,isControlledViewport:T,paneClickDistance:c,children:b.jsxs(bc,{onSelectionStart:a,onSelectionEnd:u,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:s,onPaneContextMenu:r,onPaneScroll:i,panOnDrag:U,isSelecting:!!V,selectionMode:d,selectionKeyPressed:L,selectionOnDrag:Y,children:[e,O&&b.jsx(Dc,{onSelectionContextMenu:I,noPanClassName:z,disableKeyboardA11y:P})]})})}Fo.displayName="FlowRenderer";const Tc=C.memo(Fo),_c=e=>t=>e?ro(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function Rc(e){return q(C.useCallback(_c(e),[e]),te)}const jc=e=>e.updateNodeInternals;function zc(){const e=q(jc),[t]=C.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const o=new Map;n.forEach(s=>{const r=s.target.getAttribute("data-id");o.set(r,{id:r,nodeElement:s.target,force:!0})}),e(o)}));return C.useEffect(()=>()=>{t?.disconnect()},[t]),t}function Oc({node:e,nodeType:t,hasDimensions:n,resizeObserver:o}){const s=ee(),r=C.useRef(null),i=C.useRef(null),c=C.useRef(e.sourcePosition),l=C.useRef(e.targetPosition),f=C.useRef(t),g=n&&!!e.internals.handleBounds;return C.useEffect(()=>{r.current&&!e.hidden&&(!g||i.current!==r.current)&&(i.current&&o?.unobserve(i.current),o?.observe(r.current),i.current=r.current)},[g,e.hidden]),C.useEffect(()=>()=>{i.current&&(o?.unobserve(i.current),i.current=null)},[]),C.useEffect(()=>{if(r.current){const d=f.current!==t,a=c.current!==e.sourcePosition,u=l.current!==e.targetPosition;(d||a||u)&&(f.current=t,c.current=e.sourcePosition,l.current=e.targetPosition,s.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:r.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),r}function Bc({id:e,onClick:t,onMouseEnter:n,onMouseMove:o,onMouseLeave:s,onContextMenu:r,onDoubleClick:i,nodesDraggable:c,elementsSelectable:l,nodesConnectable:f,nodesFocusable:g,resizeObserver:d,noDragClassName:a,noPanClassName:u,disableKeyboardA11y:y,rfId:p,nodeTypes:x,nodeClickDistance:w,onError:v}){const{node:h,internals:m,isParent:E}=q(V=>{const W=V.nodeLookup.get(e),G=V.parentLookup.has(e);return{node:W,internals:W.internals,isParent:G}},te);let N=h.type||"default",S=x?.[N]||jn[N];S===void 0&&(v?.("003",ce.error003(N)),N="default",S=jn.default);const M=!!(h.draggable||c&&typeof h.draggable>"u"),k=!!(h.selectable||l&&typeof h.selectable>"u"),A=!!(h.connectable||f&&typeof h.connectable>"u"),$=!!(h.focusable||g&&typeof h.focusable>"u"),H=ee(),_=uo(h),I=Oc({node:h,nodeType:N,hasDimensions:_,resizeObserver:d}),D=Bo({nodeRef:I,disabled:h.hidden||!M,noDragClassName:a,handleSelector:h.dragHandle,nodeId:e,isSelectable:k,nodeClickDistance:w}),z=Vo();if(h.hidden)return null;const P=de(h),R=Ac(h),T=k||M||t||n||o||s,O=n?V=>n(V,{...m.userNode}):void 0,j=o?V=>o(V,{...m.userNode}):void 0,L=s?V=>s(V,{...m.userNode}):void 0,Z=r?V=>r(V,{...m.userNode}):void 0,U=i?V=>i(V,{...m.userNode}):void 0,X=V=>{const{selectNodesOnDrag:W,nodeDragThreshold:G}=H.getState();k&&(!W||!M||G>0)&&Rt({id:e,store:H,nodeRef:I}),t&&t(V,{...m.userNode})},Y=V=>{if(!(ho(V.nativeEvent)||y))if(to.includes(V.key)&&k){const W=V.key==="Escape";Rt({id:e,store:H,unselect:W,nodeRef:I})}else M&&h.selected&&Object.prototype.hasOwnProperty.call(ot,V.key)&&(V.preventDefault(),H.setState({ariaLiveMessage:`Moved selected node ${V.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~m.positionAbsolute.x}, y: ${~~m.positionAbsolute.y}`}),z({direction:ot[V.key],factor:V.shiftKey?4:1}))};return b.jsx("div",{className:oe(["react-flow__node",`react-flow__node-${N}`,{[u]:M},h.className,{selected:h.selected,selectable:k,parent:E,draggable:M,dragging:D}]),ref:I,style:{zIndex:m.z,transform:`translate(${m.positionAbsolute.x}px,${m.positionAbsolute.y}px)`,pointerEvents:T?"all":"none",visibility:_?"visible":"hidden",...h.style,...R},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:O,onMouseMove:j,onMouseLeave:L,onContextMenu:Z,onClick:X,onDoubleClick:U,onKeyDown:$?Y:void 0,tabIndex:$?0:void 0,role:$?"button":void 0,"aria-describedby":y?void 0:`${Do}-${p}`,"aria-label":h.ariaLabel,children:b.jsx(Ec,{value:e,children:b.jsx(S,{id:e,data:h.data,type:N,positionAbsoluteX:m.positionAbsolute.x,positionAbsoluteY:m.positionAbsolute.y,selected:h.selected??!1,selectable:k,draggable:M,deletable:h.deletable??!0,isConnectable:A,sourcePosition:h.sourcePosition,targetPosition:h.targetPosition,dragging:D,dragHandle:h.dragHandle,zIndex:m.z,parentId:h.parentId,...P})})})}const Vc=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Zo(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:s,onError:r}=q(Vc,te),i=Rc(e.onlyRenderVisibleElements),c=zc();return b.jsx("div",{className:"react-flow__nodes",style:dt,children:i.map(l=>b.jsx(Bc,{id:l,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:c,nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:s,nodeClickDistance:e.nodeClickDistance,onError:r},l))})}Zo.displayName="NodeRenderer";const Lc=C.memo(Zo);function Fc(e){return q(C.useCallback(n=>{if(!e)return n.edges.map(s=>s.id);const o=[];if(n.width&&n.height)for(const s of n.edges){const r=n.nodeLookup.get(s.source),i=n.nodeLookup.get(s.target);r&&i&&Zr({sourceNode:r,targetNode:i,width:n.width,height:n.height,transform:n.transform})&&o.push(s.id)}return o},[e]),te)}const Zc=({color:e="none",strokeWidth:t=1})=>b.jsx("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),Yc=({color:e="none",strokeWidth:t=1})=>b.jsx("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),On={[Je.Arrow]:Zc,[Je.ArrowClosed]:Yc};function Wc(e){const t=ee();return C.useMemo(()=>Object.prototype.hasOwnProperty.call(On,e)?On[e]:(t.getState().onError?.("009",ce.error009(e)),null),[e])}const Xc=({id:e,type:t,color:n,width:o=12.5,height:s=12.5,markerUnits:r="strokeWidth",strokeWidth:i,orient:c="auto-start-reverse"})=>{const l=Wc(t);return l?b.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${o}`,markerHeight:`${s}`,viewBox:"-10 -10 20 20",markerUnits:r,orient:c,refX:"0",refY:"0",children:b.jsx(l,{color:n,strokeWidth:i})}):null},Yo=({defaultColor:e,rfId:t})=>{const n=q(r=>r.edges),o=q(r=>r.defaultEdgeOptions),s=C.useMemo(()=>Qr(n,{id:t,defaultColor:e,defaultMarkerStart:o?.markerStart,defaultMarkerEnd:o?.markerEnd}),[n,o,t,e]);return s.length?b.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:b.jsx("defs",{children:s.map(r=>b.jsx(Xc,{id:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient},r.id))})}):null};Yo.displayName="MarkerDefinitions";var Gc=C.memo(Yo);function Wo({x:e,y:t,label:n,labelStyle:o,labelShowBg:s=!0,labelBgStyle:r,labelBgPadding:i=[2,4],labelBgBorderRadius:c=2,children:l,className:f,...g}){const[d,a]=C.useState({x:1,y:0,width:0,height:0}),u=oe(["react-flow__edge-textwrapper",f]),y=C.useRef(null);return C.useEffect(()=>{if(y.current){const p=y.current.getBBox();a({x:p.x,y:p.y,width:p.width,height:p.height})}},[n]),n?b.jsxs("g",{transform:`translate(${e-d.width/2} ${t-d.height/2})`,className:u,visibility:d.width?"visible":"hidden",...g,children:[s&&b.jsx("rect",{width:d.width+2*i[0],x:-i[0],y:-i[1],height:d.height+2*i[1],className:"react-flow__edge-textbg",style:r,rx:c,ry:c}),b.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:y,style:o,children:n}),l]}):null}Wo.displayName="EdgeText";const Uc=C.memo(Wo);function ut({path:e,labelX:t,labelY:n,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:i,labelBgPadding:c,labelBgBorderRadius:l,interactionWidth:f=20,...g}){return b.jsxs(b.Fragment,{children:[b.jsx("path",{...g,d:e,fill:"none",className:oe(["react-flow__edge-path",g.className])}),f&&b.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),o&&ie(t)&&ie(n)?b.jsx(Uc,{x:t,y:n,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:i,labelBgPadding:c,labelBgBorderRadius:l}):null]})}function Bn({pos:e,x1:t,y1:n,x2:o,y2:s}){return e===B.Left||e===B.Right?[.5*(t+o),n]:[t,.5*(n+s)]}function Xo({sourceX:e,sourceY:t,sourcePosition:n=B.Bottom,targetX:o,targetY:s,targetPosition:r=B.Top}){const[i,c]=Bn({pos:n,x1:e,y1:t,x2:o,y2:s}),[l,f]=Bn({pos:r,x1:o,y1:s,x2:e,y2:t}),[g,d,a,u]=mo({sourceX:e,sourceY:t,targetX:o,targetY:s,sourceControlX:i,sourceControlY:c,targetControlX:l,targetControlY:f});return[`M${e},${t} C${i},${c} ${l},${f} ${o},${s}`,g,d,a,u]}function Go(e){return C.memo(({id:t,sourceX:n,sourceY:o,targetX:s,targetY:r,sourcePosition:i,targetPosition:c,label:l,labelStyle:f,labelShowBg:g,labelBgStyle:d,labelBgPadding:a,labelBgBorderRadius:u,style:y,markerEnd:p,markerStart:x,interactionWidth:w})=>{const[v,h,m]=Xo({sourceX:n,sourceY:o,sourcePosition:i,targetX:s,targetY:r,targetPosition:c}),E=e.isInternal?void 0:t;return b.jsx(ut,{id:E,path:v,labelX:h,labelY:m,label:l,labelStyle:f,labelShowBg:g,labelBgStyle:d,labelBgPadding:a,labelBgBorderRadius:u,style:y,markerEnd:p,markerStart:x,interactionWidth:w})})}const qc=Go({isInternal:!1}),Uo=Go({isInternal:!0});qc.displayName="SimpleBezierEdge";Uo.displayName="SimpleBezierEdgeInternal";function qo(e){return C.memo(({id:t,sourceX:n,sourceY:o,targetX:s,targetY:r,label:i,labelStyle:c,labelShowBg:l,labelBgStyle:f,labelBgPadding:g,labelBgBorderRadius:d,style:a,sourcePosition:u=B.Bottom,targetPosition:y=B.Top,markerEnd:p,markerStart:x,pathOptions:w,interactionWidth:v})=>{const[h,m,E]=Dt({sourceX:n,sourceY:o,sourcePosition:u,targetX:s,targetY:r,targetPosition:y,borderRadius:w?.borderRadius,offset:w?.offset}),N=e.isInternal?void 0:t;return b.jsx(ut,{id:N,path:h,labelX:m,labelY:E,label:i,labelStyle:c,labelShowBg:l,labelBgStyle:f,labelBgPadding:g,labelBgBorderRadius:d,style:a,markerEnd:p,markerStart:x,interactionWidth:v})})}const Ko=qo({isInternal:!1}),Qo=qo({isInternal:!0});Ko.displayName="SmoothStepEdge";Qo.displayName="SmoothStepEdgeInternal";function Jo(e){return C.memo(({id:t,...n})=>{const o=e.isInternal?void 0:t;return b.jsx(Ko,{...n,id:o,pathOptions:C.useMemo(()=>({borderRadius:0,offset:n.pathOptions?.offset}),[n.pathOptions?.offset])})})}const Kc=Jo({isInternal:!1}),es=Jo({isInternal:!0});Kc.displayName="StepEdge";es.displayName="StepEdgeInternal";function ts(e){return C.memo(({id:t,sourceX:n,sourceY:o,targetX:s,targetY:r,label:i,labelStyle:c,labelShowBg:l,labelBgStyle:f,labelBgPadding:g,labelBgBorderRadius:d,style:a,markerEnd:u,markerStart:y,interactionWidth:p})=>{const[x,w,v]=wo({sourceX:n,sourceY:o,targetX:s,targetY:r}),h=e.isInternal?void 0:t;return b.jsx(ut,{id:h,path:x,labelX:w,labelY:v,label:i,labelStyle:c,labelShowBg:l,labelBgStyle:f,labelBgPadding:g,labelBgBorderRadius:d,style:a,markerEnd:u,markerStart:y,interactionWidth:p})})}const Qc=ts({isInternal:!1}),ns=ts({isInternal:!0});Qc.displayName="StraightEdge";ns.displayName="StraightEdgeInternal";function os(e){return C.memo(({id:t,sourceX:n,sourceY:o,targetX:s,targetY:r,sourcePosition:i=B.Bottom,targetPosition:c=B.Top,label:l,labelStyle:f,labelShowBg:g,labelBgStyle:d,labelBgPadding:a,labelBgBorderRadius:u,style:y,markerEnd:p,markerStart:x,pathOptions:w,interactionWidth:v})=>{const[h,m,E]=yo({sourceX:n,sourceY:o,sourcePosition:i,targetX:s,targetY:r,targetPosition:c,curvature:w?.curvature}),N=e.isInternal?void 0:t;return b.jsx(ut,{id:N,path:h,labelX:m,labelY:E,label:l,labelStyle:f,labelShowBg:g,labelBgStyle:d,labelBgPadding:a,labelBgBorderRadius:u,style:y,markerEnd:p,markerStart:x,interactionWidth:v})})}const Jc=os({isInternal:!1}),ss=os({isInternal:!0});Jc.displayName="BezierEdge";ss.displayName="BezierEdgeInternal";const Vn={default:ss,straight:ns,step:es,smoothstep:Qo,simplebezier:Uo},Ln={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},ea=(e,t,n)=>n===B.Left?e-t:n===B.Right?e+t:e,ta=(e,t,n)=>n===B.Top?e-t:n===B.Bottom?e+t:e,Fn="react-flow__edgeupdater";function Zn({position:e,centerX:t,centerY:n,radius:o=10,onMouseDown:s,onMouseEnter:r,onMouseOut:i,type:c}){return b.jsx("circle",{onMouseDown:s,onMouseEnter:r,onMouseOut:i,className:oe([Fn,`${Fn}-${c}`]),cx:ea(t,o,e),cy:ta(n,o,e),r:o,stroke:"transparent",fill:"transparent"})}function na({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:o,sourceY:s,targetX:r,targetY:i,sourcePosition:c,targetPosition:l,onReconnect:f,onReconnectStart:g,onReconnectEnd:d,setReconnecting:a,setUpdateHover:u}){const y=ee(),p=(m,E)=>{if(m.button!==0)return;const{autoPanOnConnect:N,domNode:S,isValidConnection:M,connectionMode:k,connectionRadius:A,lib:$,onConnectStart:H,onConnectEnd:_,cancelConnection:I,nodeLookup:D,rfId:z,panBy:P,updateConnection:R}=y.getState(),T=E.type==="target";a(!0),g?.(m,n,E.type);const O=(L,Z)=>{a(!1),d?.(L,n,E.type,Z)},j=L=>f?.(n,L);_t.onPointerDown(m.nativeEvent,{autoPanOnConnect:N,connectionMode:k,connectionRadius:A,domNode:S,handleId:E.id,nodeId:E.nodeId,nodeLookup:D,isTarget:T,edgeUpdaterType:E.type,lib:$,flowId:z,cancelConnection:I,panBy:P,isValidConnection:M,onConnect:j,onConnectStart:H,onConnectEnd:_,onReconnectEnd:O,updateConnection:R,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle})},x=m=>p(m,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),w=m=>p(m,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),v=()=>u(!0),h=()=>u(!1);return b.jsxs(b.Fragment,{children:[(e===!0||e==="source")&&b.jsx(Zn,{position:c,centerX:o,centerY:s,radius:t,onMouseDown:x,onMouseEnter:v,onMouseOut:h,type:"source"}),(e===!0||e==="target")&&b.jsx(Zn,{position:l,centerX:r,centerY:i,radius:t,onMouseDown:w,onMouseEnter:v,onMouseOut:h,type:"target"})]})}function oa({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:o,onClick:s,onDoubleClick:r,onContextMenu:i,onMouseEnter:c,onMouseMove:l,onMouseLeave:f,reconnectRadius:g,onReconnect:d,onReconnectStart:a,onReconnectEnd:u,rfId:y,edgeTypes:p,noPanClassName:x,onError:w,disableKeyboardA11y:v}){let h=q(F=>F.edgeLookup.get(e));const m=q(F=>F.defaultEdgeOptions);h=m?{...m,...h}:h;let E=h.type||"default",N=p?.[E]||Vn[E];N===void 0&&(w?.("011",ce.error011(E)),E="default",N=Vn.default);const S=!!(h.focusable||t&&typeof h.focusable>"u"),M=typeof d<"u"&&(h.reconnectable||n&&typeof h.reconnectable>"u"),k=!!(h.selectable||o&&typeof h.selectable>"u"),A=C.useRef(null),[$,H]=C.useState(!1),[_,I]=C.useState(!1),D=ee(),{zIndex:z,sourceX:P,sourceY:R,targetX:T,targetY:O,sourcePosition:j,targetPosition:L}=q(C.useCallback(F=>{const ne=F.nodeLookup.get(h.source),J=F.nodeLookup.get(h.target);if(!ne||!J)return{zIndex:h.zIndex,...Ln};const se=Kr({id:e,sourceNode:ne,targetNode:J,sourceHandle:h.sourceHandle||null,targetHandle:h.targetHandle||null,connectionMode:F.connectionMode,onError:w});return{zIndex:Fr({selected:h.selected,zIndex:h.zIndex,sourceNode:ne,targetNode:J,elevateOnSelect:F.elevateEdgesOnSelect}),...se||Ln}},[h.source,h.target,h.sourceHandle,h.targetHandle,h.selected,h.zIndex]),te),Z=C.useMemo(()=>h.markerStart?`url('#${Ht(h.markerStart,y)}')`:void 0,[h.markerStart,y]),U=C.useMemo(()=>h.markerEnd?`url('#${Ht(h.markerEnd,y)}')`:void 0,[h.markerEnd,y]);if(h.hidden||P===null||R===null||T===null||O===null)return null;const X=F=>{const{addSelectedEdges:ne,unselectNodesAndEdges:J,multiSelectionActive:se}=D.getState();k&&(D.setState({nodesSelectionActive:!1}),h.selected&&se?(J({nodes:[],edges:[h]}),A.current?.blur()):ne([e])),s&&s(F,h)},Y=r?F=>{r(F,{...h})}:void 0,V=i?F=>{i(F,{...h})}:void 0,W=c?F=>{c(F,{...h})}:void 0,G=l?F=>{l(F,{...h})}:void 0,Q=f?F=>{f(F,{...h})}:void 0,K=F=>{if(!v&&to.includes(F.key)&&k){const{unselectNodesAndEdges:ne,addSelectedEdges:J}=D.getState();F.key==="Escape"?(A.current?.blur(),ne({edges:[h]})):J([e])}};return b.jsx("svg",{style:{zIndex:z},children:b.jsxs("g",{className:oe(["react-flow__edge",`react-flow__edge-${E}`,h.className,x,{selected:h.selected,animated:h.animated,inactive:!k&&!s,updating:$,selectable:k}]),onClick:X,onDoubleClick:Y,onContextMenu:V,onMouseEnter:W,onMouseMove:G,onMouseLeave:Q,onKeyDown:S?K:void 0,tabIndex:S?0:void 0,role:S?"button":"img","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":h.ariaLabel===null?void 0:h.ariaLabel||`Edge from ${h.source} to ${h.target}`,"aria-describedby":S?`${Ho}-${y}`:void 0,ref:A,children:[!_&&b.jsx(N,{id:e,source:h.source,target:h.target,type:h.type,selected:h.selected,animated:h.animated,selectable:k,deletable:h.deletable??!0,label:h.label,labelStyle:h.labelStyle,labelShowBg:h.labelShowBg,labelBgStyle:h.labelBgStyle,labelBgPadding:h.labelBgPadding,labelBgBorderRadius:h.labelBgBorderRadius,sourceX:P,sourceY:R,targetX:T,targetY:O,sourcePosition:j,targetPosition:L,data:h.data,style:h.style,sourceHandleId:h.sourceHandle,targetHandleId:h.targetHandle,markerStart:Z,markerEnd:U,pathOptions:"pathOptions"in h?h.pathOptions:void 0,interactionWidth:h.interactionWidth}),M&&b.jsx(na,{edge:h,isReconnectable:M,reconnectRadius:g,onReconnect:d,onReconnectStart:a,onReconnectEnd:u,sourceX:P,sourceY:R,targetX:T,targetY:O,sourcePosition:j,targetPosition:L,setUpdateHover:H,setReconnecting:I})]})})}const sa=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function rs({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:o,noPanClassName:s,onReconnect:r,onEdgeContextMenu:i,onEdgeMouseEnter:c,onEdgeMouseMove:l,onEdgeMouseLeave:f,onEdgeClick:g,reconnectRadius:d,onEdgeDoubleClick:a,onReconnectStart:u,onReconnectEnd:y,disableKeyboardA11y:p}){const{edgesFocusable:x,edgesReconnectable:w,elementsSelectable:v,onError:h}=q(sa,te),m=Fc(t);return b.jsxs("div",{className:"react-flow__edges",children:[b.jsx(Gc,{defaultColor:e,rfId:n}),m.map(E=>b.jsx(oa,{id:E,edgesFocusable:x,edgesReconnectable:w,elementsSelectable:v,noPanClassName:s,onReconnect:r,onContextMenu:i,onMouseEnter:c,onMouseMove:l,onMouseLeave:f,onClick:g,reconnectRadius:d,onDoubleClick:a,onReconnectStart:u,onReconnectEnd:y,rfId:n,onError:h,edgeTypes:o,disableKeyboardA11y:p},E))]})}rs.displayName="EdgeRenderer";const ra=C.memo(rs),ia=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function ca({children:e}){const t=q(ia);return b.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function aa(e){const t=Xt(),n=C.useRef(!1);C.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const la=e=>e.panZoom?.syncViewport;function da(e){const t=q(la),n=ee();return C.useEffect(()=>{e&&(t?.(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function ua(e){return e.connection.inProgress?{...e.connection,to:Ye(e.connection.to,e.transform)}:{...e.connection}}function fa(e){return ua}function ga(e){const t=fa();return q(t,te)}const ha=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function pa({containerStyle:e,style:t,type:n,component:o}){const{nodesConnectable:s,width:r,height:i,isValid:c,inProgress:l}=q(ha,te);return!(r&&s&&l)?null:b.jsx("svg",{style:e,width:r,height:i,className:"react-flow__connectionline react-flow__container",children:b.jsx("g",{className:oe(["react-flow__connection",oo(c)]),children:b.jsx(is,{style:t,type:n,CustomComponent:o,isValid:c})})})}const is=({style:e,type:t=ge.Bezier,CustomComponent:n,isValid:o})=>{const{inProgress:s,from:r,fromNode:i,fromHandle:c,fromPosition:l,to:f,toNode:g,toHandle:d,toPosition:a}=ga();if(!s)return;if(n)return b.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:c,fromX:r.x,fromY:r.y,toX:f.x,toY:f.y,fromPosition:l,toPosition:a,connectionStatus:oo(o),toNode:g,toHandle:d});let u="";const y={sourceX:r.x,sourceY:r.y,sourcePosition:l,targetX:f.x,targetY:f.y,targetPosition:a};switch(t){case ge.Bezier:[u]=yo(y);break;case ge.SimpleBezier:[u]=Xo(y);break;case ge.Step:[u]=Dt({...y,borderRadius:0});break;case ge.SmoothStep:[u]=Dt(y);break;default:[u]=wo(y)}return b.jsx("path",{d:u,fill:"none",className:"react-flow__connection-path",style:e})};is.displayName="ConnectionLine";const ma={};function Yn(e=ma){C.useRef(e),ee(),C.useEffect(()=>{},[e])}function ya(){ee(),C.useRef(!1),C.useEffect(()=>{},[])}function cs({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:o,onEdgeClick:s,onNodeDoubleClick:r,onEdgeDoubleClick:i,onNodeMouseEnter:c,onNodeMouseMove:l,onNodeMouseLeave:f,onNodeContextMenu:g,onSelectionContextMenu:d,onSelectionStart:a,onSelectionEnd:u,connectionLineType:y,connectionLineStyle:p,connectionLineComponent:x,connectionLineContainerStyle:w,selectionKeyCode:v,selectionOnDrag:h,selectionMode:m,multiSelectionKeyCode:E,panActivationKeyCode:N,zoomActivationKeyCode:S,deleteKeyCode:M,onlyRenderVisibleElements:k,elementsSelectable:A,defaultViewport:$,translateExtent:H,minZoom:_,maxZoom:I,preventScrolling:D,defaultMarkerColor:z,zoomOnScroll:P,zoomOnPinch:R,panOnScroll:T,panOnScrollSpeed:O,panOnScrollMode:j,zoomOnDoubleClick:L,panOnDrag:Z,onPaneClick:U,onPaneMouseEnter:X,onPaneMouseMove:Y,onPaneMouseLeave:V,onPaneScroll:W,onPaneContextMenu:G,paneClickDistance:Q,nodeClickDistance:K,onEdgeContextMenu:F,onEdgeMouseEnter:ne,onEdgeMouseMove:J,onEdgeMouseLeave:se,reconnectRadius:re,onReconnect:xe,onReconnectStart:ft,onReconnectEnd:gt,noDragClassName:$e,noWheelClassName:ht,noPanClassName:De,disableKeyboardA11y:He,nodeExtent:pt,rfId:we,viewport:be,onViewportChange:We}){return Yn(e),Yn(t),ya(),aa(n),da(be),b.jsx(Tc,{onPaneClick:U,onPaneMouseEnter:X,onPaneMouseMove:Y,onPaneMouseLeave:V,onPaneContextMenu:G,onPaneScroll:W,paneClickDistance:Q,deleteKeyCode:M,selectionKeyCode:v,selectionOnDrag:h,selectionMode:m,onSelectionStart:a,onSelectionEnd:u,multiSelectionKeyCode:E,panActivationKeyCode:N,zoomActivationKeyCode:S,elementsSelectable:A,zoomOnScroll:P,zoomOnPinch:R,zoomOnDoubleClick:L,panOnScroll:T,panOnScrollSpeed:O,panOnScrollMode:j,panOnDrag:Z,defaultViewport:$,translateExtent:H,minZoom:_,maxZoom:I,onSelectionContextMenu:d,preventScrolling:D,noDragClassName:$e,noWheelClassName:ht,noPanClassName:De,disableKeyboardA11y:He,onViewportChange:We,isControlledViewport:!!be,children:b.jsxs(ca,{children:[b.jsx(ra,{edgeTypes:t,onEdgeClick:s,onEdgeDoubleClick:i,onReconnect:xe,onReconnectStart:ft,onReconnectEnd:gt,onlyRenderVisibleElements:k,onEdgeContextMenu:F,onEdgeMouseEnter:ne,onEdgeMouseMove:J,onEdgeMouseLeave:se,reconnectRadius:re,defaultMarkerColor:z,noPanClassName:De,disableKeyboardA11y:He,rfId:we}),b.jsx(pa,{style:p,type:y,component:x,containerStyle:w}),b.jsx("div",{className:"react-flow__edgelabel-renderer"}),b.jsx(Lc,{nodeTypes:e,onNodeClick:o,onNodeDoubleClick:r,onNodeMouseEnter:c,onNodeMouseMove:l,onNodeMouseLeave:f,onNodeContextMenu:g,nodeClickDistance:K,onlyRenderVisibleElements:k,noPanClassName:De,noDragClassName:$e,disableKeyboardA11y:He,nodeExtent:pt,rfId:we}),b.jsx("div",{className:"react-flow__viewport-portal"})]})})}cs.displayName="GraphView";const xa=C.memo(cs),Wn=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:s,height:r,fitView:i,fitViewOptions:c,minZoom:l=.5,maxZoom:f=2,nodeOrigin:g,nodeExtent:d}={})=>{const a=new Map,u=new Map,y=new Map,p=new Map,x=o??t??[],w=n??e??[],v=g??[0,0],h=d??ze;So(y,p,x);const m=Tt(w,a,u,{nodeOrigin:v,nodeExtent:h,elevateNodesOnSelect:!1});let E=[0,0,1];if(i&&s&&r){const N=Ze(a,{filter:A=>!!((A.width||A.initialWidth)&&(A.height||A.initialHeight))}),{x:S,y:M,zoom:k}=Vt(N,s,r,l,f,c?.padding??.1);E=[S,M,k]}return{rfId:"1",width:0,height:0,transform:E,nodes:w,nodesInitialized:m,nodeLookup:a,parentLookup:u,edges:x,edgeLookup:p,connectionLookup:y,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:o!==void 0,panZoom:null,minZoom:l,maxZoom:f,translateExtent:ze,nodeExtent:h,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Ie.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:v,nodeDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:c,fitViewResolver:null,connection:{...no},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanSpeed:15,connectionRadius:20,onError:zr,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1}},wa=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:s,height:r,fitView:i,fitViewOptions:c,minZoom:l,maxZoom:f,nodeOrigin:g,nodeExtent:d})=>Oi((a,u)=>{async function y(){const{nodeLookup:p,panZoom:x,fitViewOptions:w,fitViewResolver:v,width:h,height:m,minZoom:E,maxZoom:N}=u();x&&(await Rr({nodes:p,width:h,height:m,panZoom:x,minZoom:E,maxZoom:N},w),v?.resolve(!0),a({fitViewResolver:null}))}return{...Wn({nodes:e,edges:t,width:s,height:r,fitView:i,fitViewOptions:c,minZoom:l,maxZoom:f,nodeOrigin:g,nodeExtent:d,defaultNodes:n,defaultEdges:o}),setNodes:p=>{const{nodeLookup:x,parentLookup:w,nodeOrigin:v,elevateNodesOnSelect:h,fitViewQueued:m}=u(),E=Tt(p,x,w,{nodeOrigin:v,nodeExtent:d,elevateNodesOnSelect:h,checkEquality:!0});m&&E?(y(),a({nodes:p,nodesInitialized:E,fitViewQueued:!1,fitViewOptions:void 0})):a({nodes:p,nodesInitialized:E})},setEdges:p=>{const{connectionLookup:x,edgeLookup:w}=u();So(x,w,p),a({edges:p})},setDefaultNodesAndEdges:(p,x)=>{if(p){const{setNodes:w}=u();w(p),a({hasDefaultNodes:!0})}if(x){const{setEdges:w}=u();w(x),a({hasDefaultEdges:!0})}},updateNodeInternals:p=>{const{triggerNodeChanges:x,nodeLookup:w,parentLookup:v,domNode:h,nodeOrigin:m,nodeExtent:E,debug:N,fitViewQueued:S}=u(),{changes:M,updatedInternals:k}=oi(p,w,v,h,m,E);k&&(ei(w,v,{nodeOrigin:m,nodeExtent:E}),S?(y(),a({fitViewQueued:!1,fitViewOptions:void 0})):a({}),M?.length>0&&(N&&console.log("React Flow: trigger node changes",M),x?.(M)))},updateNodePositions:(p,x=!1)=>{const w=[],v=[],{nodeLookup:h,triggerNodeChanges:m}=u();for(const[E,N]of p){const S=h.get(E),M=!!(S?.expandParent&&S?.parentId&&N?.position),k={id:E,type:"position",position:M?{x:Math.max(0,N.position.x),y:Math.max(0,N.position.y)}:N.position,dragging:x};M&&S.parentId&&w.push({id:E,parentId:S.parentId,rect:{...N.internals.positionAbsolute,width:N.measured.width??0,height:N.measured.height??0}}),v.push(k)}if(w.length>0){const{parentLookup:E,nodeOrigin:N}=u(),S=Wt(w,h,E,N);v.push(...S)}m(v)},triggerNodeChanges:p=>{const{onNodesChange:x,setNodes:w,nodes:v,hasDefaultNodes:h,debug:m}=u();if(p?.length){if(h){const E=Ro(p,v);w(E)}m&&console.log("React Flow: trigger node changes",p),x?.(p)}},triggerEdgeChanges:p=>{const{onEdgesChange:x,setEdges:w,edges:v,hasDefaultEdges:h,debug:m}=u();if(p?.length){if(h){const E=jo(p,v);w(E)}m&&console.log("React Flow: trigger edge changes",p),x?.(p)}},addSelectedNodes:p=>{const{multiSelectionActive:x,edgeLookup:w,nodeLookup:v,triggerNodeChanges:h,triggerEdgeChanges:m}=u();if(x){const E=p.map(N=>pe(N,!0));h(E);return}h(Ce(v,new Set([...p]),!0)),m(Ce(w))},addSelectedEdges:p=>{const{multiSelectionActive:x,edgeLookup:w,nodeLookup:v,triggerNodeChanges:h,triggerEdgeChanges:m}=u();if(x){const E=p.map(N=>pe(N,!0));m(E);return}m(Ce(w,new Set([...p]))),h(Ce(v,new Set,!0))},unselectNodesAndEdges:({nodes:p,edges:x}={})=>{const{edges:w,nodes:v,nodeLookup:h,triggerNodeChanges:m,triggerEdgeChanges:E}=u(),N=p||v,S=x||w,M=N.map(A=>{const $=h.get(A.id);return $&&($.selected=!1),pe(A.id,!1)}),k=S.map(A=>pe(A.id,!1));m(M),E(k)},setMinZoom:p=>{const{panZoom:x,maxZoom:w}=u();x?.setScaleExtent([p,w]),a({minZoom:p})},setMaxZoom:p=>{const{panZoom:x,minZoom:w}=u();x?.setScaleExtent([w,p]),a({maxZoom:p})},setTranslateExtent:p=>{u().panZoom?.setTranslateExtent(p),a({translateExtent:p})},setPaneClickDistance:p=>{u().panZoom?.setClickDistance(p)},resetSelectedElements:()=>{const{edges:p,nodes:x,triggerNodeChanges:w,triggerEdgeChanges:v,elementsSelectable:h}=u();if(!h)return;const m=x.reduce((N,S)=>S.selected?[...N,pe(S.id,!1)]:N,[]),E=p.reduce((N,S)=>S.selected?[...N,pe(S.id,!1)]:N,[]);w(m),v(E)},setNodeExtent:p=>{const{nodes:x,nodeLookup:w,parentLookup:v,nodeOrigin:h,elevateNodesOnSelect:m,nodeExtent:E}=u();p[0][0]===E[0][0]&&p[0][1]===E[0][1]&&p[1][0]===E[1][0]&&p[1][1]===E[1][1]||(Tt(x,w,v,{nodeOrigin:h,nodeExtent:p,elevateNodesOnSelect:m,checkEquality:!1}),a({nodeExtent:p}))},panBy:p=>{const{transform:x,width:w,height:v,panZoom:h,translateExtent:m}=u();return si({delta:p,panZoom:h,transform:x,translateExtent:m,width:w,height:v})},cancelConnection:()=>{a({connection:{...no}})},updateConnection:p=>{a({connection:p})},reset:()=>a({...Wn()})}},Object.is);function ba({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:o,initialWidth:s,initialHeight:r,initialMinZoom:i,initialMaxZoom:c,initialFitViewOptions:l,fitView:f,nodeOrigin:g,nodeExtent:d,children:a}){const[u]=C.useState(()=>wa({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:s,height:r,fitView:f,minZoom:i,maxZoom:c,fitViewOptions:l,nodeOrigin:g,nodeExtent:d}));return b.jsx(Bi,{value:u,children:b.jsx(lc,{children:a})})}function Sa({children:e,nodes:t,edges:n,defaultNodes:o,defaultEdges:s,width:r,height:i,fitView:c,fitViewOptions:l,minZoom:f,maxZoom:g,nodeOrigin:d,nodeExtent:a}){return C.useContext(at)?b.jsx(b.Fragment,{children:e}):b.jsx(ba,{initialNodes:t,initialEdges:n,defaultNodes:o,defaultEdges:s,initialWidth:r,initialHeight:i,fitView:c,initialFitViewOptions:l,initialMinZoom:f,initialMaxZoom:g,nodeOrigin:d,nodeExtent:a,children:e})}const Ea={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function va({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,className:s,nodeTypes:r,edgeTypes:i,onNodeClick:c,onEdgeClick:l,onInit:f,onMove:g,onMoveStart:d,onMoveEnd:a,onConnect:u,onConnectStart:y,onConnectEnd:p,onClickConnectStart:x,onClickConnectEnd:w,onNodeMouseEnter:v,onNodeMouseMove:h,onNodeMouseLeave:m,onNodeContextMenu:E,onNodeDoubleClick:N,onNodeDragStart:S,onNodeDrag:M,onNodeDragStop:k,onNodesDelete:A,onEdgesDelete:$,onDelete:H,onSelectionChange:_,onSelectionDragStart:I,onSelectionDrag:D,onSelectionDragStop:z,onSelectionContextMenu:P,onSelectionStart:R,onSelectionEnd:T,onBeforeDelete:O,connectionMode:j,connectionLineType:L=ge.Bezier,connectionLineStyle:Z,connectionLineComponent:U,connectionLineContainerStyle:X,deleteKeyCode:Y="Backspace",selectionKeyCode:V="Shift",selectionOnDrag:W=!1,selectionMode:G=Oe.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:K=nt()?"Meta":"Control",zoomActivationKeyCode:F=nt()?"Meta":"Control",snapToGrid:ne,snapGrid:J,onlyRenderVisibleElements:se=!1,selectNodesOnDrag:re,nodesDraggable:xe,nodesConnectable:ft,nodesFocusable:gt,nodeOrigin:$e=To,edgesFocusable:ht,edgesReconnectable:De,elementsSelectable:He=!0,defaultViewport:pt=Ji,minZoom:we=.5,maxZoom:be=2,translateExtent:We=ze,preventScrolling:ys=!0,nodeExtent:mt,defaultMarkerColor:xs="#b1b1b7",zoomOnScroll:ws=!0,zoomOnPinch:bs=!0,panOnScroll:Ss=!1,panOnScrollSpeed:Es=.5,panOnScrollMode:vs=me.Free,zoomOnDoubleClick:Ns=!0,panOnDrag:Cs=!0,onPaneClick:Ms,onPaneMouseEnter:Is,onPaneMouseMove:ks,onPaneMouseLeave:Ps,onPaneScroll:As,onPaneContextMenu:$s,paneClickDistance:Ut=0,nodeClickDistance:Ds=0,children:Hs,onReconnect:Ts,onReconnectStart:_s,onReconnectEnd:Rs,onEdgeContextMenu:js,onEdgeDoubleClick:zs,onEdgeMouseEnter:Os,onEdgeMouseMove:Bs,onEdgeMouseLeave:Vs,reconnectRadius:Ls=10,onNodesChange:Fs,onEdgesChange:Zs,noDragClassName:Ys="nodrag",noWheelClassName:Ws="nowheel",noPanClassName:qt="nopan",fitView:Kt,fitViewOptions:Qt,connectOnClick:Xs,attributionPosition:Gs,proOptions:Us,defaultEdgeOptions:qs,elevateNodesOnSelect:Ks,elevateEdgesOnSelect:Qs,disableKeyboardA11y:Jt=!1,autoPanOnConnect:Js,autoPanOnNodeDrag:er,autoPanSpeed:tr,connectionRadius:nr,isValidConnection:or,onError:sr,style:rr,id:en,nodeDragThreshold:ir,viewport:cr,onViewportChange:ar,width:lr,height:dr,colorMode:ur="light",debug:fr,onScroll:tn,...gr},hr){const yt=en||"1",pr=oc(ur),mr=C.useCallback(nn=>{nn.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),tn?.(nn)},[tn]);return b.jsx("div",{"data-testid":"rf__wrapper",...gr,onScroll:mr,style:{...rr,...Ea},ref:hr,className:oe(["react-flow",s,pr]),id:en,children:b.jsxs(Sa,{nodes:e,edges:t,width:lr,height:dr,fitView:Kt,fitViewOptions:Qt,minZoom:we,maxZoom:be,nodeOrigin:$e,nodeExtent:mt,children:[b.jsx(xa,{onInit:f,onNodeClick:c,onEdgeClick:l,onNodeMouseEnter:v,onNodeMouseMove:h,onNodeMouseLeave:m,onNodeContextMenu:E,onNodeDoubleClick:N,nodeTypes:r,edgeTypes:i,connectionLineType:L,connectionLineStyle:Z,connectionLineComponent:U,connectionLineContainerStyle:X,selectionKeyCode:V,selectionOnDrag:W,selectionMode:G,deleteKeyCode:Y,multiSelectionKeyCode:K,panActivationKeyCode:Q,zoomActivationKeyCode:F,onlyRenderVisibleElements:se,defaultViewport:pt,translateExtent:We,minZoom:we,maxZoom:be,preventScrolling:ys,zoomOnScroll:ws,zoomOnPinch:bs,zoomOnDoubleClick:Ns,panOnScroll:Ss,panOnScrollSpeed:Es,panOnScrollMode:vs,panOnDrag:Cs,onPaneClick:Ms,onPaneMouseEnter:Is,onPaneMouseMove:ks,onPaneMouseLeave:Ps,onPaneScroll:As,onPaneContextMenu:$s,paneClickDistance:Ut,nodeClickDistance:Ds,onSelectionContextMenu:P,onSelectionStart:R,onSelectionEnd:T,onReconnect:Ts,onReconnectStart:_s,onReconnectEnd:Rs,onEdgeContextMenu:js,onEdgeDoubleClick:zs,onEdgeMouseEnter:Os,onEdgeMouseMove:Bs,onEdgeMouseLeave:Vs,reconnectRadius:Ls,defaultMarkerColor:xs,noDragClassName:Ys,noWheelClassName:Ws,noPanClassName:qt,rfId:yt,disableKeyboardA11y:Jt,nodeExtent:mt,viewport:cr,onViewportChange:ar}),b.jsx(nc,{nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:u,onConnectStart:y,onConnectEnd:p,onClickConnectStart:x,onClickConnectEnd:w,nodesDraggable:xe,nodesConnectable:ft,nodesFocusable:gt,edgesFocusable:ht,edgesReconnectable:De,elementsSelectable:He,elevateNodesOnSelect:Ks,elevateEdgesOnSelect:Qs,minZoom:we,maxZoom:be,nodeExtent:mt,onNodesChange:Fs,onEdgesChange:Zs,snapToGrid:ne,snapGrid:J,connectionMode:j,translateExtent:We,connectOnClick:Xs,defaultEdgeOptions:qs,fitView:Kt,fitViewOptions:Qt,onNodesDelete:A,onEdgesDelete:$,onDelete:H,onNodeDragStart:S,onNodeDrag:M,onNodeDragStop:k,onSelectionDrag:D,onSelectionDragStart:I,onSelectionDragStop:z,onMove:g,onMoveStart:d,onMoveEnd:a,noPanClassName:qt,nodeOrigin:$e,rfId:yt,autoPanOnConnect:Js,autoPanOnNodeDrag:er,autoPanSpeed:tr,onError:sr,connectionRadius:nr,isValidConnection:or,selectNodesOnDrag:re,nodeDragThreshold:ir,onBeforeDelete:O,paneClickDistance:Ut,debug:fr}),b.jsx(Qi,{onSelectionChange:_}),Hs,b.jsx(Xi,{proOptions:Us,position:Gs}),b.jsx(Yi,{rfId:yt,disableKeyboardA11y:Jt})]})})}var Na=zo(va);function Ca(e){const[t,n]=C.useState(e),o=C.useCallback(s=>n(r=>Ro(s,r)),[]);return[t,n,o]}function Ma(e){const[t,n]=C.useState(e),o=C.useCallback(s=>n(r=>jo(s,r)),[]);return[t,n,o]}function Ia({dimensions:e,lineWidth:t,variant:n,className:o}){return b.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:oe(["react-flow__background-pattern",n,o])})}function ka({radius:e,className:t}){return b.jsx("circle",{cx:e,cy:e,r:e,className:oe(["react-flow__background-pattern","dots",t])})}var le;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(le||(le={}));const Pa={[le.Dots]:1,[le.Lines]:1,[le.Cross]:6},Aa=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function as({id:e,variant:t=le.Dots,gap:n=20,size:o,lineWidth:s=1,offset:r=0,color:i,bgColor:c,style:l,className:f,patternClassName:g}){const d=C.useRef(null),{transform:a,patternId:u}=q(Aa,te),y=o||Pa[t],p=t===le.Dots,x=t===le.Cross,w=Array.isArray(n)?n:[n,n],v=[w[0]*a[2]||1,w[1]*a[2]||1],h=y*a[2],m=Array.isArray(r)?r:[r,r],E=x?[h,h]:v,N=[m[0]*a[2]||1+E[0]/2,m[1]*a[2]||1+E[1]/2],S=`${u}${e||""}`;return b.jsxs("svg",{className:oe(["react-flow__background",f]),style:{...l,...dt,"--xy-background-color-props":c,"--xy-background-pattern-color-props":i},ref:d,"data-testid":"rf__background",children:[b.jsx("pattern",{id:S,x:a[0]%v[0],y:a[1]%v[1],width:v[0],height:v[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${N[0]},-${N[1]})`,children:p?b.jsx(ka,{radius:h/2,className:g}):b.jsx(Ia,{dimensions:E,lineWidth:s,variant:t,className:g})}),b.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${S})`})]})}as.displayName="Background";const $a=C.memo(as);function Da(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:b.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Ha(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:b.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Ta(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:b.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function _a(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:b.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Ra(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:b.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Te({children:e,className:t,...n}){return b.jsx("button",{type:"button",className:oe(["react-flow__controls-button",t]),...n,children:e})}const ja=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom});function ls({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:s,onZoomIn:r,onZoomOut:i,onFitView:c,onInteractiveChange:l,className:f,children:g,position:d="bottom-left",orientation:a="vertical","aria-label":u="React Flow controls"}){const y=ee(),{isInteractive:p,minZoomReached:x,maxZoomReached:w}=q(ja,te),{zoomIn:v,zoomOut:h,fitView:m}=Xt(),E=()=>{v(),r?.()},N=()=>{h(),i?.()},S=()=>{m(s),c?.()},M=()=>{y.setState({nodesDraggable:!p,nodesConnectable:!p,elementsSelectable:!p}),l?.(!p)},k=a==="horizontal"?"horizontal":"vertical";return b.jsxs(lt,{className:oe(["react-flow__controls",k,f]),position:d,style:e,"data-testid":"rf__controls","aria-label":u,children:[t&&b.jsxs(b.Fragment,{children:[b.jsx(Te,{onClick:E,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:w,children:b.jsx(Da,{})}),b.jsx(Te,{onClick:N,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:x,children:b.jsx(Ha,{})})]}),n&&b.jsx(Te,{className:"react-flow__controls-fitview",onClick:S,title:"fit view","aria-label":"fit view",children:b.jsx(Ta,{})}),o&&b.jsx(Te,{className:"react-flow__controls-interactive",onClick:M,title:"toggle interactivity","aria-label":"toggle interactivity",children:p?b.jsx(Ra,{}):b.jsx(_a,{})}),g]})}ls.displayName="Controls";const za=C.memo(ls);function Oa({id:e,x:t,y:n,width:o,height:s,style:r,color:i,strokeColor:c,strokeWidth:l,className:f,borderRadius:g,shapeRendering:d,selected:a,onClick:u}){const{background:y,backgroundColor:p}=r||{},x=i||y||p;return b.jsx("rect",{className:oe(["react-flow__minimap-node",{selected:a},f]),x:t,y:n,rx:g,ry:g,width:o,height:s,style:{fill:x,stroke:c,strokeWidth:l},shapeRendering:d,onClick:u?w=>u(w,e):void 0})}const Ba=C.memo(Oa),Va=e=>e.nodes.map(t=>t.id),kt=e=>e instanceof Function?e:()=>e;function La({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:o=5,nodeStrokeWidth:s,nodeComponent:r=Ba,onClick:i}){const c=q(Va,te),l=kt(t),f=kt(e),g=kt(n),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return b.jsx(b.Fragment,{children:c.map(a=>b.jsx(Za,{id:a,nodeColorFunc:l,nodeStrokeColorFunc:f,nodeClassNameFunc:g,nodeBorderRadius:o,nodeStrokeWidth:s,NodeComponent:r,onClick:i,shapeRendering:d},a))})}function Fa({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:o,nodeBorderRadius:s,nodeStrokeWidth:r,shapeRendering:i,NodeComponent:c,onClick:l}){const{node:f,x:g,y:d,width:a,height:u}=q(y=>{const{internals:p}=y.nodeLookup.get(e),x=p.userNode,{x:w,y:v}=p.positionAbsolute,{width:h,height:m}=de(x);return{node:x,x:w,y:v,width:h,height:m}},te);return!f||f.hidden||!uo(f)?null:b.jsx(c,{x:g,y:d,width:a,height:u,style:f.style,selected:!!f.selected,className:o(f),color:t(f),borderRadius:s,strokeColor:n(f),strokeWidth:r,shapeRendering:i,onClick:l,id:f.id})}const Za=C.memo(Fa);var Ya=C.memo(La);const Wa=200,Xa=150,Ga=e=>!e.hidden,Ua=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?lo(Ze(e.nodeLookup,{filter:Ga}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height}},qa="react-flow__minimap-desc";function ds({style:e,className:t,nodeStrokeColor:n,nodeColor:o,nodeClassName:s="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:c,bgColor:l,maskColor:f,maskStrokeColor:g,maskStrokeWidth:d,position:a="bottom-right",onClick:u,onNodeClick:y,pannable:p=!1,zoomable:x=!1,ariaLabel:w="React Flow mini map",inversePan:v,zoomStep:h=10,offsetScale:m=5}){const E=ee(),N=C.useRef(null),{boundingRect:S,viewBB:M,rfId:k,panZoom:A,translateExtent:$,flowWidth:H,flowHeight:_}=q(Ua,te),I=e?.width??Wa,D=e?.height??Xa,z=S.width/I,P=S.height/D,R=Math.max(z,P),T=R*I,O=R*D,j=m*R,L=S.x-(T-S.width)/2-j,Z=S.y-(O-S.height)/2-j,U=T+j*2,X=O+j*2,Y=`${qa}-${k}`,V=C.useRef(0),W=C.useRef();V.current=R,C.useEffect(()=>{if(N.current&&A)return W.current=fi({domNode:N.current,panZoom:A,getTransform:()=>E.getState().transform,getViewScale:()=>V.current}),()=>{W.current?.destroy()}},[A]),C.useEffect(()=>{W.current?.update({translateExtent:$,width:H,height:_,inversePan:v,pannable:p,zoomStep:h,zoomable:x})},[p,x,v,h,$,H,_]);const G=u?K=>{const[F,ne]=W.current?.pointer(K)||[0,0];u(K,{x:F,y:ne})}:void 0,Q=y?C.useCallback((K,F)=>{const ne=E.getState().nodeLookup.get(F).internals.userNode;y(K,ne)},[]):void 0;return b.jsx(lt,{position:a,style:{...e,"--xy-minimap-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-background-color-props":typeof f=="string"?f:void 0,"--xy-minimap-mask-stroke-color-props":typeof g=="string"?g:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*R:void 0,"--xy-minimap-node-background-color-props":typeof o=="string"?o:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:oe(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:b.jsxs("svg",{width:I,height:D,viewBox:`${L} ${Z} ${U} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Y,ref:N,onClick:G,children:[w&&b.jsx("title",{id:Y,children:w}),b.jsx(Ya,{onClick:Q,nodeColor:o,nodeStrokeColor:n,nodeBorderRadius:r,nodeClassName:s,nodeStrokeWidth:i,nodeComponent:c}),b.jsx("path",{className:"react-flow__minimap-mask",d:`M${L-j},${Z-j}h${U+j*2}v${X+j*2}h${-U-j*2}z
        M${M.x},${M.y}h${M.width}v${M.height}h${-M.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}ds.displayName="MiniMap";const Ka=C.memo(ds);function Qa({nodeId:e,position:t,variant:n=je.Handle,className:o,style:s={},children:r,color:i,minWidth:c=10,minHeight:l=10,maxWidth:f=Number.MAX_VALUE,maxHeight:g=Number.MAX_VALUE,keepAspectRatio:d=!1,resizeDirection:a,shouldResize:u,onResizeStart:y,onResize:p,onResizeEnd:x}){const w=Lo(),v=typeof e=="string"?e:w,h=ee(),m=C.useRef(null),E=n===je.Line?"right":"bottom-right",N=t??E,S=C.useRef(null);C.useEffect(()=>{if(!(!m.current||!v))return S.current||(S.current=Ii({domNode:m.current,nodeId:v,getStoreItems:()=>{const{nodeLookup:$,transform:H,snapGrid:_,snapToGrid:I,nodeOrigin:D,domNode:z}=h.getState();return{nodeLookup:$,transform:H,snapGrid:_,snapToGrid:I,nodeOrigin:D,paneDomNode:z}},onChange:($,H)=>{const{triggerNodeChanges:_,nodeLookup:I,parentLookup:D,nodeOrigin:z}=h.getState(),P=[],R={x:$.x,y:$.y},T=I.get(v);if(T&&T.expandParent&&T.parentId){const O=T.origin??z,j=$.width??T.measured.width??0,L=$.height??T.measured.height??0,Z={id:T.id,parentId:T.parentId,rect:{width:j,height:L,...fo({x:$.x??T.position.x,y:$.y??T.position.y},{width:j,height:L},T.parentId,I,O)}},U=Wt([Z],I,D,z);P.push(...U),R.x=$.x?Math.max(O[0]*j,$.x):void 0,R.y=$.y?Math.max(O[1]*L,$.y):void 0}if(R.x!==void 0&&R.y!==void 0){const O={id:v,type:"position",position:{...R}};P.push(O)}if($.width!==void 0&&$.height!==void 0){const j={id:v,type:"dimensions",resizing:!0,setAttributes:a?a==="horizontal"?"width":"height":!0,dimensions:{width:$.width,height:$.height}};P.push(j)}for(const O of H){const j={...O,type:"position"};P.push(j)}_(P)},onEnd:({width:$,height:H})=>{const _={id:v,type:"dimensions",resizing:!1,dimensions:{width:$,height:H}};h.getState().triggerNodeChanges([_])}})),S.current.update({controlPosition:N,boundaries:{minWidth:c,minHeight:l,maxWidth:f,maxHeight:g},keepAspectRatio:d,resizeDirection:a,onResizeStart:y,onResize:p,onResizeEnd:x,shouldResize:u}),()=>{S.current?.destroy()}},[N,c,l,f,g,d,y,p,x,u]);const M=N.split("-"),k=n===je.Line?"borderColor":"backgroundColor",A=i?{...s,[k]:i}:s;return b.jsx("div",{className:oe(["react-flow__resize-control","nodrag",...M,n,o]),ref:m,style:A,children:r})}C.memo(Qa);function us(e,t,n,o){let s=e;for(;;){const c=t(s);if(c.length===1&&!o(s)){s=c[0];continue}break}const i=t(s).filter(c=>c!==null).map(c=>us(c,t,n,o));return n(s,i)}function Ja(e){return us(e,t=>(t.Syntactic?.children??[]).filter(n=>n!==null),(t,n)=>{const o=structuredClone(t);return o.Syntactic?{...o,Syntactic:{...o.Syntactic,children:structuredClone(n)}}:o},t=>t.Syntactic?.prodInfo.some(n=>n.type==="terminal")??!1)}const jt=300,el=200;function fs(e,t=0,n=null,o=1){const s=e.Syntactic?.children.filter(i=>i!==null)??[],r={ast:e,children:[],x:0,y:t*el,mod:0,ancestor:null,change:0,shift:0,number:o,parent:n};return r.ancestor=r,r.children=s.map((i,c)=>fs(i,t+1,r,c+1)),r}function gs(e){if(e.children.length===0)Ke(e)?e.x=Ke(e).x+jt:e.x=0;else{let t=e.children[0];for(const s of e.children)gs(s),t=tl(s,t);ol(e);const n=(e.children[0].x+e.children[e.children.length-1].x)/2,o=Ke(e);o?(e.x=o.x+jt,e.mod=e.x-n):e.x=n}}function tl(e,t){const n=Ke(e);if(!n)return t;let o=e,s=e,r=n,i=rl(e),c=o.mod,l=s.mod,f=r.mod,g=i.mod;for(;ve(r)&&Ee(o);){r=ve(r),o=Ee(o),i=Ee(i),s=ve(s);const d=r.x+f-(o.x+c)+jt;d>0&&(nl(sl(r,e,t),e,d),c+=d,l+=d),f+=r.mod,c+=o.mod,g+=i.mod,l+=s.mod}return ve(r)&&!ve(s)&&(s.thread=ve(r),s.mod+=f-l),Ee(o)&&!Ee(i)&&(i.thread=Ee(o),i.mod+=c-g),t}function nl(e,t,n){const o=t.number-e.number;t.change-=n/o,t.shift+=n,e.change+=n/o,t.x+=n,t.mod+=n}function ol(e){let t=0,n=0;for(let o=e.children.length-1;o>=0;o--){const s=e.children[o];s.x+=t,s.mod+=t,n+=s.change,t+=s.shift+n}}function hs(e,t=0){e.x+=t;for(const n of e.children)hs(n,t+e.mod)}function sl(e,t,n){return t.parent.children.includes(e.ancestor)?e.ancestor:n}function rl(e){return e.parent.children[0]}function Ee(e){return e.children.length>0?e.children[0]:e.thread}function ve(e){return e.children.length>0?e.children[e.children.length-1]:e.thread}function Ke(e){if(!e.parent)return null;const t=e.parent.children.indexOf(e);return t>0?e.parent.children[t-1]:null}function ps(e){return{node:e.ast,x:e.x,y:e.y,children:e.children.map(ps)}}function il(e){const t=fs(e);return gs(t),hs(t),ps(t)}function cl(e){const t=[],n=[];let o=0;function s(r,i=null){const c=String(o++),l=r.node.Syntactic?r.node.Syntactic.name:`${r.node.Lexical.str} : ${r.node.Lexical.name}`,f=r.node.Syntactic?"syntactic":"lexical";t.push({id:c,position:{x:r.x,y:r.y},data:{label:l,ast:r.node,index:0,depth:r.y},type:f}),i!==null&&n.push({id:`e${i}-${c}`,source:i,target:c});for(const g of r.children)s(g,c);return c}return s(e),{nodes:t,edges:n}}function ms(e){const t=il(e);return cl(t)}function zt([e,t],n){const[o,s]=n??[-1,-1];if(e===-1||t===-1||o===-1||s===-1)return;const r=e===o&&s===t,i=e>=o&&s>=t,c=e<=o&&s<=t;return r?"exact":c?"descendants":i?"ancestors":void 0}const Xn=`w-[256px] h-fit py-4 pl-2 dark:bg-neutral-900
  data-[highlight=exact]:bg-yellow-400 data-[highlight=ancestors]:bg-yellow-50 data-[highlight=descendants]:bg-yellow-200
  data-[highlight=exact]:dark:bg-yellow-600 data-[highlight=ancestors]:dark:bg-yellow-950  data-[highlight=descendants]:dark:bg-yellow-800
  rounded-lg border-2 border-neutral-300 dark:border-neutral-700 transition-colors
  `,al={syntactic:C.memo(({data:e})=>{const t=_e(Pt),{Syntactic:n}=e.ast;return b.jsxs(b.Fragment,{children:[b.jsx(he,{type:"target",position:B.Top}),b.jsxs("div",{"data-highlight":zt(t,n?.loc),className:Xn,children:[b.jsxs("div",{className:"line-clamp-1 font-serif",children:[n?.name," :"]}),b.jsx("div",{className:"space-x-1 line-clamp-1",children:n?.prodInfo.map(({type:o,value:s})=>b.jsx("span",{"data-prod-type":o,className:"data-[prod-type=terminal]:font-mono data-[prod-type=nonterminal]:font-serif",children:s},s))})]}),b.jsx(he,{type:"source",position:B.Bottom})]})}),lexical:C.memo(({data:e})=>{const t=_e(Pt),{Lexical:n}=e.ast;return b.jsxs(b.Fragment,{children:[b.jsx(he,{type:"target",position:B.Top}),b.jsxs("div",{"data-highlight":zt(t,n?.loc),className:Xn,children:[b.jsx("div",{className:"line-clamp-1 font-serif",children:n?.name}),b.jsx("div",{className:"font-mono",children:n?.str})]}),b.jsx(he,{type:"source",position:B.Bottom})]})})},ll=Ot(e=>{const t=e(Qn);if(!t)return null;const{nodes:n,edges:o}=ms(t);return{nodes:n,edges:o}}),dl=Ot(e=>{const t=e(Qn);if(!t)return null;const{nodes:n,edges:o}=ms(Ja(t));return{nodes:n,edges:o}}),ul=Ot(!0);function hl(){const[e,t]=wr(ul),n=C.useRef(null),o=_e(dl),s=_e(ll),r=_e(Pt),[i,c,l]=Ca([]),[f,g,d]=Ma([]);C.useEffect(()=>{e||(s?(c([...s.nodes]),g([...s.edges])):(c([]),g([])))},[e,s,c,g]),C.useEffect(()=>{e&&(o?(c([...o.nodes]),g([...o.edges])):(c([]),g([])))},[e,o,c,g]);const a=C.useMemo(()=>JSON.stringify(i.filter(y=>{const p=zt(r,y.data.ast.Syntactic?.loc??y.data.ast.Lexical?.loc);return p==="exact"||p==="descendants"}).map(y=>y.id)),[i,r]),u=C.useCallback(()=>{const[y,p]=r;if(n.current&&y!==-1&&p!==-1){const x=JSON.parse(a);n.current.fitView({nodes:i.filter(w=>x.includes(w.id)),duration:Gn,padding:Un})}else setTimeout(()=>{n.current?.fitView({duration:Gn,padding:Un})})},[a,r]);return C.useEffect(()=>{setTimeout(()=>{u()},1)},[u]),b.jsx("div",{className:"size-full",children:b.jsxs(Na,{nodes:i,edges:f,colorMode:"system",minZoom:.0625,onNodesChange:l,onEdgesChange:d,onInit:y=>{n.current=y},nodesDraggable:!1,edgesFocusable:!1,edgesReconnectable:!1,nodesConnectable:!1,elementsSelectable:!1,nodeTypes:al,onlyRenderVisibleElements:!0,children:[b.jsx(za,{children:b.jsx(Te,{onClick:()=>t(y=>!y),title:e?"Expand AST":"Compress AST",children:e?b.jsx(Ir,{}):b.jsx(Mr,{})})}),i.length===0&&b.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-neutral-500",children:"No AST to display."}),b.jsx(Ka,{zoomable:!0,pannable:!0}),b.jsx($a,{variant:le.Dots,gap:16,size:0})]})})}const Gn=500,Un=.1;export{hl as default};
