import{X as eo,bh as to,bi as Cr,g as Mr,r as C,j as E,u as Re,bj as At,i as Ir,ao as Ot,bk as no}from"./index-u4wQXj53.js";import{d as Pr,n as kr,s as Ie,a as an,b as Dr,c as xt,e as wt,y as Ar,p as ot,z as oo,i as Hr,f as bt,g as Et,t as $r}from"./zoom-ByWBgdQG.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=eo("ChevronsDownUp",[["path",{d:"m7 20 5-5 5 5",key:"13a0gw"}],["path",{d:"m7 4 5 5 5-5",key:"1kwcof"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=eo("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);function re(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,o;n<e.length;n++)(o=re(e[n]))!==""&&(t+=(t&&" ")+o);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const Qe=e=>()=>e;function Ht(e,{sourceEvent:t,subject:n,target:o,identifier:s,active:r,x:i,y:a,dx:f,dy:d,dispatch:g}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:f,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:g}})}Ht.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Lr(e){return!e.ctrlKey&&!e.button}function Rr(){return this.parentNode}function jr(e,t){return t??{x:e.x,y:e.y}}function zr(){return navigator.maxTouchPoints||"ontouchstart"in this}function so(){var e=Lr,t=Rr,n=jr,o=zr,s={},r=Pr("start","drag","end"),i=0,a,f,d,g,l=0;function c(y){y.on("mousedown.drag",h).filter(o).on("touchstart.drag",w).on("touchmove.drag",x,kr).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(y,S){if(!(g||!e.call(this,y,S))){var b=u(this,t.call(this,y,S),y,S,"mouse");b&&(Ie(y.view).on("mousemove.drag",m,an).on("mouseup.drag",p,an),Dr(y.view),xt(y),d=!1,a=y.clientX,f=y.clientY,b("start",y))}}function m(y){if(wt(y),!d){var S=y.clientX-a,b=y.clientY-f;d=S*S+b*b>l}s.mouse("drag",y)}function p(y){Ie(y.view).on("mousemove.drag mouseup.drag",null),Ar(y.view,d),wt(y),s.mouse("end",y)}function w(y,S){if(e.call(this,y,S)){var b=y.changedTouches,N=t.call(this,y,S),M=b.length,I,z;for(I=0;I<M;++I)(z=u(this,N,y,S,b[I].identifier,b[I]))&&(xt(y),z("start",y,b[I]))}}function x(y){var S=y.changedTouches,b=S.length,N,M;for(N=0;N<b;++N)(M=s[S[N].identifier])&&(wt(y),M("drag",y,S[N]))}function v(y){var S=y.changedTouches,b=S.length,N,M;for(g&&clearTimeout(g),g=setTimeout(function(){g=null},500),N=0;N<b;++N)(M=s[S[N].identifier])&&(xt(y),M("end",y,S[N]))}function u(y,S,b,N,M,I){var z=r.copy(),P=ot(I||b,S),k,$,_;if((_=n.call(y,new Ht("beforestart",{sourceEvent:b,target:c,identifier:M,active:i,x:P[0],y:P[1],dx:0,dy:0,dispatch:z}),N))!=null)return k=_.x-P[0]||0,$=_.y-P[1]||0,function H(L,T,D){var A=P,O;switch(L){case"start":s[M]=H,O=i++;break;case"end":delete s[M],--i;case"drag":P=ot(D||T,S),O=i;break}z.call(L,y,new Ht(L,{sourceEvent:T,subject:_,target:c,identifier:M,active:O,x:P[0]+k,y:P[1]+$,dx:P[0]-A[0],dy:P[1]-A[1],dispatch:z}),N)}}return c.filter=function(y){return arguments.length?(e=typeof y=="function"?y:Qe(!!y),c):e},c.container=function(y){return arguments.length?(t=typeof y=="function"?y:Qe(y),c):t},c.subject=function(y){return arguments.length?(n=typeof y=="function"?y:Qe(y),c):n},c.touchable=function(y){return arguments.length?(o=typeof y=="function"?y:Qe(!!y),c):o},c.on=function(){var y=r.on.apply(r,arguments);return y===r?c:y},c.clickDistance=function(y){return arguments.length?(l=(y=+y)*y,c):Math.sqrt(l)},c}const le={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:o}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},ze=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],ro=["Enter"," ","Escape"],io={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Pe;(function(e){e.Strict="strict",e.Loose="loose"})(Pe||(Pe={}));var we;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(we||(we={}));var Ve;(function(e){e.Partial="partial",e.Full="full"})(Ve||(Ve={}));const ao={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var pe;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(pe||(pe={}));var st;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(st||(st={}));var B;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(B||(B={}));const cn={[B.Left]:B.Right,[B.Right]:B.Left,[B.Top]:B.Bottom,[B.Bottom]:B.Top};function co(e){return e===null?null:e?"valid":"invalid"}const lo=e=>"id"in e&&"source"in e&&"target"in e,Vr=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Bt=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),We=(e,t=[0,0])=>{const{width:n,height:o}=fe(e),s=e.origin??t,r=n*s[0],i=o*s[1];return{x:e.position.x-r,y:e.position.y-i}},Or=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((o,s)=>{const r=typeof s=="string";let i=!t.nodeLookup&&!r?s:void 0;t.nodeLookup&&(i=r?t.nodeLookup.get(s):Bt(s)?s:t.nodeLookup.get(s.id));const a=i?rt(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return ct(o,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return lt(n)},Ye=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},o=!1;return e.forEach(s=>{(t.filter===void 0||t.filter(s))&&(n=ct(n,rt(s)),o=!0)}),o?lt(n):{x:0,y:0,width:0,height:0}},Ft=(e,t,[n,o,s]=[0,0,1],r=!1,i=!1)=>{const a={...Ge(t,[n,o,s]),width:t.width/s,height:t.height/s},f=[];for(const d of e.values()){const{measured:g,selectable:l=!0,hidden:c=!1}=d;if(i&&!l||c)continue;const h=g.width??d.width??d.initialWidth??null,m=g.height??d.height??d.initialHeight??null,p=Oe(a,De(d)),w=(h??0)*(m??0),x=r&&p>0;(!d.internals.handleBounds||x||p>=w||d.dragging)&&f.push(d)}return f},Br=(e,t)=>{const n=new Set;return e.forEach(o=>{n.add(o.id)}),t.filter(o=>n.has(o.source)||n.has(o.target))};function Fr(e,t){const n=new Map,o=t?.nodes?new Set(t.nodes.map(s=>s.id)):null;return e.forEach(s=>{s.measured.width&&s.measured.height&&(t?.includeHiddenNodes||!s.hidden)&&(!o||o.has(s.id))&&n.set(s.id,s)}),n}async function Zr({nodes:e,width:t,height:n,panZoom:o,minZoom:s,maxZoom:r},i){if(e.size===0)return Promise.resolve(!0);const a=Fr(e,i),f=Ye(a),d=Zt(f,t,n,i?.minZoom??s,i?.maxZoom??r,i?.padding??.1);return await o.setViewport(d,{duration:i?.duration,ease:i?.ease,interpolate:i?.interpolate}),Promise.resolve(!0)}function uo({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:s,onError:r}){const i=n.get(e),a=i.parentId?n.get(i.parentId):void 0,{x:f,y:d}=a?a.internals.positionAbsolute:{x:0,y:0},g=i.origin??o;let l=i.extent||s;if(i.extent==="parent"&&!i.expandParent)if(!a)r?.("005",le.error005());else{const h=a.measured.width,m=a.measured.height;h&&m&&(l=[[f,d],[f+h,d+m]])}else a&&Ae(i.extent)&&(l=[[i.extent[0][0]+f,i.extent[0][1]+d],[i.extent[1][0]+f,i.extent[1][1]+d]]);const c=Ae(l)?be(t,l,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&r?.("015",le.error015()),{position:{x:c.x-f+(i.measured.width??0)*g[0],y:c.y-d+(i.measured.height??0)*g[1]},positionAbsolute:c}}async function Wr({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:s}){const r=new Set(e.map(c=>c.id)),i=[];for(const c of n){if(c.deletable===!1)continue;const h=r.has(c.id),m=!h&&c.parentId&&i.find(p=>p.id===c.parentId);(h||m)&&i.push(c)}const a=new Set(t.map(c=>c.id)),f=o.filter(c=>c.deletable!==!1),g=Br(i,f);for(const c of f)a.has(c.id)&&!g.find(m=>m.id===c.id)&&g.push(c);if(!s)return{edges:g,nodes:i};const l=await s({nodes:i,edges:g});return typeof l=="boolean"?l?{edges:g,nodes:i}:{edges:[],nodes:[]}:l}const ke=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),be=(e={x:0,y:0},t,n)=>({x:ke(e.x,t[0][0],t[1][0]-(n?.width??0)),y:ke(e.y,t[0][1],t[1][1]-(n?.height??0))});function fo(e,t,n){const{width:o,height:s}=fe(n),{x:r,y:i}=n.internals.positionAbsolute;return be(e,[[r,i],[r+o,i+s]],t)}const ln=(e,t,n)=>e<t?ke(Math.abs(e-t),1,t)/t:e>n?-ke(Math.abs(e-n),1,t)/t:0,go=(e,t,n=15,o=40)=>{const s=ln(e.x,o,t.width-o)*n,r=ln(e.y,o,t.height-o)*n;return[s,r]},ct=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),$t=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),lt=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),De=(e,t=[0,0])=>{const{x:n,y:o}=Bt(e)?e.internals.positionAbsolute:We(e,t);return{x:n,y:o,width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}},rt=(e,t=[0,0])=>{const{x:n,y:o}=Bt(e)?e.internals.positionAbsolute:We(e,t);return{x:n,y:o,x2:n+(e.measured?.width??e.width??e.initialWidth??0),y2:o+(e.measured?.height??e.height??e.initialHeight??0)}},ho=(e,t)=>lt(ct($t(e),$t(t))),Oe=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},dn=e=>ae(e.width)&&ae(e.height)&&ae(e.x)&&ae(e.y),ae=e=>!isNaN(e)&&isFinite(e),Yr=(e,t)=>{},Xe=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Ge=({x:e,y:t},[n,o,s],r=!1,i=[1,1])=>{const a={x:(e-n)/s,y:(t-o)/s};return r?Xe(a,i):a},it=({x:e,y:t},[n,o,s])=>({x:e*s+n,y:t*s+o});function Se(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Xr(e,t,n){if(typeof e=="string"||typeof e=="number"){const o=Se(e,n),s=Se(e,t);return{top:o,right:s,bottom:o,left:s,x:s*2,y:o*2}}if(typeof e=="object"){const o=Se(e.top??e.y??0,n),s=Se(e.bottom??e.y??0,n),r=Se(e.left??e.x??0,t),i=Se(e.right??e.x??0,t);return{top:o,right:i,bottom:s,left:r,x:r+i,y:o+s}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Gr(e,t,n,o,s,r){const{x:i,y:a}=it(e,[t,n,o]),{x:f,y:d}=it({x:e.x+e.width,y:e.y+e.height},[t,n,o]),g=s-f,l=r-d;return{left:Math.floor(i),top:Math.floor(a),right:Math.floor(g),bottom:Math.floor(l)}}const Zt=(e,t,n,o,s,r)=>{const i=Xr(r,t,n),a=(t-i.x)/e.width,f=(n-i.y)/e.height,d=Math.min(a,f),g=ke(d,o,s),l=e.x+e.width/2,c=e.y+e.height/2,h=t/2-l*g,m=n/2-c*g,p=Gr(e,h,m,g,t,n),w={left:Math.min(p.left-i.left,0),top:Math.min(p.top-i.top,0),right:Math.min(p.right-i.right,0),bottom:Math.min(p.bottom-i.bottom,0)};return{x:h-w.left+w.right,y:m-w.top+w.bottom,zoom:g}},Be=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function Ae(e){return e!=null&&e!=="parent"}function fe(e){return{width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}}function po(e){return(e.measured?.width??e.width??e.initialWidth)!==void 0&&(e.measured?.height??e.height??e.initialHeight)!==void 0}function mo(e,t={width:0,height:0},n,o,s){const r={...e},i=o.get(n);if(i){const a=i.origin||s;r.x+=i.internals.positionAbsolute.x-(t.width??0)*a[0],r.y+=i.internals.positionAbsolute.y-(t.height??0)*a[1]}return r}function un(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Ur(){let e,t;return{promise:new Promise((o,s)=>{e=o,t=s}),resolve:e,reject:t}}function qr(e){return{...io,...e||{}}}function je(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:s}){const{x:r,y:i}=ce(e),a=Ge({x:r-(s?.left??0),y:i-(s?.top??0)},o),{x:f,y:d}=n?Xe(a,t):a;return{xSnapped:f,ySnapped:d,...a}}const Wt=e=>({width:e.offsetWidth,height:e.offsetHeight}),yo=e=>e?.getRootNode?.()||window?.document,Kr=["INPUT","SELECT","TEXTAREA"];function xo(e){const t=e.composedPath?.()?.[0]||e.target;return t?.nodeType!==1?!1:Kr.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const wo=e=>"clientX"in e,ce=(e,t)=>{const n=wo(e),o=n?e.clientX:e.touches?.[0].clientX,s=n?e.clientY:e.touches?.[0].clientY;return{x:o-(t?.left??0),y:s-(t?.top??0)}},fn=(e,t,n,o,s)=>{const r=t.querySelectorAll(`.${e}`);return!r||!r.length?null:Array.from(r).map(i=>{const a=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:s,position:i.getAttribute("data-handlepos"),x:(a.left-n.left)/o,y:(a.top-n.top)/o,...Wt(i)}})};function bo({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:s,sourceControlY:r,targetControlX:i,targetControlY:a}){const f=e*.125+s*.375+i*.375+n*.125,d=t*.125+r*.375+a*.375+o*.125,g=Math.abs(f-e),l=Math.abs(d-t);return[f,d,g,l]}function Je(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function gn({pos:e,x1:t,y1:n,x2:o,y2:s,c:r}){switch(e){case B.Left:return[t-Je(t-o,r),n];case B.Right:return[t+Je(o-t,r),n];case B.Top:return[t,n-Je(n-s,r)];case B.Bottom:return[t,n+Je(s-n,r)]}}function Eo({sourceX:e,sourceY:t,sourcePosition:n=B.Bottom,targetX:o,targetY:s,targetPosition:r=B.Top,curvature:i=.25}){const[a,f]=gn({pos:n,x1:e,y1:t,x2:o,y2:s,c:i}),[d,g]=gn({pos:r,x1:o,y1:s,x2:e,y2:t,c:i}),[l,c,h,m]=bo({sourceX:e,sourceY:t,targetX:o,targetY:s,sourceControlX:a,sourceControlY:f,targetControlX:d,targetControlY:g});return[`M${e},${t} C${a},${f} ${d},${g} ${o},${s}`,l,c,h,m]}function So({sourceX:e,sourceY:t,targetX:n,targetY:o}){const s=Math.abs(n-e)/2,r=n<e?n+s:n-s,i=Math.abs(o-t)/2,a=o<t?o+i:o-i;return[r,a,s,i]}function Qr({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o,elevateOnSelect:s=!1}){if(o!==void 0)return o;const r=s&&n?1e3:0,i=Math.max(e.parentId||s&&e.selected?e.internals.z:0,t.parentId||s&&t.selected?t.internals.z:0);return r+i}function Jr({sourceNode:e,targetNode:t,width:n,height:o,transform:s}){const r=ct(rt(e),rt(t));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const i={x:-s[0]/s[2],y:-s[1]/s[2],width:n/s[2],height:o/s[2]};return Oe(i,lt(r))>0}const ei=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,ti=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),ni=(e,t)=>{if(!e.source||!e.target)return t;let n;return lo(e)?n={...e}:n={...e,id:ei(e)},ti(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function vo({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[s,r,i,a]=So({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,s,r,i,a]}const hn={[B.Left]:{x:-1,y:0},[B.Right]:{x:1,y:0},[B.Top]:{x:0,y:-1},[B.Bottom]:{x:0,y:1}},oi=({source:e,sourcePosition:t=B.Bottom,target:n})=>t===B.Left||t===B.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},pn=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function si({source:e,sourcePosition:t=B.Bottom,target:n,targetPosition:o=B.Top,center:s,offset:r,stepPosition:i}){const a=hn[t],f=hn[o],d={x:e.x+a.x*r,y:e.y+a.y*r},g={x:n.x+f.x*r,y:n.y+f.y*r},l=oi({source:d,sourcePosition:t,target:g}),c=l.x!==0?"x":"y",h=l[c];let m=[],p,w;const x={x:0,y:0},v={x:0,y:0},[,,u,y]=So({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[c]*f[c]===-1){c==="x"?(p=s.x??d.x+(g.x-d.x)*i,w=s.y??(d.y+g.y)/2):(p=s.x??(d.x+g.x)/2,w=s.y??d.y+(g.y-d.y)*i);const b=[{x:p,y:d.y},{x:p,y:g.y}],N=[{x:d.x,y:w},{x:g.x,y:w}];a[c]===h?m=c==="x"?b:N:m=c==="x"?N:b}else{const b=[{x:d.x,y:g.y}],N=[{x:g.x,y:d.y}];if(c==="x"?m=a.x===h?N:b:m=a.y===h?b:N,t===o){const k=Math.abs(e[c]-n[c]);if(k<=r){const $=Math.min(r-1,r-k);a[c]===h?x[c]=(d[c]>e[c]?-1:1)*$:v[c]=(g[c]>n[c]?-1:1)*$}}if(t!==o){const k=c==="x"?"y":"x",$=a[c]===f[k],_=d[k]>g[k],H=d[k]<g[k];(a[c]===1&&(!$&&_||$&&H)||a[c]!==1&&(!$&&H||$&&_))&&(m=c==="x"?b:N)}const M={x:d.x+x.x,y:d.y+x.y},I={x:g.x+v.x,y:g.y+v.y},z=Math.max(Math.abs(M.x-m[0].x),Math.abs(I.x-m[0].x)),P=Math.max(Math.abs(M.y-m[0].y),Math.abs(I.y-m[0].y));z>=P?(p=(M.x+I.x)/2,w=m[0].y):(p=m[0].x,w=(M.y+I.y)/2)}return[[e,{x:d.x+x.x,y:d.y+x.y},...m,{x:g.x+v.x,y:g.y+v.y},n],p,w,u,y]}function ri(e,t,n,o){const s=Math.min(pn(e,t)/2,pn(t,n)/2,o),{x:r,y:i}=t;if(e.x===r&&r===n.x||e.y===i&&i===n.y)return`L${r} ${i}`;if(e.y===i){const d=e.x<n.x?-1:1,g=e.y<n.y?1:-1;return`L ${r+s*d},${i}Q ${r},${i} ${r},${i+s*g}`}const a=e.x<n.x?1:-1,f=e.y<n.y?-1:1;return`L ${r},${i+s*f}Q ${r},${i} ${r+s*a},${i}`}function Tt({sourceX:e,sourceY:t,sourcePosition:n=B.Bottom,targetX:o,targetY:s,targetPosition:r=B.Top,borderRadius:i=5,centerX:a,centerY:f,offset:d=20,stepPosition:g=.5}){const[l,c,h,m,p]=si({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:s},targetPosition:r,center:{x:a,y:f},offset:d,stepPosition:g});return[l.reduce((x,v,u)=>{let y="";return u>0&&u<l.length-1?y=ri(l[u-1],v,l[u+1],i):y=`${u===0?"M":"L"}${v.x} ${v.y}`,x+=y,x},""),c,h,m,p]}function mn(e){return e&&!!(e.internals.handleBounds||e.handles?.length)&&!!(e.measured.width||e.width||e.initialWidth)}function ii(e){const{sourceNode:t,targetNode:n}=e;if(!mn(t)||!mn(n))return null;const o=t.internals.handleBounds||yn(t.handles),s=n.internals.handleBounds||yn(n.handles),r=xn(o?.source??[],e.sourceHandle),i=xn(e.connectionMode===Pe.Strict?s?.target??[]:(s?.target??[]).concat(s?.source??[]),e.targetHandle);if(!r||!i)return e.onError?.("008",le.error008(r?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=r?.position||B.Bottom,f=i?.position||B.Top,d=Fe(t,r,a),g=Fe(n,i,f);return{sourceX:d.x,sourceY:d.y,targetX:g.x,targetY:g.y,sourcePosition:a,targetPosition:f}}function yn(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,o.type==="source"?t.push(o):o.type==="target"&&n.push(o);return{source:t,target:n}}function Fe(e,t,n=B.Left,o=!1){const s=(t?.x??0)+e.internals.positionAbsolute.x,r=(t?.y??0)+e.internals.positionAbsolute.y,{width:i,height:a}=t??fe(e);if(o)return{x:s+i/2,y:r+a/2};switch(t?.position??n){case B.Top:return{x:s+i/2,y:r};case B.Right:return{x:s+i,y:r+a/2};case B.Bottom:return{x:s+i/2,y:r+a};case B.Left:return{x:s,y:r+a/2}}}function xn(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function _t(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(o=>`${o}=${e[o]}`).join("&")}`:""}function ai(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:s}){const r=new Set;return e.reduce((i,a)=>([a.markerStart||o,a.markerEnd||s].forEach(f=>{if(f&&typeof f=="object"){const d=_t(f,t);r.has(d)||(i.push({id:d,color:f.color||n,...f}),r.add(d))}}),i),[]).sort((i,a)=>i.id.localeCompare(a.id))}const No=1e3,ci=10,Yt={nodeOrigin:[0,0],nodeExtent:ze,elevateNodesOnSelect:!0,defaults:{}},li={...Yt,checkEquality:!0};function Xt(e,t){const n={...e};for(const o in t)t[o]!==void 0&&(n[o]=t[o]);return n}function di(e,t,n){const o=Xt(Yt,n);for(const s of e.values())if(s.parentId)Gt(s,e,t,o);else{const r=We(s,o.nodeOrigin),i=Ae(s.extent)?s.extent:o.nodeExtent,a=be(r,i,fe(s));s.internals.positionAbsolute=a}}function ui(e,t){if(!e.handles)return e.measured?t?.internals.handleBounds:void 0;const n=[],o=[];for(const s of e.handles){const r={id:s.id,width:s.width??1,height:s.height??1,nodeId:e.id,x:s.x,y:s.y,position:s.position,type:s.type};s.type==="source"?n.push(r):s.type==="target"&&o.push(r)}return{source:n,target:o}}function Lt(e,t,n,o){const s=Xt(li,o);let r={i:-1},i=e.length>0;const a=new Map(t),f=s?.elevateNodesOnSelect?No:0;t.clear(),n.clear();for(const d of e){let g=a.get(d.id);if(s.checkEquality&&d===g?.internals.userNode)t.set(d.id,g);else{const l=We(d,s.nodeOrigin),c=Ae(d.extent)?d.extent:s.nodeExtent,h=be(l,c,fe(d));g={...s.defaults,...d,measured:{width:d.measured?.width,height:d.measured?.height},internals:{positionAbsolute:h,handleBounds:ui(d,g),z:Co(d,f),userNode:d}},t.set(d.id,g)}(g.measured===void 0||g.measured.width===void 0||g.measured.height===void 0)&&!g.hidden&&(i=!1),d.parentId&&Gt(g,t,n,o,r)}return i}function fi(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Gt(e,t,n,o,s){const{elevateNodesOnSelect:r,nodeOrigin:i,nodeExtent:a}=Xt(Yt,o),f=e.parentId,d=t.get(f);if(!d){console.warn(`Parent node ${f} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}fi(e,n),s&&!d.parentId&&d.internals.rootParentIndex===void 0&&(d.internals.rootParentIndex=++s.i,d.internals.z=d.internals.z+s.i*ci),s&&d.internals.rootParentIndex!==void 0&&(s.i=d.internals.rootParentIndex);const g=r?No:0,{x:l,y:c,z:h}=gi(e,d,i,a,g),{positionAbsolute:m}=e.internals,p=l!==m.x||c!==m.y;(p||h!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:p?{x:l,y:c}:m,z:h}})}function Co(e,t){return(ae(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function gi(e,t,n,o,s){const{x:r,y:i}=t.internals.positionAbsolute,a=fe(e),f=We(e,n),d=Ae(e.extent)?be(f,e.extent,a):f;let g=be({x:r+d.x,y:i+d.y},o,a);e.extent==="parent"&&(g=fo(g,a,t));const l=Co(e,s),c=t.internals.z??0;return{x:g.x,y:g.y,z:c>=l?c+1:l}}function Ut(e,t,n,o=[0,0]){const s=[],r=new Map;for(const i of e){const a=t.get(i.parentId);if(!a)continue;const f=r.get(i.parentId)?.expandedRect??De(a),d=ho(f,i.rect);r.set(i.parentId,{expandedRect:d,parent:a})}return r.size>0&&r.forEach(({expandedRect:i,parent:a},f)=>{const d=a.internals.positionAbsolute,g=fe(a),l=a.origin??o,c=i.x<d.x?Math.round(Math.abs(d.x-i.x)):0,h=i.y<d.y?Math.round(Math.abs(d.y-i.y)):0,m=Math.max(g.width,Math.round(i.width)),p=Math.max(g.height,Math.round(i.height)),w=(m-g.width)*l[0],x=(p-g.height)*l[1];(c>0||h>0||w||x)&&(s.push({id:f,type:"position",position:{x:a.position.x-c+w,y:a.position.y-h+x}}),n.get(f)?.forEach(v=>{e.some(u=>u.id===v.id)||s.push({id:v.id,type:"position",position:{x:v.position.x+c,y:v.position.y+h}})})),(g.width<i.width||g.height<i.height||c||h)&&s.push({id:f,type:"dimensions",setAttributes:!0,dimensions:{width:m+(c?l[0]*c-w:0),height:p+(h?l[1]*h-x:0)}})}),s}function hi(e,t,n,o,s,r){const i=o?.querySelector(".xyflow__viewport");let a=!1;if(!i)return{changes:[],updatedInternals:a};const f=[],d=window.getComputedStyle(i),{m22:g}=new window.DOMMatrixReadOnly(d.transform),l=[];for(const c of e.values()){const h=t.get(c.id);if(!h)continue;if(h.hidden){t.set(h.id,{...h,internals:{...h.internals,handleBounds:void 0}}),a=!0;continue}const m=Wt(c.nodeElement),p=h.measured.width!==m.width||h.measured.height!==m.height;if(!!(m.width&&m.height&&(p||!h.internals.handleBounds||c.force))){const x=c.nodeElement.getBoundingClientRect(),v=Ae(h.extent)?h.extent:r;let{positionAbsolute:u}=h.internals;h.parentId&&h.extent==="parent"?u=fo(u,m,t.get(h.parentId)):v&&(u=be(u,v,m));const y={...h,measured:m,internals:{...h.internals,positionAbsolute:u,handleBounds:{source:fn("source",c.nodeElement,x,g,h.id),target:fn("target",c.nodeElement,x,g,h.id)}}};t.set(h.id,y),h.parentId&&Gt(y,t,n,{nodeOrigin:s}),a=!0,p&&(f.push({id:h.id,type:"dimensions",dimensions:m}),h.expandParent&&h.parentId&&l.push({id:h.id,parentId:h.parentId,rect:De(y,s)}))}}if(l.length>0){const c=Ut(l,t,n,s);f.push(...c)}return{changes:f,updatedInternals:a}}async function pi({delta:e,panZoom:t,transform:n,translateExtent:o,width:s,height:r}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[s,r]],o),a=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(a)}function wn(e,t,n,o,s,r){let i=s;const a=o.get(i)||new Map;o.set(i,a.set(n,t)),i=`${s}-${e}`;const f=o.get(i)||new Map;if(o.set(i,f.set(n,t)),r){i=`${s}-${e}-${r}`;const d=o.get(i)||new Map;o.set(i,d.set(n,t))}}function Mo(e,t,n){e.clear(),t.clear();for(const o of n){const{source:s,target:r,sourceHandle:i=null,targetHandle:a=null}=o,f={edgeId:o.id,source:s,target:r,sourceHandle:i,targetHandle:a},d=`${s}-${i}--${r}-${a}`,g=`${r}-${a}--${s}-${i}`;wn("source",f,g,e,s,i),wn("target",f,d,e,r,a),t.set(o.id,o)}}function Io(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:Io(n,t):!1}function bn(e,t,n){let o=e;do{if(o?.matches?.(t))return!0;if(o===n)return!1;o=o?.parentElement}while(o);return!1}function mi(e,t,n,o){const s=new Map;for(const[r,i]of e)if((i.selected||i.id===o)&&(!i.parentId||!Io(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const a=e.get(r);a&&s.set(r,{id:r,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return s}function St({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){const s=[];for(const[i,a]of t){const f=n.get(i)?.internals.userNode;f&&s.push({...f,position:a.position,dragging:o})}if(!e)return[s[0],s];const r=n.get(e)?.internals.userNode;return[r?{...r,position:t.get(e)?.position||r.position,dragging:o}:s[0],s]}function yi({dragItems:e,snapGrid:t,x:n,y:o}){const s=e.values().next().value;if(!s)return null;const r={x:n-s.distance.x,y:o-s.distance.y},i=Xe(r,t);return{x:i.x-r.x,y:i.y-r.y}}function xi({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:o,onDragStop:s}){let r={x:null,y:null},i=0,a=new Map,f=!1,d={x:0,y:0},g=null,l=!1,c=null,h=!1,m=!1,p=null;function w({noDragClassName:v,handleSelector:u,domNode:y,isSelectable:S,nodeId:b,nodeClickDistance:N=0}){c=Ie(y);function M({x:k,y:$}){const{nodeLookup:_,nodeExtent:H,snapGrid:L,snapToGrid:T,nodeOrigin:D,onNodeDrag:A,onSelectionDrag:O,onError:V,updateNodePositions:R}=t();r={x:k,y:$};let Z=!1;const W=a.size>1,U=W&&H?$t(Ye(a)):null,ee=W&&T?yi({dragItems:a,snapGrid:L,x:k,y:$}):null;for(const[X,j]of a){if(!_.has(X))continue;let F={x:k-j.distance.x,y:$-j.distance.y};T&&(F=ee?{x:Math.round(F.x+ee.x),y:Math.round(F.y+ee.y)}:Xe(F,L));let K=null;if(W&&H&&!j.extent&&U){const{positionAbsolute:G}=j.internals,Q=G.x-U.x+H[0][0],te=G.x+j.measured.width-U.x2+H[1][0],oe=G.y-U.y+H[0][1],ie=G.y+j.measured.height-U.y2+H[1][1];K=[[Q,oe],[te,ie]]}const{position:q,positionAbsolute:Y}=uo({nodeId:X,nextPosition:F,nodeLookup:_,nodeExtent:K||H,nodeOrigin:D,onError:V});Z=Z||j.position.x!==q.x||j.position.y!==q.y,j.position=q,j.internals.positionAbsolute=Y}if(m=m||Z,!!Z&&(R(a,!0),p&&(o||A||!b&&O))){const[X,j]=St({nodeId:b,dragItems:a,nodeLookup:_});o?.(p,a,X,j),A?.(p,X,j),b||O?.(p,j)}}async function I(){if(!g)return;const{transform:k,panBy:$,autoPanSpeed:_,autoPanOnNodeDrag:H}=t();if(!H){f=!1,cancelAnimationFrame(i);return}const[L,T]=go(d,g,_);(L!==0||T!==0)&&(r.x=(r.x??0)-L/k[2],r.y=(r.y??0)-T/k[2],await $({x:L,y:T})&&M(r)),i=requestAnimationFrame(I)}function z(k){const{nodeLookup:$,multiSelectionActive:_,nodesDraggable:H,transform:L,snapGrid:T,snapToGrid:D,selectNodesOnDrag:A,onNodeDragStart:O,onSelectionDragStart:V,unselectNodesAndEdges:R}=t();l=!0,(!A||!S)&&!_&&b&&($.get(b)?.selected||R()),S&&A&&b&&e?.(b);const Z=je(k.sourceEvent,{transform:L,snapGrid:T,snapToGrid:D,containerBounds:g});if(r=Z,a=mi($,H,Z,b),a.size>0&&(n||O||!b&&V)){const[W,U]=St({nodeId:b,dragItems:a,nodeLookup:$});n?.(k.sourceEvent,a,W,U),O?.(k.sourceEvent,W,U),b||V?.(k.sourceEvent,U)}}const P=so().clickDistance(N).on("start",k=>{const{domNode:$,nodeDragThreshold:_,transform:H,snapGrid:L,snapToGrid:T}=t();g=$?.getBoundingClientRect()||null,h=!1,m=!1,p=k.sourceEvent,_===0&&z(k),r=je(k.sourceEvent,{transform:H,snapGrid:L,snapToGrid:T,containerBounds:g}),d=ce(k.sourceEvent,g)}).on("drag",k=>{const{autoPanOnNodeDrag:$,transform:_,snapGrid:H,snapToGrid:L,nodeDragThreshold:T,nodeLookup:D}=t(),A=je(k.sourceEvent,{transform:_,snapGrid:H,snapToGrid:L,containerBounds:g});if(p=k.sourceEvent,(k.sourceEvent.type==="touchmove"&&k.sourceEvent.touches.length>1||b&&!D.has(b))&&(h=!0),!h){if(!f&&$&&l&&(f=!0,I()),!l){const O=ce(k.sourceEvent,g),V=O.x-d.x,R=O.y-d.y;Math.sqrt(V*V+R*R)>T&&z(k)}(r.x!==A.xSnapped||r.y!==A.ySnapped)&&a&&l&&(d=ce(k.sourceEvent,g),M(A))}}).on("end",k=>{if(!(!l||h)&&(f=!1,l=!1,cancelAnimationFrame(i),a.size>0)){const{nodeLookup:$,updateNodePositions:_,onNodeDragStop:H,onSelectionDragStop:L}=t();if(m&&(_(a,!1),m=!1),s||H||!b&&L){const[T,D]=St({nodeId:b,dragItems:a,nodeLookup:$,dragging:!1});s?.(k.sourceEvent,a,T,D),H?.(k.sourceEvent,T,D),b||L?.(k.sourceEvent,D)}}}).filter(k=>{const $=k.target;return!k.button&&(!v||!bn($,`.${v}`,y))&&(!u||bn($,u,y))});c.call(P)}function x(){c?.on(".drag",null)}return{update:w,destroy:x}}function wi(e,t,n){const o=[],s={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const r of t.values())Oe(s,De(r))>0&&o.push(r);return o}const bi=250;function Ei(e,t,n,o){let s=[],r=1/0;const i=wi(e,n,t+bi);for(const a of i){const f=[...a.internals.handleBounds?.source??[],...a.internals.handleBounds?.target??[]];for(const d of f){if(o.nodeId===d.nodeId&&o.type===d.type&&o.id===d.id)continue;const{x:g,y:l}=Fe(a,d,d.position,!0),c=Math.sqrt(Math.pow(g-e.x,2)+Math.pow(l-e.y,2));c>t||(c<r?(s=[{...d,x:g,y:l}],r=c):c===r&&s.push({...d,x:g,y:l}))}}if(!s.length)return null;if(s.length>1){const a=o.type==="source"?"target":"source";return s.find(f=>f.type===a)??s[0]}return s[0]}function Po(e,t,n,o,s,r=!1){const i=o.get(e);if(!i)return null;const a=s==="strict"?i.internals.handleBounds?.[t]:[...i.internals.handleBounds?.source??[],...i.internals.handleBounds?.target??[]],f=(n?a?.find(d=>d.id===n):a?.[0])??null;return f&&r?{...f,...Fe(i,f,f.position,!0)}:f}function ko(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function Si(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const Do=()=>!0;function vi(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:s,edgeUpdaterType:r,isTarget:i,domNode:a,nodeLookup:f,lib:d,autoPanOnConnect:g,flowId:l,panBy:c,cancelConnection:h,onConnectStart:m,onConnect:p,onConnectEnd:w,isValidConnection:x=Do,onReconnectEnd:v,updateConnection:u,getTransform:y,getFromHandle:S,autoPanSpeed:b,dragThreshold:N=1,handleDomNode:M}){const I=yo(e.target);let z=0,P;const{x:k,y:$}=ce(e),_=ko(r,M),H=a?.getBoundingClientRect();let L=!1;if(!H||!_)return;const T=Po(s,_,o,f,t);if(!T)return;let D=ce(e,H),A=!1,O=null,V=!1,R=null;function Z(){if(!g||!H)return;const[q,Y]=go(D,H,b);c({x:q,y:Y}),z=requestAnimationFrame(Z)}const W={...T,nodeId:s,type:_,position:T.position},U=f.get(s);let X={inProgress:!0,isValid:null,from:Fe(U,W,B.Left,!0),fromHandle:W,fromPosition:W.position,fromNode:U,to:D,toHandle:null,toPosition:cn[W.position],toNode:null};function j(){L=!0,u(X),m?.(e,{nodeId:s,handleId:o,handleType:_})}N===0&&j();function F(q){if(!L){const{x:te,y:oe}=ce(q),ie=te-k,de=oe-$;if(!(ie*ie+de*de>N*N))return;j()}if(!S()||!W){K(q);return}const Y=y();D=ce(q,H),P=Ei(Ge(D,Y,!1,[1,1]),n,f,W),A||(Z(),A=!0);const G=Ao(q,{handle:P,connectionMode:t,fromNodeId:s,fromHandleId:o,fromType:i?"target":"source",isValidConnection:x,doc:I,lib:d,flowId:l,nodeLookup:f});R=G.handleDomNode,O=G.connection,V=Si(!!P,G.isValid);const Q={...X,isValid:V,to:G.toHandle&&V?it({x:G.toHandle.x,y:G.toHandle.y},Y):D,toHandle:G.toHandle,toPosition:V&&G.toHandle?G.toHandle.position:cn[W.position],toNode:G.toHandle?f.get(G.toHandle.nodeId):null};V&&P&&X.toHandle&&Q.toHandle&&X.toHandle.type===Q.toHandle.type&&X.toHandle.nodeId===Q.toHandle.nodeId&&X.toHandle.id===Q.toHandle.id&&X.to.x===Q.to.x&&X.to.y===Q.to.y||(u(Q),X=Q)}function K(q){if(!("touches"in q&&q.touches.length>0)){if(L){(P||R)&&O&&V&&p?.(O);const{inProgress:Y,...G}=X,Q={...G,toPosition:X.toHandle?X.toPosition:null};w?.(q,Q),r&&v?.(q,Q)}h(),cancelAnimationFrame(z),A=!1,V=!1,O=null,R=null,I.removeEventListener("mousemove",F),I.removeEventListener("mouseup",K),I.removeEventListener("touchmove",F),I.removeEventListener("touchend",K)}}I.addEventListener("mousemove",F),I.addEventListener("mouseup",K),I.addEventListener("touchmove",F),I.addEventListener("touchend",K)}function Ao(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:s,fromType:r,doc:i,lib:a,flowId:f,isValidConnection:d=Do,nodeLookup:g}){const l=r==="target",c=t?i.querySelector(`.${a}-flow__handle[data-id="${f}-${t?.nodeId}-${t?.id}-${t?.type}"]`):null,{x:h,y:m}=ce(e),p=i.elementFromPoint(h,m),w=p?.classList.contains(`${a}-flow__handle`)?p:c,x={handleDomNode:w,isValid:!1,connection:null,toHandle:null};if(w){const v=ko(void 0,w),u=w.getAttribute("data-nodeid"),y=w.getAttribute("data-handleid"),S=w.classList.contains("connectable"),b=w.classList.contains("connectableend");if(!u||!v)return x;const N={source:l?u:o,sourceHandle:l?y:s,target:l?o:u,targetHandle:l?s:y};x.connection=N;const I=S&&b&&(n===Pe.Strict?l&&v==="source"||!l&&v==="target":u!==o||y!==s);x.isValid=I&&d(N),x.toHandle=Po(u,v,y,g,n,!0)}return x}const Rt={onPointerDown:vi,isValid:Ao};function Ni({domNode:e,panZoom:t,getTransform:n,getViewScale:o}){const s=Ie(e);function r({translateExtent:a,width:f,height:d,zoomStep:g=1,pannable:l=!0,zoomable:c=!0,inversePan:h=!1}){const m=u=>{if(u.sourceEvent.type!=="wheel"||!t)return;const y=n(),S=u.sourceEvent.ctrlKey&&Be()?10:1,b=-u.sourceEvent.deltaY*(u.sourceEvent.deltaMode===1?.05:u.sourceEvent.deltaMode?1:.002)*g,N=y[2]*Math.pow(2,b*S);t.scaleTo(N)};let p=[0,0];const w=u=>{(u.sourceEvent.type==="mousedown"||u.sourceEvent.type==="touchstart")&&(p=[u.sourceEvent.clientX??u.sourceEvent.touches[0].clientX,u.sourceEvent.clientY??u.sourceEvent.touches[0].clientY])},x=u=>{const y=n();if(u.sourceEvent.type!=="mousemove"&&u.sourceEvent.type!=="touchmove"||!t)return;const S=[u.sourceEvent.clientX??u.sourceEvent.touches[0].clientX,u.sourceEvent.clientY??u.sourceEvent.touches[0].clientY],b=[S[0]-p[0],S[1]-p[1]];p=S;const N=o()*Math.max(y[2],Math.log(y[2]))*(h?-1:1),M={x:y[0]-b[0]*N,y:y[1]-b[1]*N},I=[[0,0],[f,d]];t.setViewportConstrained({x:M.x,y:M.y,zoom:y[2]},I,a)},v=oo().on("start",w).on("zoom",l?x:null).on("zoom.wheel",c?m:null);s.call(v,{})}function i(){s.on("zoom",null)}return{update:r,destroy:i,pointer:ot}}const dt=e=>({x:e.x,y:e.y,zoom:e.k}),vt=({x:e,y:t,zoom:n})=>Hr.translate(e,t).scale(n),Ce=(e,t)=>e.target.closest(`.${t}`),Ho=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Ci=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Nt=(e,t=0,n=Ci,o=()=>{})=>{const s=typeof t=="number"&&t>0;return s||o(),s?e.transition().duration(t).ease(n).on("end",o):e},$o=e=>{const t=e.ctrlKey&&Be()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Mi({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:o,panOnScrollMode:s,panOnScrollSpeed:r,zoomOnPinch:i,onPanZoomStart:a,onPanZoom:f,onPanZoomEnd:d}){return g=>{if(Ce(g,t))return g.ctrlKey&&g.preventDefault(),!1;g.preventDefault(),g.stopImmediatePropagation();const l=n.property("__zoom").k||1;if(g.ctrlKey&&i){const w=ot(g),x=$o(g),v=l*Math.pow(2,x);o.scaleTo(n,v,w,g);return}const c=g.deltaMode===1?20:1;let h=s===we.Vertical?0:g.deltaX*c,m=s===we.Horizontal?0:g.deltaY*c;!Be()&&g.shiftKey&&s!==we.Vertical&&(h=g.deltaY*c,m=0),o.translateBy(n,-(h/l)*r,-(m/l)*r,{internal:!0});const p=dt(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(f?.(g,p),e.panScrollTimeout=setTimeout(()=>{d?.(g,p),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,a?.(g,p))}}function Ii({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,s){const r=o.type==="wheel",i=!t&&r&&!o.ctrlKey,a=Ce(o,e);if(o.ctrlKey&&r&&a&&o.preventDefault(),i||a)return null;o.preventDefault(),n.call(this,o,s)}}function Pi({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{if(o.sourceEvent?.internal)return;const s=dt(o.transform);e.mouseButton=o.sourceEvent?.button||0,e.isZoomingOrPanning=!0,e.prevViewport=s,o.sourceEvent?.type==="mousedown"&&t(!0),n&&n?.(o.sourceEvent,s)}}function ki({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:s}){return r=>{e.usedRightMouseButton=!!(n&&Ho(t,e.mouseButton??0)),r.sourceEvent?.sync||o([r.transform.x,r.transform.y,r.transform.k]),s&&!r.sourceEvent?.internal&&s?.(r.sourceEvent,dt(r.transform))}}function Di({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:s,onPaneContextMenu:r}){return i=>{if(!i.sourceEvent?.internal&&(e.isZoomingOrPanning=!1,r&&Ho(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&r(i.sourceEvent),e.usedRightMouseButton=!1,o(!1),s)){const a=dt(i.transform);e.prevViewport=a,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{s?.(i.sourceEvent,a)},n?150:0)}}}function Ai({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:s,zoomOnDoubleClick:r,userSelectionActive:i,noWheelClassName:a,noPanClassName:f,lib:d,connectionInProgress:g}){return l=>{const c=e||t,h=n&&l.ctrlKey,m=l.type==="wheel";if(l.button===1&&l.type==="mousedown"&&(Ce(l,`${d}-flow__node`)||Ce(l,`${d}-flow__edge`)))return!0;if(!o&&!c&&!s&&!r&&!n||i||g&&!m||Ce(l,a)&&m||Ce(l,f)&&(!m||s&&m&&!e)||!n&&l.ctrlKey&&m)return!1;if(!n&&l.type==="touchstart"&&l.touches?.length>1)return l.preventDefault(),!1;if(!c&&!s&&!h&&m||!o&&(l.type==="mousedown"||l.type==="touchstart")||Array.isArray(o)&&!o.includes(l.button)&&l.type==="mousedown")return!1;const p=Array.isArray(o)&&o.includes(l.button)||!l.button||l.button<=1;return(!l.ctrlKey||m)&&p}}function Hi({domNode:e,minZoom:t,maxZoom:n,translateExtent:o,viewport:s,onPanZoom:r,onPanZoomStart:i,onPanZoomEnd:a,onDraggingChange:f}){const d={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},g=e.getBoundingClientRect(),l=oo().scaleExtent([t,n]).translateExtent(o),c=Ie(e).call(l);v({x:s.x,y:s.y,zoom:ke(s.zoom,t,n)},[[0,0],[g.width,g.height]],o);const h=c.on("wheel.zoom"),m=c.on("dblclick.zoom");l.wheelDelta($o);function p(P,k){return c?new Promise($=>{l?.interpolate(k?.interpolate==="linear"?Et:bt).transform(Nt(c,k?.duration,k?.ease,()=>$(!0)),P)}):Promise.resolve(!1)}function w({noWheelClassName:P,noPanClassName:k,onPaneContextMenu:$,userSelectionActive:_,panOnScroll:H,panOnDrag:L,panOnScrollMode:T,panOnScrollSpeed:D,preventScrolling:A,zoomOnPinch:O,zoomOnScroll:V,zoomOnDoubleClick:R,zoomActivationKeyPressed:Z,lib:W,onTransformChange:U,connectionInProgress:ee,paneClickDistance:X,selectionOnDrag:j}){_&&!d.isZoomingOrPanning&&x();const F=H&&!Z&&!_;l.clickDistance(j?1/0:!ae(X)||X<0?0:X);const K=F?Mi({zoomPanValues:d,noWheelClassName:P,d3Selection:c,d3Zoom:l,panOnScrollMode:T,panOnScrollSpeed:D,zoomOnPinch:O,onPanZoomStart:i,onPanZoom:r,onPanZoomEnd:a}):Ii({noWheelClassName:P,preventScrolling:A,d3ZoomHandler:h});if(c.on("wheel.zoom",K,{passive:!1}),!_){const Y=Pi({zoomPanValues:d,onDraggingChange:f,onPanZoomStart:i});l.on("start",Y);const G=ki({zoomPanValues:d,panOnDrag:L,onPaneContextMenu:!!$,onPanZoom:r,onTransformChange:U});l.on("zoom",G);const Q=Di({zoomPanValues:d,panOnDrag:L,panOnScroll:H,onPaneContextMenu:$,onPanZoomEnd:a,onDraggingChange:f});l.on("end",Q)}const q=Ai({zoomActivationKeyPressed:Z,panOnDrag:L,zoomOnScroll:V,panOnScroll:H,zoomOnDoubleClick:R,zoomOnPinch:O,userSelectionActive:_,noPanClassName:k,noWheelClassName:P,lib:W,connectionInProgress:ee});l.filter(q),R?c.on("dblclick.zoom",m):c.on("dblclick.zoom",null)}function x(){l.on("zoom",null)}async function v(P,k,$){const _=vt(P),H=l?.constrain()(_,k,$);return H&&await p(H),new Promise(L=>L(H))}async function u(P,k){const $=vt(P);return await p($,k),new Promise(_=>_($))}function y(P){if(c){const k=vt(P),$=c.property("__zoom");($.k!==P.zoom||$.x!==P.x||$.y!==P.y)&&l?.transform(c,k,null,{sync:!0})}}function S(){const P=c?$r(c.node()):{x:0,y:0,k:1};return{x:P.x,y:P.y,zoom:P.k}}function b(P,k){return c?new Promise($=>{l?.interpolate(k?.interpolate==="linear"?Et:bt).scaleTo(Nt(c,k?.duration,k?.ease,()=>$(!0)),P)}):Promise.resolve(!1)}function N(P,k){return c?new Promise($=>{l?.interpolate(k?.interpolate==="linear"?Et:bt).scaleBy(Nt(c,k?.duration,k?.ease,()=>$(!0)),P)}):Promise.resolve(!1)}function M(P){l?.scaleExtent(P)}function I(P){l?.translateExtent(P)}function z(P){const k=!ae(P)||P<0?0:P;l?.clickDistance(k)}return{update:w,destroy:x,setViewport:u,setViewportConstrained:v,getViewport:S,scaleTo:b,scaleBy:N,setScaleExtent:M,setTranslateExtent:I,syncViewport:y,setClickDistance:z}}var He;(function(e){e.Line="line",e.Handle="handle"})(He||(He={}));function $i({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:s,affectsY:r}){const i=e-t,a=n-o,f=[i>0?1:i<0?-1:0,a>0?1:a<0?-1:0];return i&&s&&(f[0]=f[0]*-1),a&&r&&(f[1]=f[1]*-1),f}function En(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),o=e.includes("left"),s=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:o,affectsY:s}}function ge(e,t){return Math.max(0,t-e)}function he(e,t){return Math.max(0,e-t)}function et(e,t,n){return Math.max(0,t-e,e-n)}function Sn(e,t){return e?!t:t}function Ti(e,t,n,o,s,r,i,a){let{affectsX:f,affectsY:d}=t;const{isHorizontal:g,isVertical:l}=t,c=g&&l,{xSnapped:h,ySnapped:m}=n,{minWidth:p,maxWidth:w,minHeight:x,maxHeight:v}=o,{x:u,y,width:S,height:b,aspectRatio:N}=e;let M=Math.floor(g?h-e.pointerX:0),I=Math.floor(l?m-e.pointerY:0);const z=S+(f?-M:M),P=b+(d?-I:I),k=-r[0]*S,$=-r[1]*b;let _=et(z,p,w),H=et(P,x,v);if(i){let D=0,A=0;f&&M<0?D=ge(u+M+k,i[0][0]):!f&&M>0&&(D=he(u+z+k,i[1][0])),d&&I<0?A=ge(y+I+$,i[0][1]):!d&&I>0&&(A=he(y+P+$,i[1][1])),_=Math.max(_,D),H=Math.max(H,A)}if(a){let D=0,A=0;f&&M>0?D=he(u+M,a[0][0]):!f&&M<0&&(D=ge(u+z,a[1][0])),d&&I>0?A=he(y+I,a[0][1]):!d&&I<0&&(A=ge(y+P,a[1][1])),_=Math.max(_,D),H=Math.max(H,A)}if(s){if(g){const D=et(z/N,x,v)*N;if(_=Math.max(_,D),i){let A=0;!f&&!d||f&&!d&&c?A=he(y+$+z/N,i[1][1])*N:A=ge(y+$+(f?M:-M)/N,i[0][1])*N,_=Math.max(_,A)}if(a){let A=0;!f&&!d||f&&!d&&c?A=ge(y+z/N,a[1][1])*N:A=he(y+(f?M:-M)/N,a[0][1])*N,_=Math.max(_,A)}}if(l){const D=et(P*N,p,w)/N;if(H=Math.max(H,D),i){let A=0;!f&&!d||d&&!f&&c?A=he(u+P*N+k,i[1][0])/N:A=ge(u+(d?I:-I)*N+k,i[0][0])/N,H=Math.max(H,A)}if(a){let A=0;!f&&!d||d&&!f&&c?A=ge(u+P*N,a[1][0])/N:A=he(u+(d?I:-I)*N,a[0][0])/N,H=Math.max(H,A)}}}I=I+(I<0?H:-H),M=M+(M<0?_:-_),s&&(c?z>P*N?I=(Sn(f,d)?-M:M)/N:M=(Sn(f,d)?-I:I)*N:g?(I=M/N,d=f):(M=I*N,f=d));const L=f?u+M:u,T=d?y+I:y;return{width:S+(f?-M:M),height:b+(d?-I:I),x:r[0]*M*(f?-1:1)+L,y:r[1]*I*(d?-1:1)+T}}const To={width:0,height:0,x:0,y:0},_i={...To,pointerX:0,pointerY:0,aspectRatio:1};function Li(e){return[[0,0],[e.measured.width,e.measured.height]]}function Ri(e,t,n){const o=t.position.x+e.position.x,s=t.position.y+e.position.y,r=e.measured.width??0,i=e.measured.height??0,a=n[0]*r,f=n[1]*i;return[[o-a,s-f],[o+r-a,s+i-f]]}function ji({domNode:e,nodeId:t,getStoreItems:n,onChange:o,onEnd:s}){const r=Ie(e);let i={controlDirection:En("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function a({controlPosition:d,boundaries:g,keepAspectRatio:l,resizeDirection:c,onResizeStart:h,onResize:m,onResizeEnd:p,shouldResize:w}){let x={...To},v={..._i};i={boundaries:g,resizeDirection:c,keepAspectRatio:l,controlDirection:En(d)};let u,y=null,S=[],b,N,M,I=!1;const z=so().on("start",P=>{const{nodeLookup:k,transform:$,snapGrid:_,snapToGrid:H,nodeOrigin:L,paneDomNode:T}=n();if(u=k.get(t),!u)return;y=T?.getBoundingClientRect()??null;const{xSnapped:D,ySnapped:A}=je(P.sourceEvent,{transform:$,snapGrid:_,snapToGrid:H,containerBounds:y});x={width:u.measured.width??0,height:u.measured.height??0,x:u.position.x??0,y:u.position.y??0},v={...x,pointerX:D,pointerY:A,aspectRatio:x.width/x.height},b=void 0,u.parentId&&(u.extent==="parent"||u.expandParent)&&(b=k.get(u.parentId),N=b&&u.extent==="parent"?Li(b):void 0),S=[],M=void 0;for(const[O,V]of k)if(V.parentId===t&&(S.push({id:O,position:{...V.position},extent:V.extent}),V.extent==="parent"||V.expandParent)){const R=Ri(V,u,V.origin??L);M?M=[[Math.min(R[0][0],M[0][0]),Math.min(R[0][1],M[0][1])],[Math.max(R[1][0],M[1][0]),Math.max(R[1][1],M[1][1])]]:M=R}h?.(P,{...x})}).on("drag",P=>{const{transform:k,snapGrid:$,snapToGrid:_,nodeOrigin:H}=n(),L=je(P.sourceEvent,{transform:k,snapGrid:$,snapToGrid:_,containerBounds:y}),T=[];if(!u)return;const{x:D,y:A,width:O,height:V}=x,R={},Z=u.origin??H,{width:W,height:U,x:ee,y:X}=Ti(v,i.controlDirection,L,i.boundaries,i.keepAspectRatio,Z,N,M),j=W!==O,F=U!==V,K=ee!==D&&j,q=X!==A&&F;if(!K&&!q&&!j&&!F)return;if((K||q||Z[0]===1||Z[1]===1)&&(R.x=K?ee:x.x,R.y=q?X:x.y,x.x=R.x,x.y=R.y,S.length>0)){const te=ee-D,oe=X-A;for(const ie of S)ie.position={x:ie.position.x-te+Z[0]*(W-O),y:ie.position.y-oe+Z[1]*(U-V)},T.push(ie)}if((j||F)&&(R.width=j&&(!i.resizeDirection||i.resizeDirection==="horizontal")?W:x.width,R.height=F&&(!i.resizeDirection||i.resizeDirection==="vertical")?U:x.height,x.width=R.width,x.height=R.height),b&&u.expandParent){const te=Z[0]*(R.width??0);R.x&&R.x<te&&(x.x=te,v.x=v.x-(R.x-te));const oe=Z[1]*(R.height??0);R.y&&R.y<oe&&(x.y=oe,v.y=v.y-(R.y-oe))}const Y=$i({width:x.width,prevWidth:O,height:x.height,prevHeight:V,affectsX:i.controlDirection.affectsX,affectsY:i.controlDirection.affectsY}),G={...x,direction:Y};w?.(P,G)!==!1&&(I=!0,m?.(P,G),o(R,T))}).on("end",P=>{I&&(p?.(P,{...x}),s?.({...x}),I=!1)});r.call(z)}function f(){r.on(".drag",null)}return{update:a,destroy:f}}var Ct={exports:{}},Mt={},It={exports:{}},Pt={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vn;function zi(){if(vn)return Pt;vn=1;var e=to();function t(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var n=typeof Object.is=="function"?Object.is:t,o=e.useState,s=e.useEffect,r=e.useLayoutEffect,i=e.useDebugValue;function a(l,c){var h=c(),m=o({inst:{value:h,getSnapshot:c}}),p=m[0].inst,w=m[1];return r(function(){p.value=h,p.getSnapshot=c,f(p)&&w({inst:p})},[l,h,c]),s(function(){return f(p)&&w({inst:p}),l(function(){f(p)&&w({inst:p})})},[l]),i(h),h}function f(l){var c=l.getSnapshot;l=l.value;try{var h=c();return!n(l,h)}catch{return!0}}function d(l,c){return c()}var g=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:a;return Pt.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:g,Pt}var Nn;function Vi(){return Nn||(Nn=1,It.exports=zi()),It.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cn;function Oi(){if(Cn)return Mt;Cn=1;var e=to(),t=Vi();function n(d,g){return d===g&&(d!==0||1/d===1/g)||d!==d&&g!==g}var o=typeof Object.is=="function"?Object.is:n,s=t.useSyncExternalStore,r=e.useRef,i=e.useEffect,a=e.useMemo,f=e.useDebugValue;return Mt.useSyncExternalStoreWithSelector=function(d,g,l,c,h){var m=r(null);if(m.current===null){var p={hasValue:!1,value:null};m.current=p}else p=m.current;m=a(function(){function x(b){if(!v){if(v=!0,u=b,b=c(b),h!==void 0&&p.hasValue){var N=p.value;if(h(N,b))return y=N}return y=b}if(N=y,o(u,b))return N;var M=c(b);return h!==void 0&&h(N,M)?(u=b,N):(u=b,y=M)}var v=!1,u,y,S=l===void 0?null:l;return[function(){return x(g())},S===null?void 0:function(){return x(S())}]},[g,l,c,h]);var w=s(d,m[0],m[1]);return i(function(){p.hasValue=!0,p.value=w},[w]),f(w),w},Mt}var Mn;function Bi(){return Mn||(Mn=1,Ct.exports=Oi()),Ct.exports}var Fi=Bi();const Zi=Cr(Fi),Wi={},In=e=>{let t;const n=new Set,o=(g,l)=>{const c=typeof g=="function"?g(t):g;if(!Object.is(c,t)){const h=t;t=l??(typeof c!="object"||c===null)?c:Object.assign({},t,c),n.forEach(m=>m(t,h))}},s=()=>t,f={setState:o,getState:s,getInitialState:()=>d,subscribe:g=>(n.add(g),()=>n.delete(g)),destroy:()=>{(Wi?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},d=t=e(o,s,f);return f},Yi=e=>e?In(e):In,{useDebugValue:Xi}=Mr,{useSyncExternalStoreWithSelector:Gi}=Zi,Ui=e=>e;function _o(e,t=Ui,n){const o=Gi(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Xi(o),o}const Pn=(e,t)=>{const n=Yi(e),o=(s,r=t)=>_o(n,s,r);return Object.assign(o,n),o},qi=(e,t)=>e?Pn(e,t):Pn;function se(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[o,s]of e)if(!Object.is(s,t.get(o)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}const ut=C.createContext(null),Ki=ut.Provider,Lo=le.error001();function J(e,t){const n=C.useContext(ut);if(n===null)throw new Error(Lo);return _o(n,e,t)}function ne(){const e=C.useContext(ut);if(e===null)throw new Error(Lo);return C.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const kn={display:"none"},Qi={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ro="react-flow__node-desc",jo="react-flow__edge-desc",Ji="react-flow__aria-live",ea=e=>e.ariaLiveMessage,ta=e=>e.ariaLabelConfig;function na({rfId:e}){const t=J(ea);return E.jsx("div",{id:`${Ji}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Qi,children:t})}function oa({rfId:e,disableKeyboardA11y:t}){const n=J(ta);return E.jsxs(E.Fragment,{children:[E.jsx("div",{id:`${Ro}-${e}`,style:kn,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),E.jsx("div",{id:`${jo}-${e}`,style:kn,children:n["edge.a11yDescription.default"]}),!t&&E.jsx(na,{rfId:e})]})}const ft=C.forwardRef(({position:e="top-left",children:t,className:n,style:o,...s},r)=>{const i=`${e}`.split("-");return E.jsx("div",{className:re(["react-flow__panel",n,...i]),style:o,ref:r,...s,children:t})});ft.displayName="Panel";function sa({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:E.jsx(ft,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:E.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const ra=e=>{const t=[],n=[];for(const[,o]of e.nodeLookup)o.selected&&t.push(o.internals.userNode);for(const[,o]of e.edgeLookup)o.selected&&n.push(o);return{selectedNodes:t,selectedEdges:n}},tt=e=>e.id;function ia(e,t){return se(e.selectedNodes.map(tt),t.selectedNodes.map(tt))&&se(e.selectedEdges.map(tt),t.selectedEdges.map(tt))}function aa({onSelectionChange:e}){const t=ne(),{selectedNodes:n,selectedEdges:o}=J(ra,ia);return C.useEffect(()=>{const s={nodes:n,edges:o};e?.(s),t.getState().onSelectionChangeHandlers.forEach(r=>r(s))},[n,o,e]),null}const ca=e=>!!e.onSelectionChangeHandlers;function la({onSelectionChange:e}){const t=J(ca);return e||t?E.jsx(aa,{onSelectionChange:e}):null}const zo=[0,0],da={x:0,y:0,zoom:1},ua=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig"],Dn=[...ua,"rfId"],fa=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),An={translateExtent:ze,nodeOrigin:zo,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function ga(e){const{setNodes:t,setEdges:n,setMinZoom:o,setMaxZoom:s,setTranslateExtent:r,setNodeExtent:i,reset:a,setDefaultNodesAndEdges:f}=J(fa,se),d=ne();C.useEffect(()=>(f(e.defaultNodes,e.defaultEdges),()=>{g.current=An,a()}),[]);const g=C.useRef(An);return C.useEffect(()=>{for(const l of Dn){const c=e[l],h=g.current[l];c!==h&&(typeof e[l]>"u"||(l==="nodes"?t(c):l==="edges"?n(c):l==="minZoom"?o(c):l==="maxZoom"?s(c):l==="translateExtent"?r(c):l==="nodeExtent"?i(c):l==="ariaLabelConfig"?d.setState({ariaLabelConfig:qr(c)}):l==="fitView"?d.setState({fitViewQueued:c}):l==="fitViewOptions"?d.setState({fitViewOptions:c}):d.setState({[l]:c})))}g.current=e},Dn.map(l=>e[l])),null}function Hn(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function ha(e){const[t,n]=C.useState(e==="system"?null:e);return C.useEffect(()=>{if(e!=="system"){n(e);return}const o=Hn(),s=()=>n(o?.matches?"dark":"light");return s(),o?.addEventListener("change",s),()=>{o?.removeEventListener("change",s)}},[e]),t!==null?t:Hn()?.matches?"dark":"light"}const $n=typeof document<"u"?document:null;function Ze(e=null,t={target:$n,actInsideInputWithModifier:!0}){const[n,o]=C.useState(!1),s=C.useRef(!1),r=C.useRef(new Set([])),[i,a]=C.useMemo(()=>{if(e!==null){const d=(Array.isArray(e)?e:[e]).filter(l=>typeof l=="string").map(l=>l.replace("+",`
`).replace(`

`,`
+`).split(`
`)),g=d.reduce((l,c)=>l.concat(...c),[]);return[d,g]}return[[],[]]},[e]);return C.useEffect(()=>{const f=t?.target??$n,d=t?.actInsideInputWithModifier??!0;if(e!==null){const g=h=>{if(s.current=h.ctrlKey||h.metaKey||h.shiftKey||h.altKey,(!s.current||s.current&&!d)&&xo(h))return!1;const p=_n(h.code,a);if(r.current.add(h[p]),Tn(i,r.current,!1)){const w=h.composedPath?.()?.[0]||h.target,x=w?.nodeName==="BUTTON"||w?.nodeName==="A";t.preventDefault!==!1&&(s.current||!x)&&h.preventDefault(),o(!0)}},l=h=>{const m=_n(h.code,a);Tn(i,r.current,!0)?(o(!1),r.current.clear()):r.current.delete(h[m]),h.key==="Meta"&&r.current.clear(),s.current=!1},c=()=>{r.current.clear(),o(!1)};return f?.addEventListener("keydown",g),f?.addEventListener("keyup",l),window.addEventListener("blur",c),window.addEventListener("contextmenu",c),()=>{f?.removeEventListener("keydown",g),f?.removeEventListener("keyup",l),window.removeEventListener("blur",c),window.removeEventListener("contextmenu",c)}}},[e,o]),n}function Tn(e,t,n){return e.filter(o=>n||o.length===t.size).some(o=>o.every(s=>t.has(s)))}function _n(e,t){return t.includes(e)?"code":"key"}const pa=()=>{const e=ne();return C.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:o}=e.getState();return o?o.scaleTo(t,{duration:n?.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[o,s,r],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??o,y:t.y??s,zoom:t.zoom??r},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},setCenter:async(t,n,o)=>e.getState().setCenter(t,n,o),fitBounds:async(t,n)=>{const{width:o,height:s,minZoom:r,maxZoom:i,panZoom:a}=e.getState(),f=Zt(t,o,s,r,i,n?.padding??.1);return a?(await a.setViewport(f,{duration:n?.duration,ease:n?.ease,interpolate:n?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:o,snapGrid:s,snapToGrid:r,domNode:i}=e.getState();if(!i)return t;const{x:a,y:f}=i.getBoundingClientRect(),d={x:t.x-a,y:t.y-f},g=n.snapGrid??s,l=n.snapToGrid??r;return Ge(d,o,l,g)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:s,y:r}=o.getBoundingClientRect(),i=it(t,n);return{x:i.x+s,y:i.y+r}}}),[])};function Vo(e,t){const n=[],o=new Map,s=[];for(const r of e)if(r.type==="add"){s.push(r);continue}else if(r.type==="remove"||r.type==="replace")o.set(r.id,[r]);else{const i=o.get(r.id);i?i.push(r):o.set(r.id,[r])}for(const r of t){const i=o.get(r.id);if(!i){n.push(r);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const a={...r};for(const f of i)ma(f,a);n.push(a)}return s.length&&s.forEach(r=>{r.index!==void 0?n.splice(r.index,0,{...r.item}):n.push({...r.item})}),n}function ma(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??={},t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Oo(e,t){return Vo(e,t)}function Bo(e,t){return Vo(e,t)}function xe(e,t){return{id:e,type:"select",selected:t}}function Me(e,t=new Set,n=!1){const o=[];for(const[s,r]of e){const i=t.has(s);!(r.selected===void 0&&!i)&&r.selected!==i&&(n&&(r.selected=i),o.push(xe(r.id,i)))}return o}function Ln({items:e=[],lookup:t}){const n=[],o=new Map(e.map(s=>[s.id,s]));for(const[s,r]of e.entries()){const i=t.get(r.id),a=i?.internals?.userNode??i;a!==void 0&&a!==r&&n.push({id:r.id,item:r,type:"replace"}),a===void 0&&n.push({item:r,type:"add",index:s})}for(const[s]of t)o.get(s)===void 0&&n.push({id:s,type:"remove"});return n}function Rn(e){return{id:e.id,type:"remove"}}const jn=e=>Vr(e),ya=e=>lo(e);function Fo(e){return C.forwardRef(e)}const xa=typeof window<"u"?C.useLayoutEffect:C.useEffect;function zn(e){const[t,n]=C.useState(BigInt(0)),[o]=C.useState(()=>wa(()=>n(s=>s+BigInt(1))));return xa(()=>{const s=o.get();s.length&&(e(s),o.reset())},[t]),o}function wa(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Zo=C.createContext(null);function ba({children:e}){const t=ne(),n=C.useCallback(a=>{const{nodes:f=[],setNodes:d,hasDefaultNodes:g,onNodesChange:l,nodeLookup:c,fitViewQueued:h}=t.getState();let m=f;for(const w of a)m=typeof w=="function"?w(m):w;const p=Ln({items:m,lookup:c});g&&d(m),p.length>0?l?.(p):h&&window.requestAnimationFrame(()=>{const{fitViewQueued:w,nodes:x,setNodes:v}=t.getState();w&&v(x)})},[]),o=zn(n),s=C.useCallback(a=>{const{edges:f=[],setEdges:d,hasDefaultEdges:g,onEdgesChange:l,edgeLookup:c}=t.getState();let h=f;for(const m of a)h=typeof m=="function"?m(h):m;g?d(h):l&&l(Ln({items:h,lookup:c}))},[]),r=zn(s),i=C.useMemo(()=>({nodeQueue:o,edgeQueue:r}),[]);return E.jsx(Zo.Provider,{value:i,children:e})}function Ea(){const e=C.useContext(Zo);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Sa=e=>!!e.panZoom;function qt(){const e=pa(),t=ne(),n=Ea(),o=J(Sa),s=C.useMemo(()=>{const r=l=>t.getState().nodeLookup.get(l),i=l=>{n.nodeQueue.push(l)},a=l=>{n.edgeQueue.push(l)},f=l=>{const{nodeLookup:c,nodeOrigin:h}=t.getState(),m=jn(l)?l:c.get(l.id),p=m.parentId?mo(m.position,m.measured,m.parentId,c,h):m.position,w={...m,position:p,width:m.measured?.width??m.width,height:m.measured?.height??m.height};return De(w)},d=(l,c,h={replace:!1})=>{i(m=>m.map(p=>{if(p.id===l){const w=typeof c=="function"?c(p):c;return h.replace&&jn(w)?w:{...p,...w}}return p}))},g=(l,c,h={replace:!1})=>{a(m=>m.map(p=>{if(p.id===l){const w=typeof c=="function"?c(p):c;return h.replace&&ya(w)?w:{...p,...w}}return p}))};return{getNodes:()=>t.getState().nodes.map(l=>({...l})),getNode:l=>r(l)?.internals.userNode,getInternalNode:r,getEdges:()=>{const{edges:l=[]}=t.getState();return l.map(c=>({...c}))},getEdge:l=>t.getState().edgeLookup.get(l),setNodes:i,setEdges:a,addNodes:l=>{const c=Array.isArray(l)?l:[l];n.nodeQueue.push(h=>[...h,...c])},addEdges:l=>{const c=Array.isArray(l)?l:[l];n.edgeQueue.push(h=>[...h,...c])},toObject:()=>{const{nodes:l=[],edges:c=[],transform:h}=t.getState(),[m,p,w]=h;return{nodes:l.map(x=>({...x})),edges:c.map(x=>({...x})),viewport:{x:m,y:p,zoom:w}}},deleteElements:async({nodes:l=[],edges:c=[]})=>{const{nodes:h,edges:m,onNodesDelete:p,onEdgesDelete:w,triggerNodeChanges:x,triggerEdgeChanges:v,onDelete:u,onBeforeDelete:y}=t.getState(),{nodes:S,edges:b}=await Wr({nodesToRemove:l,edgesToRemove:c,nodes:h,edges:m,onBeforeDelete:y}),N=b.length>0,M=S.length>0;if(N){const I=b.map(Rn);w?.(b),v(I)}if(M){const I=S.map(Rn);p?.(S),x(I)}return(M||N)&&u?.({nodes:S,edges:b}),{deletedNodes:S,deletedEdges:b}},getIntersectingNodes:(l,c=!0,h)=>{const m=dn(l),p=m?l:f(l),w=h!==void 0;return p?(h||t.getState().nodes).filter(x=>{const v=t.getState().nodeLookup.get(x.id);if(v&&!m&&(x.id===l.id||!v.internals.positionAbsolute))return!1;const u=De(w?x:v),y=Oe(u,p);return c&&y>0||y>=u.width*u.height||y>=p.width*p.height}):[]},isNodeIntersecting:(l,c,h=!0)=>{const p=dn(l)?l:f(l);if(!p)return!1;const w=Oe(p,c);return h&&w>0||w>=c.width*c.height||w>=p.width*p.height},updateNode:d,updateNodeData:(l,c,h={replace:!1})=>{d(l,m=>{const p=typeof c=="function"?c(m):c;return h.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},h)},updateEdge:g,updateEdgeData:(l,c,h={replace:!1})=>{g(l,m=>{const p=typeof c=="function"?c(m):c;return h.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},h)},getNodesBounds:l=>{const{nodeLookup:c,nodeOrigin:h}=t.getState();return Or(l,{nodeLookup:c,nodeOrigin:h})},getHandleConnections:({type:l,id:c,nodeId:h})=>Array.from(t.getState().connectionLookup.get(`${h}-${l}${c?`-${c}`:""}`)?.values()??[]),getNodeConnections:({type:l,handleId:c,nodeId:h})=>Array.from(t.getState().connectionLookup.get(`${h}${l?c?`-${l}-${c}`:`-${l}`:""}`)?.values()??[]),fitView:async l=>{const c=t.getState().fitViewResolver??Ur();return t.setState({fitViewQueued:!0,fitViewOptions:l,fitViewResolver:c}),n.nodeQueue.push(h=>[...h]),c.promise}}},[]);return C.useMemo(()=>({...s,...e,viewportInitialized:o}),[o])}const Vn=e=>e.selected,va=typeof window<"u"?window:void 0;function Na({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=ne(),{deleteElements:o}=qt(),s=Ze(e,{actInsideInputWithModifier:!1}),r=Ze(t,{target:va});C.useEffect(()=>{if(s){const{edges:i,nodes:a}=n.getState();o({nodes:a.filter(Vn),edges:i.filter(Vn)}),n.setState({nodesSelectionActive:!1})}},[s]),C.useEffect(()=>{n.setState({multiSelectionActive:r})},[r])}function Ca(e){const t=ne();C.useEffect(()=>{const n=()=>{if(!e.current||!(e.current.checkVisibility?.()??!0))return!1;const o=Wt(e.current);(o.height===0||o.width===0)&&t.getState().onError?.("004",le.error004()),t.setState({width:o.width||500,height:o.height||500})};if(e.current){n(),window.addEventListener("resize",n);const o=new ResizeObserver(()=>n());return o.observe(e.current),()=>{window.removeEventListener("resize",n),o&&e.current&&o.unobserve(e.current)}}},[])}const gt={position:"absolute",width:"100%",height:"100%",top:0,left:0},Ma=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function Ia({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:o=!1,panOnScrollSpeed:s=.5,panOnScrollMode:r=we.Free,zoomOnDoubleClick:i=!0,panOnDrag:a=!0,defaultViewport:f,translateExtent:d,minZoom:g,maxZoom:l,zoomActivationKeyCode:c,preventScrolling:h=!0,children:m,noWheelClassName:p,noPanClassName:w,onViewportChange:x,isControlledViewport:v,paneClickDistance:u,selectionOnDrag:y}){const S=ne(),b=C.useRef(null),{userSelectionActive:N,lib:M,connectionInProgress:I}=J(Ma,se),z=Ze(c),P=C.useRef();Ca(b);const k=C.useCallback($=>{x?.({x:$[0],y:$[1],zoom:$[2]}),v||S.setState({transform:$})},[x,v]);return C.useEffect(()=>{if(b.current){P.current=Hi({domNode:b.current,minZoom:g,maxZoom:l,translateExtent:d,viewport:f,onDraggingChange:L=>S.setState({paneDragging:L}),onPanZoomStart:(L,T)=>{const{onViewportChangeStart:D,onMoveStart:A}=S.getState();A?.(L,T),D?.(T)},onPanZoom:(L,T)=>{const{onViewportChange:D,onMove:A}=S.getState();A?.(L,T),D?.(T)},onPanZoomEnd:(L,T)=>{const{onViewportChangeEnd:D,onMoveEnd:A}=S.getState();A?.(L,T),D?.(T)}});const{x:$,y:_,zoom:H}=P.current.getViewport();return S.setState({panZoom:P.current,transform:[$,_,H],domNode:b.current.closest(".react-flow")}),()=>{P.current?.destroy()}}},[]),C.useEffect(()=>{P.current?.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:o,panOnScrollSpeed:s,panOnScrollMode:r,zoomOnDoubleClick:i,panOnDrag:a,zoomActivationKeyPressed:z,preventScrolling:h,noPanClassName:w,userSelectionActive:N,noWheelClassName:p,lib:M,onTransformChange:k,connectionInProgress:I,selectionOnDrag:y,paneClickDistance:u})},[e,t,n,o,s,r,i,a,z,h,w,N,p,M,k,I,y,u]),E.jsx("div",{className:"react-flow__renderer",ref:b,style:gt,children:m})}const Pa=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function ka(){const{userSelectionActive:e,userSelectionRect:t}=J(Pa,se);return e&&t?E.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const kt=(e,t)=>n=>{n.target===t.current&&e?.(n)},Da=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function Aa({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Ve.Full,panOnDrag:o,paneClickDistance:s,selectionOnDrag:r,onSelectionStart:i,onSelectionEnd:a,onPaneClick:f,onPaneContextMenu:d,onPaneScroll:g,onPaneMouseEnter:l,onPaneMouseMove:c,onPaneMouseLeave:h,children:m}){const p=ne(),{userSelectionActive:w,elementsSelectable:x,dragging:v,connectionInProgress:u}=J(Da,se),y=x&&(e||w),S=C.useRef(null),b=C.useRef(),N=C.useRef(new Set),M=C.useRef(new Set),I=C.useRef(!1),z=D=>{if(I.current||u){I.current=!1;return}f?.(D),p.getState().resetSelectedElements(),p.setState({nodesSelectionActive:!1})},P=D=>{if(Array.isArray(o)&&o?.includes(2)){D.preventDefault();return}d?.(D)},k=g?D=>g(D):void 0,$=D=>{I.current&&(D.stopPropagation(),I.current=!1)},_=D=>{const{resetSelectedElements:A,domNode:O}=p.getState();if(b.current=O?.getBoundingClientRect(),!b.current)return;const V=D.target===S.current;if(!V&&!!D.target.closest(".nokey")||!e||!(r&&V||t)||D.button!==0||!D.isPrimary)return;D.target?.setPointerCapture?.(D.pointerId),I.current=!1;const{x:W,y:U}=ce(D.nativeEvent,b.current);p.setState({userSelectionRect:{width:0,height:0,startX:W,startY:U,x:W,y:U}}),V||(D.stopPropagation(),D.preventDefault()),(s===0||t)&&(A(),i?.(D),I.current=!0)},H=D=>{const{userSelectionRect:A,transform:O,nodeLookup:V,edgeLookup:R,connectionLookup:Z,triggerNodeChanges:W,triggerEdgeChanges:U,defaultEdgeOptions:ee,resetSelectedElements:X}=p.getState();if(!b.current||!A)return;const{x:j,y:F}=ce(D.nativeEvent,b.current),{startX:K,startY:q}=A;if(!I.current&&D.target===S.current&&!t&&s>0){if(Math.hypot(j-K,F-q)<=s)return;X(),i?.(D)}I.current=!0;const Y={startX:K,startY:q,x:j<K?j:K,y:F<q?F:q,width:Math.abs(j-K),height:Math.abs(F-q)},G=N.current,Q=M.current;N.current=new Set(Ft(V,Y,O,n===Ve.Partial,!0).map(oe=>oe.id)),M.current=new Set;const te=ee?.selectable??!0;for(const oe of N.current){const ie=Z.get(oe);if(ie)for(const{edgeId:de}of ie.values()){const ye=R.get(de);ye&&(ye.selectable??te)&&M.current.add(de)}}if(!un(G,N.current)){const oe=Me(V,N.current,!0);W(oe)}if(!un(Q,M.current)){const oe=Me(R,M.current);U(oe)}p.setState({userSelectionRect:Y,userSelectionActive:!0,nodesSelectionActive:!1})},L=D=>{D.button===0&&(D.target?.releasePointerCapture?.(D.pointerId),!w&&D.target===S.current&&p.getState().userSelectionRect&&z?.(D),p.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:N.current.size>0}),I.current&&a?.(D))},T=o===!0||Array.isArray(o)&&o.includes(0);return E.jsxs("div",{className:re(["react-flow__pane",{draggable:T,dragging:v,selection:e}]),onClick:y?void 0:kt(z,S),onContextMenu:kt(P,S),onWheel:kt(k,S),onPointerEnter:y?void 0:l,onPointerMove:y?H:c,onPointerUp:y?L:void 0,onPointerDownCapture:y?_:void 0,onClickCapture:y?$:void 0,onPointerLeave:h,ref:S,style:gt,children:[m,E.jsx(ka,{})]})}function jt({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:s,unselectNodesAndEdges:r,multiSelectionActive:i,nodeLookup:a,onError:f}=t.getState(),d=a.get(e);if(!d){f?.("012",le.error012(e));return}t.setState({nodesSelectionActive:!1}),d.selected?(n||d.selected&&i)&&(r({nodes:[d],edges:[]}),requestAnimationFrame(()=>o?.current?.blur())):s([e])}function Wo({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:s,isSelectable:r,nodeClickDistance:i}){const a=ne(),[f,d]=C.useState(!1),g=C.useRef();return C.useEffect(()=>{g.current=xi({getStoreItems:()=>a.getState(),onNodeMouseDown:l=>{jt({id:l,store:a,nodeRef:e})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),C.useEffect(()=>{if(t)g.current?.destroy();else if(e.current)return g.current?.update({noDragClassName:n,handleSelector:o,domNode:e.current,isSelectable:r,nodeId:s,nodeClickDistance:i}),()=>{g.current?.destroy()}},[n,o,t,r,e,s]),f}const Ha=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Yo(){const e=ne();return C.useCallback(n=>{const{nodeExtent:o,snapToGrid:s,snapGrid:r,nodesDraggable:i,onError:a,updateNodePositions:f,nodeLookup:d,nodeOrigin:g}=e.getState(),l=new Map,c=Ha(i),h=s?r[0]:5,m=s?r[1]:5,p=n.direction.x*h*n.factor,w=n.direction.y*m*n.factor;for(const[,x]of d){if(!c(x))continue;let v={x:x.internals.positionAbsolute.x+p,y:x.internals.positionAbsolute.y+w};s&&(v=Xe(v,r));const{position:u,positionAbsolute:y}=uo({nodeId:x.id,nextPosition:v,nodeLookup:d,nodeExtent:o,nodeOrigin:g,onError:a});x.position=u,x.internals.positionAbsolute=y,l.set(x.id,x)}f(l)},[])}const Kt=C.createContext(null),$a=Kt.Provider;Kt.Consumer;const Xo=()=>C.useContext(Kt),Ta=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),_a=(e,t,n)=>o=>{const{connectionClickStartHandle:s,connectionMode:r,connection:i}=o,{fromHandle:a,toHandle:f,isValid:d}=i,g=f?.nodeId===e&&f?.id===t&&f?.type===n;return{connectingFrom:a?.nodeId===e&&a?.id===t&&a?.type===n,connectingTo:g,clickConnecting:s?.nodeId===e&&s?.id===t&&s?.type===n,isPossibleEndHandle:r===Pe.Strict?a?.type!==n:e!==a?.nodeId||t!==a?.id,connectionInProcess:!!a,clickConnectionInProcess:!!s,valid:g&&d}};function La({type:e="source",position:t=B.Top,isValidConnection:n,isConnectable:o=!0,isConnectableStart:s=!0,isConnectableEnd:r=!0,id:i,onConnect:a,children:f,className:d,onMouseDown:g,onTouchStart:l,...c},h){const m=i||null,p=e==="target",w=ne(),x=Xo(),{connectOnClick:v,noPanClassName:u,rfId:y}=J(Ta,se),{connectingFrom:S,connectingTo:b,clickConnecting:N,isPossibleEndHandle:M,connectionInProcess:I,clickConnectionInProcess:z,valid:P}=J(_a(x,m,e),se);x||w.getState().onError?.("010",le.error010());const k=H=>{const{defaultEdgeOptions:L,onConnect:T,hasDefaultEdges:D}=w.getState(),A={...L,...H};if(D){const{edges:O,setEdges:V}=w.getState();V(ni(A,O))}T?.(A),a?.(A)},$=H=>{if(!x)return;const L=wo(H.nativeEvent);if(s&&(L&&H.button===0||!L)){const T=w.getState();Rt.onPointerDown(H.nativeEvent,{handleDomNode:H.currentTarget,autoPanOnConnect:T.autoPanOnConnect,connectionMode:T.connectionMode,connectionRadius:T.connectionRadius,domNode:T.domNode,nodeLookup:T.nodeLookup,lib:T.lib,isTarget:p,handleId:m,nodeId:x,flowId:T.rfId,panBy:T.panBy,cancelConnection:T.cancelConnection,onConnectStart:T.onConnectStart,onConnectEnd:T.onConnectEnd,updateConnection:T.updateConnection,onConnect:k,isValidConnection:n||T.isValidConnection,getTransform:()=>w.getState().transform,getFromHandle:()=>w.getState().connection.fromHandle,autoPanSpeed:T.autoPanSpeed,dragThreshold:T.connectionDragThreshold})}L?g?.(H):l?.(H)},_=H=>{const{onClickConnectStart:L,onClickConnectEnd:T,connectionClickStartHandle:D,connectionMode:A,isValidConnection:O,lib:V,rfId:R,nodeLookup:Z,connection:W}=w.getState();if(!x||!D&&!s)return;if(!D){L?.(H.nativeEvent,{nodeId:x,handleId:m,handleType:e}),w.setState({connectionClickStartHandle:{nodeId:x,type:e,id:m}});return}const U=yo(H.target),ee=n||O,{connection:X,isValid:j}=Rt.isValid(H.nativeEvent,{handle:{nodeId:x,id:m,type:e},connectionMode:A,fromNodeId:D.nodeId,fromHandleId:D.id||null,fromType:D.type,isValidConnection:ee,flowId:R,doc:U,lib:V,nodeLookup:Z});j&&X&&k(X);const F=structuredClone(W);delete F.inProgress,F.toPosition=F.toHandle?F.toHandle.position:null,T?.(H,F),w.setState({connectionClickStartHandle:null})};return E.jsx("div",{"data-handleid":m,"data-nodeid":x,"data-handlepos":t,"data-id":`${y}-${x}-${m}-${e}`,className:re(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",u,d,{source:!p,target:p,connectable:o,connectablestart:s,connectableend:r,clickconnecting:N,connectingfrom:S,connectingto:b,valid:P,connectionindicator:o&&(!I||M)&&(I||z?r:s)}]),onMouseDown:$,onTouchStart:$,onClick:v?_:void 0,ref:h,...c,children:f})}const me=C.memo(Fo(La));function Ra({data:e,isConnectable:t,sourcePosition:n=B.Bottom}){return E.jsxs(E.Fragment,{children:[e?.label,E.jsx(me,{type:"source",position:n,isConnectable:t})]})}function ja({data:e,isConnectable:t,targetPosition:n=B.Top,sourcePosition:o=B.Bottom}){return E.jsxs(E.Fragment,{children:[E.jsx(me,{type:"target",position:n,isConnectable:t}),e?.label,E.jsx(me,{type:"source",position:o,isConnectable:t})]})}function za(){return null}function Va({data:e,isConnectable:t,targetPosition:n=B.Top}){return E.jsxs(E.Fragment,{children:[E.jsx(me,{type:"target",position:n,isConnectable:t}),e?.label]})}const at={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},On={input:Ra,default:ja,output:Va,group:za};function Oa(e){return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??e.style?.width,height:e.height??e.initialHeight??e.style?.height}:{width:e.width??e.style?.width,height:e.height??e.style?.height}}const Ba=e=>{const{width:t,height:n,x:o,y:s}=Ye(e.nodeLookup,{filter:r=>!!r.selected});return{width:ae(t)?t:null,height:ae(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${o}px,${s}px)`}};function Fa({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const o=ne(),{width:s,height:r,transformString:i,userSelectionActive:a}=J(Ba,se),f=Yo(),d=C.useRef(null);if(C.useEffect(()=>{n||d.current?.focus({preventScroll:!0})},[n]),Wo({nodeRef:d}),a||!s||!r)return null;const g=e?c=>{const h=o.getState().nodes.filter(m=>m.selected);e(c,h)}:void 0,l=c=>{Object.prototype.hasOwnProperty.call(at,c.key)&&(c.preventDefault(),f({direction:at[c.key],factor:c.shiftKey?4:1}))};return E.jsx("div",{className:re(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:E.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:g,tabIndex:n?void 0:-1,onKeyDown:n?void 0:l,style:{width:s,height:r}})})}const Bn=typeof window<"u"?window:void 0,Za=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Go({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:s,onPaneContextMenu:r,onPaneScroll:i,paneClickDistance:a,deleteKeyCode:f,selectionKeyCode:d,selectionOnDrag:g,selectionMode:l,onSelectionStart:c,onSelectionEnd:h,multiSelectionKeyCode:m,panActivationKeyCode:p,zoomActivationKeyCode:w,elementsSelectable:x,zoomOnScroll:v,zoomOnPinch:u,panOnScroll:y,panOnScrollSpeed:S,panOnScrollMode:b,zoomOnDoubleClick:N,panOnDrag:M,defaultViewport:I,translateExtent:z,minZoom:P,maxZoom:k,preventScrolling:$,onSelectionContextMenu:_,noWheelClassName:H,noPanClassName:L,disableKeyboardA11y:T,onViewportChange:D,isControlledViewport:A}){const{nodesSelectionActive:O,userSelectionActive:V}=J(Za),R=Ze(d,{target:Bn}),Z=Ze(p,{target:Bn}),W=Z||M,U=Z||y,ee=g&&W!==!0,X=R||V||ee;return Na({deleteKeyCode:f,multiSelectionKeyCode:m}),E.jsx(Ia,{onPaneContextMenu:r,elementsSelectable:x,zoomOnScroll:v,zoomOnPinch:u,panOnScroll:U,panOnScrollSpeed:S,panOnScrollMode:b,zoomOnDoubleClick:N,panOnDrag:!R&&W,defaultViewport:I,translateExtent:z,minZoom:P,maxZoom:k,zoomActivationKeyCode:w,preventScrolling:$,noWheelClassName:H,noPanClassName:L,onViewportChange:D,isControlledViewport:A,paneClickDistance:a,selectionOnDrag:ee,children:E.jsxs(Aa,{onSelectionStart:c,onSelectionEnd:h,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:s,onPaneContextMenu:r,onPaneScroll:i,panOnDrag:W,isSelecting:!!X,selectionMode:l,selectionKeyPressed:R,paneClickDistance:a,selectionOnDrag:ee,children:[e,O&&E.jsx(Fa,{onSelectionContextMenu:_,noPanClassName:L,disableKeyboardA11y:T})]})})}Go.displayName="FlowRenderer";const Wa=C.memo(Go),Ya=e=>t=>e?Ft(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function Xa(e){return J(C.useCallback(Ya(e),[e]),se)}const Ga=e=>e.updateNodeInternals;function Ua(){const e=J(Ga),[t]=C.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const o=new Map;n.forEach(s=>{const r=s.target.getAttribute("data-id");o.set(r,{id:r,nodeElement:s.target,force:!0})}),e(o)}));return C.useEffect(()=>()=>{t?.disconnect()},[t]),t}function qa({node:e,nodeType:t,hasDimensions:n,resizeObserver:o}){const s=ne(),r=C.useRef(null),i=C.useRef(null),a=C.useRef(e.sourcePosition),f=C.useRef(e.targetPosition),d=C.useRef(t),g=n&&!!e.internals.handleBounds;return C.useEffect(()=>{r.current&&!e.hidden&&(!g||i.current!==r.current)&&(i.current&&o?.unobserve(i.current),o?.observe(r.current),i.current=r.current)},[g,e.hidden]),C.useEffect(()=>()=>{i.current&&(o?.unobserve(i.current),i.current=null)},[]),C.useEffect(()=>{if(r.current){const l=d.current!==t,c=a.current!==e.sourcePosition,h=f.current!==e.targetPosition;(l||c||h)&&(d.current=t,a.current=e.sourcePosition,f.current=e.targetPosition,s.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:r.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),r}function Ka({id:e,onClick:t,onMouseEnter:n,onMouseMove:o,onMouseLeave:s,onContextMenu:r,onDoubleClick:i,nodesDraggable:a,elementsSelectable:f,nodesConnectable:d,nodesFocusable:g,resizeObserver:l,noDragClassName:c,noPanClassName:h,disableKeyboardA11y:m,rfId:p,nodeTypes:w,nodeClickDistance:x,onError:v}){const{node:u,internals:y,isParent:S}=J(j=>{const F=j.nodeLookup.get(e),K=j.parentLookup.has(e);return{node:F,internals:F.internals,isParent:K}},se);let b=u.type||"default",N=w?.[b]||On[b];N===void 0&&(v?.("003",le.error003(b)),b="default",N=w?.default||On.default);const M=!!(u.draggable||a&&typeof u.draggable>"u"),I=!!(u.selectable||f&&typeof u.selectable>"u"),z=!!(u.connectable||d&&typeof u.connectable>"u"),P=!!(u.focusable||g&&typeof u.focusable>"u"),k=ne(),$=po(u),_=qa({node:u,nodeType:b,hasDimensions:$,resizeObserver:l}),H=Wo({nodeRef:_,disabled:u.hidden||!M,noDragClassName:c,handleSelector:u.dragHandle,nodeId:e,isSelectable:I,nodeClickDistance:x}),L=Yo();if(u.hidden)return null;const T=fe(u),D=Oa(u),A=I||M||t||n||o||s,O=n?j=>n(j,{...y.userNode}):void 0,V=o?j=>o(j,{...y.userNode}):void 0,R=s?j=>s(j,{...y.userNode}):void 0,Z=r?j=>r(j,{...y.userNode}):void 0,W=i?j=>i(j,{...y.userNode}):void 0,U=j=>{const{selectNodesOnDrag:F,nodeDragThreshold:K}=k.getState();I&&(!F||!M||K>0)&&jt({id:e,store:k,nodeRef:_}),t&&t(j,{...y.userNode})},ee=j=>{if(!(xo(j.nativeEvent)||m)){if(ro.includes(j.key)&&I){const F=j.key==="Escape";jt({id:e,store:k,unselect:F,nodeRef:_})}else if(M&&u.selected&&Object.prototype.hasOwnProperty.call(at,j.key)){j.preventDefault();const{ariaLabelConfig:F}=k.getState();k.setState({ariaLiveMessage:F["node.a11yDescription.ariaLiveMessage"]({direction:j.key.replace("Arrow","").toLowerCase(),x:~~y.positionAbsolute.x,y:~~y.positionAbsolute.y})}),L({direction:at[j.key],factor:j.shiftKey?4:1})}}},X=()=>{if(m||!_.current?.matches(":focus-visible"))return;const{transform:j,width:F,height:K,autoPanOnNodeFocus:q,setCenter:Y}=k.getState();if(!q)return;Ft(new Map([[e,u]]),{x:0,y:0,width:F,height:K},j,!0).length>0||Y(u.position.x+T.width/2,u.position.y+T.height/2,{zoom:j[2]})};return E.jsx("div",{className:re(["react-flow__node",`react-flow__node-${b}`,{[h]:M},u.className,{selected:u.selected,selectable:I,parent:S,draggable:M,dragging:H}]),ref:_,style:{zIndex:y.z,transform:`translate(${y.positionAbsolute.x}px,${y.positionAbsolute.y}px)`,pointerEvents:A?"all":"none",visibility:$?"visible":"hidden",...u.style,...D},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:O,onMouseMove:V,onMouseLeave:R,onContextMenu:Z,onClick:U,onDoubleClick:W,onKeyDown:P?ee:void 0,tabIndex:P?0:void 0,onFocus:P?X:void 0,role:u.ariaRole??(P?"group":void 0),"aria-roledescription":"node","aria-describedby":m?void 0:`${Ro}-${p}`,"aria-label":u.ariaLabel,...u.domAttributes,children:E.jsx($a,{value:e,children:E.jsx(N,{id:e,data:u.data,type:b,positionAbsoluteX:y.positionAbsolute.x,positionAbsoluteY:y.positionAbsolute.y,selected:u.selected??!1,selectable:I,draggable:M,deletable:u.deletable??!0,isConnectable:z,sourcePosition:u.sourcePosition,targetPosition:u.targetPosition,dragging:H,dragHandle:u.dragHandle,zIndex:y.z,parentId:u.parentId,...T})})})}var Qa=C.memo(Ka);const Ja=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Uo(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:s,onError:r}=J(Ja,se),i=Xa(e.onlyRenderVisibleElements),a=Ua();return E.jsx("div",{className:"react-flow__nodes",style:gt,children:i.map(f=>E.jsx(Qa,{id:f,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:s,nodeClickDistance:e.nodeClickDistance,onError:r},f))})}Uo.displayName="NodeRenderer";const ec=C.memo(Uo);function tc(e){return J(C.useCallback(n=>{if(!e)return n.edges.map(s=>s.id);const o=[];if(n.width&&n.height)for(const s of n.edges){const r=n.nodeLookup.get(s.source),i=n.nodeLookup.get(s.target);r&&i&&Jr({sourceNode:r,targetNode:i,width:n.width,height:n.height,transform:n.transform})&&o.push(s.id)}return o},[e]),se)}const nc=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return E.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},oc=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return E.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Fn={[st.Arrow]:nc,[st.ArrowClosed]:oc};function sc(e){const t=ne();return C.useMemo(()=>Object.prototype.hasOwnProperty.call(Fn,e)?Fn[e]:(t.getState().onError?.("009",le.error009(e)),null),[e])}const rc=({id:e,type:t,color:n,width:o=12.5,height:s=12.5,markerUnits:r="strokeWidth",strokeWidth:i,orient:a="auto-start-reverse"})=>{const f=sc(t);return f?E.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${o}`,markerHeight:`${s}`,viewBox:"-10 -10 20 20",markerUnits:r,orient:a,refX:"0",refY:"0",children:E.jsx(f,{color:n,strokeWidth:i})}):null},qo=({defaultColor:e,rfId:t})=>{const n=J(r=>r.edges),o=J(r=>r.defaultEdgeOptions),s=C.useMemo(()=>ai(n,{id:t,defaultColor:e,defaultMarkerStart:o?.markerStart,defaultMarkerEnd:o?.markerEnd}),[n,o,t,e]);return s.length?E.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:E.jsx("defs",{children:s.map(r=>E.jsx(rc,{id:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient},r.id))})}):null};qo.displayName="MarkerDefinitions";var ic=C.memo(qo);function Ko({x:e,y:t,label:n,labelStyle:o,labelShowBg:s=!0,labelBgStyle:r,labelBgPadding:i=[2,4],labelBgBorderRadius:a=2,children:f,className:d,...g}){const[l,c]=C.useState({x:1,y:0,width:0,height:0}),h=re(["react-flow__edge-textwrapper",d]),m=C.useRef(null);return C.useEffect(()=>{if(m.current){const p=m.current.getBBox();c({x:p.x,y:p.y,width:p.width,height:p.height})}},[n]),n?E.jsxs("g",{transform:`translate(${e-l.width/2} ${t-l.height/2})`,className:h,visibility:l.width?"visible":"hidden",...g,children:[s&&E.jsx("rect",{width:l.width+2*i[0],x:-i[0],y:-i[1],height:l.height+2*i[1],className:"react-flow__edge-textbg",style:r,rx:a,ry:a}),E.jsx("text",{className:"react-flow__edge-text",y:l.height/2,dy:"0.3em",ref:m,style:o,children:n}),f]}):null}Ko.displayName="EdgeText";const ac=C.memo(Ko);function ht({path:e,labelX:t,labelY:n,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:f,interactionWidth:d=20,...g}){return E.jsxs(E.Fragment,{children:[E.jsx("path",{...g,d:e,fill:"none",className:re(["react-flow__edge-path",g.className])}),d?E.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:d,className:"react-flow__edge-interaction"}):null,o&&ae(t)&&ae(n)?E.jsx(ac,{x:t,y:n,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:f}):null]})}function Zn({pos:e,x1:t,y1:n,x2:o,y2:s}){return e===B.Left||e===B.Right?[.5*(t+o),n]:[t,.5*(n+s)]}function Qo({sourceX:e,sourceY:t,sourcePosition:n=B.Bottom,targetX:o,targetY:s,targetPosition:r=B.Top}){const[i,a]=Zn({pos:n,x1:e,y1:t,x2:o,y2:s}),[f,d]=Zn({pos:r,x1:o,y1:s,x2:e,y2:t}),[g,l,c,h]=bo({sourceX:e,sourceY:t,targetX:o,targetY:s,sourceControlX:i,sourceControlY:a,targetControlX:f,targetControlY:d});return[`M${e},${t} C${i},${a} ${f},${d} ${o},${s}`,g,l,c,h]}function Jo(e){return C.memo(({id:t,sourceX:n,sourceY:o,targetX:s,targetY:r,sourcePosition:i,targetPosition:a,label:f,labelStyle:d,labelShowBg:g,labelBgStyle:l,labelBgPadding:c,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:w,interactionWidth:x})=>{const[v,u,y]=Qo({sourceX:n,sourceY:o,sourcePosition:i,targetX:s,targetY:r,targetPosition:a}),S=e.isInternal?void 0:t;return E.jsx(ht,{id:S,path:v,labelX:u,labelY:y,label:f,labelStyle:d,labelShowBg:g,labelBgStyle:l,labelBgPadding:c,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:w,interactionWidth:x})})}const cc=Jo({isInternal:!1}),es=Jo({isInternal:!0});cc.displayName="SimpleBezierEdge";es.displayName="SimpleBezierEdgeInternal";function ts(e){return C.memo(({id:t,sourceX:n,sourceY:o,targetX:s,targetY:r,label:i,labelStyle:a,labelShowBg:f,labelBgStyle:d,labelBgPadding:g,labelBgBorderRadius:l,style:c,sourcePosition:h=B.Bottom,targetPosition:m=B.Top,markerEnd:p,markerStart:w,pathOptions:x,interactionWidth:v})=>{const[u,y,S]=Tt({sourceX:n,sourceY:o,sourcePosition:h,targetX:s,targetY:r,targetPosition:m,borderRadius:x?.borderRadius,offset:x?.offset,stepPosition:x?.stepPosition}),b=e.isInternal?void 0:t;return E.jsx(ht,{id:b,path:u,labelX:y,labelY:S,label:i,labelStyle:a,labelShowBg:f,labelBgStyle:d,labelBgPadding:g,labelBgBorderRadius:l,style:c,markerEnd:p,markerStart:w,interactionWidth:v})})}const ns=ts({isInternal:!1}),os=ts({isInternal:!0});ns.displayName="SmoothStepEdge";os.displayName="SmoothStepEdgeInternal";function ss(e){return C.memo(({id:t,...n})=>{const o=e.isInternal?void 0:t;return E.jsx(ns,{...n,id:o,pathOptions:C.useMemo(()=>({borderRadius:0,offset:n.pathOptions?.offset}),[n.pathOptions?.offset])})})}const lc=ss({isInternal:!1}),rs=ss({isInternal:!0});lc.displayName="StepEdge";rs.displayName="StepEdgeInternal";function is(e){return C.memo(({id:t,sourceX:n,sourceY:o,targetX:s,targetY:r,label:i,labelStyle:a,labelShowBg:f,labelBgStyle:d,labelBgPadding:g,labelBgBorderRadius:l,style:c,markerEnd:h,markerStart:m,interactionWidth:p})=>{const[w,x,v]=vo({sourceX:n,sourceY:o,targetX:s,targetY:r}),u=e.isInternal?void 0:t;return E.jsx(ht,{id:u,path:w,labelX:x,labelY:v,label:i,labelStyle:a,labelShowBg:f,labelBgStyle:d,labelBgPadding:g,labelBgBorderRadius:l,style:c,markerEnd:h,markerStart:m,interactionWidth:p})})}const dc=is({isInternal:!1}),as=is({isInternal:!0});dc.displayName="StraightEdge";as.displayName="StraightEdgeInternal";function cs(e){return C.memo(({id:t,sourceX:n,sourceY:o,targetX:s,targetY:r,sourcePosition:i=B.Bottom,targetPosition:a=B.Top,label:f,labelStyle:d,labelShowBg:g,labelBgStyle:l,labelBgPadding:c,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:w,pathOptions:x,interactionWidth:v})=>{const[u,y,S]=Eo({sourceX:n,sourceY:o,sourcePosition:i,targetX:s,targetY:r,targetPosition:a,curvature:x?.curvature}),b=e.isInternal?void 0:t;return E.jsx(ht,{id:b,path:u,labelX:y,labelY:S,label:f,labelStyle:d,labelShowBg:g,labelBgStyle:l,labelBgPadding:c,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:w,interactionWidth:v})})}const uc=cs({isInternal:!1}),ls=cs({isInternal:!0});uc.displayName="BezierEdge";ls.displayName="BezierEdgeInternal";const Wn={default:ls,straight:as,step:rs,smoothstep:os,simplebezier:es},Yn={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},fc=(e,t,n)=>n===B.Left?e-t:n===B.Right?e+t:e,gc=(e,t,n)=>n===B.Top?e-t:n===B.Bottom?e+t:e,Xn="react-flow__edgeupdater";function Gn({position:e,centerX:t,centerY:n,radius:o=10,onMouseDown:s,onMouseEnter:r,onMouseOut:i,type:a}){return E.jsx("circle",{onMouseDown:s,onMouseEnter:r,onMouseOut:i,className:re([Xn,`${Xn}-${a}`]),cx:fc(t,o,e),cy:gc(n,o,e),r:o,stroke:"transparent",fill:"transparent"})}function hc({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:o,sourceY:s,targetX:r,targetY:i,sourcePosition:a,targetPosition:f,onReconnect:d,onReconnectStart:g,onReconnectEnd:l,setReconnecting:c,setUpdateHover:h}){const m=ne(),p=(y,S)=>{if(y.button!==0)return;const{autoPanOnConnect:b,domNode:N,isValidConnection:M,connectionMode:I,connectionRadius:z,lib:P,onConnectStart:k,onConnectEnd:$,cancelConnection:_,nodeLookup:H,rfId:L,panBy:T,updateConnection:D}=m.getState(),A=S.type==="target",O=(Z,W)=>{c(!1),l?.(Z,n,S.type,W)},V=Z=>d?.(n,Z),R=(Z,W)=>{c(!0),g?.(y,n,S.type),k?.(Z,W)};Rt.onPointerDown(y.nativeEvent,{autoPanOnConnect:b,connectionMode:I,connectionRadius:z,domNode:N,handleId:S.id,nodeId:S.nodeId,nodeLookup:H,isTarget:A,edgeUpdaterType:S.type,lib:P,flowId:L,cancelConnection:_,panBy:T,isValidConnection:M,onConnect:V,onConnectStart:R,onConnectEnd:$,onReconnectEnd:O,updateConnection:D,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold,handleDomNode:y.currentTarget})},w=y=>p(y,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),x=y=>p(y,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),v=()=>h(!0),u=()=>h(!1);return E.jsxs(E.Fragment,{children:[(e===!0||e==="source")&&E.jsx(Gn,{position:a,centerX:o,centerY:s,radius:t,onMouseDown:w,onMouseEnter:v,onMouseOut:u,type:"source"}),(e===!0||e==="target")&&E.jsx(Gn,{position:f,centerX:r,centerY:i,radius:t,onMouseDown:x,onMouseEnter:v,onMouseOut:u,type:"target"})]})}function pc({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:o,onClick:s,onDoubleClick:r,onContextMenu:i,onMouseEnter:a,onMouseMove:f,onMouseLeave:d,reconnectRadius:g,onReconnect:l,onReconnectStart:c,onReconnectEnd:h,rfId:m,edgeTypes:p,noPanClassName:w,onError:x,disableKeyboardA11y:v}){let u=J(Y=>Y.edgeLookup.get(e));const y=J(Y=>Y.defaultEdgeOptions);u=y?{...y,...u}:u;let S=u.type||"default",b=p?.[S]||Wn[S];b===void 0&&(x?.("011",le.error011(S)),S="default",b=p?.default||Wn.default);const N=!!(u.focusable||t&&typeof u.focusable>"u"),M=typeof l<"u"&&(u.reconnectable||n&&typeof u.reconnectable>"u"),I=!!(u.selectable||o&&typeof u.selectable>"u"),z=C.useRef(null),[P,k]=C.useState(!1),[$,_]=C.useState(!1),H=ne(),{zIndex:L,sourceX:T,sourceY:D,targetX:A,targetY:O,sourcePosition:V,targetPosition:R}=J(C.useCallback(Y=>{const G=Y.nodeLookup.get(u.source),Q=Y.nodeLookup.get(u.target);if(!G||!Q)return{zIndex:u.zIndex,...Yn};const te=ii({id:e,sourceNode:G,targetNode:Q,sourceHandle:u.sourceHandle||null,targetHandle:u.targetHandle||null,connectionMode:Y.connectionMode,onError:x});return{zIndex:Qr({selected:u.selected,zIndex:u.zIndex,sourceNode:G,targetNode:Q,elevateOnSelect:Y.elevateEdgesOnSelect}),...te||Yn}},[u.source,u.target,u.sourceHandle,u.targetHandle,u.selected,u.zIndex]),se),Z=C.useMemo(()=>u.markerStart?`url('#${_t(u.markerStart,m)}')`:void 0,[u.markerStart,m]),W=C.useMemo(()=>u.markerEnd?`url('#${_t(u.markerEnd,m)}')`:void 0,[u.markerEnd,m]);if(u.hidden||T===null||D===null||A===null||O===null)return null;const U=Y=>{const{addSelectedEdges:G,unselectNodesAndEdges:Q,multiSelectionActive:te}=H.getState();I&&(H.setState({nodesSelectionActive:!1}),u.selected&&te?(Q({nodes:[],edges:[u]}),z.current?.blur()):G([e])),s&&s(Y,u)},ee=r?Y=>{r(Y,{...u})}:void 0,X=i?Y=>{i(Y,{...u})}:void 0,j=a?Y=>{a(Y,{...u})}:void 0,F=f?Y=>{f(Y,{...u})}:void 0,K=d?Y=>{d(Y,{...u})}:void 0,q=Y=>{if(!v&&ro.includes(Y.key)&&I){const{unselectNodesAndEdges:G,addSelectedEdges:Q}=H.getState();Y.key==="Escape"?(z.current?.blur(),G({edges:[u]})):Q([e])}};return E.jsx("svg",{style:{zIndex:L},children:E.jsxs("g",{className:re(["react-flow__edge",`react-flow__edge-${S}`,u.className,w,{selected:u.selected,animated:u.animated,inactive:!I&&!s,updating:P,selectable:I}]),onClick:U,onDoubleClick:ee,onContextMenu:X,onMouseEnter:j,onMouseMove:F,onMouseLeave:K,onKeyDown:N?q:void 0,tabIndex:N?0:void 0,role:u.ariaRole??(N?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":u.ariaLabel===null?void 0:u.ariaLabel||`Edge from ${u.source} to ${u.target}`,"aria-describedby":N?`${jo}-${m}`:void 0,ref:z,...u.domAttributes,children:[!$&&E.jsx(b,{id:e,source:u.source,target:u.target,type:u.type,selected:u.selected,animated:u.animated,selectable:I,deletable:u.deletable??!0,label:u.label,labelStyle:u.labelStyle,labelShowBg:u.labelShowBg,labelBgStyle:u.labelBgStyle,labelBgPadding:u.labelBgPadding,labelBgBorderRadius:u.labelBgBorderRadius,sourceX:T,sourceY:D,targetX:A,targetY:O,sourcePosition:V,targetPosition:R,data:u.data,style:u.style,sourceHandleId:u.sourceHandle,targetHandleId:u.targetHandle,markerStart:Z,markerEnd:W,pathOptions:"pathOptions"in u?u.pathOptions:void 0,interactionWidth:u.interactionWidth}),M&&E.jsx(hc,{edge:u,isReconnectable:M,reconnectRadius:g,onReconnect:l,onReconnectStart:c,onReconnectEnd:h,sourceX:T,sourceY:D,targetX:A,targetY:O,sourcePosition:V,targetPosition:R,setUpdateHover:k,setReconnecting:_})]})})}var mc=C.memo(pc);const yc=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function ds({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:o,noPanClassName:s,onReconnect:r,onEdgeContextMenu:i,onEdgeMouseEnter:a,onEdgeMouseMove:f,onEdgeMouseLeave:d,onEdgeClick:g,reconnectRadius:l,onEdgeDoubleClick:c,onReconnectStart:h,onReconnectEnd:m,disableKeyboardA11y:p}){const{edgesFocusable:w,edgesReconnectable:x,elementsSelectable:v,onError:u}=J(yc,se),y=tc(t);return E.jsxs("div",{className:"react-flow__edges",children:[E.jsx(ic,{defaultColor:e,rfId:n}),y.map(S=>E.jsx(mc,{id:S,edgesFocusable:w,edgesReconnectable:x,elementsSelectable:v,noPanClassName:s,onReconnect:r,onContextMenu:i,onMouseEnter:a,onMouseMove:f,onMouseLeave:d,onClick:g,reconnectRadius:l,onDoubleClick:c,onReconnectStart:h,onReconnectEnd:m,rfId:n,onError:u,edgeTypes:o,disableKeyboardA11y:p},S))]})}ds.displayName="EdgeRenderer";const xc=C.memo(ds),wc=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function bc({children:e}){const t=J(wc);return E.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Ec(e){const t=qt(),n=C.useRef(!1);C.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const Sc=e=>e.panZoom?.syncViewport;function vc(e){const t=J(Sc),n=ne();return C.useEffect(()=>{e&&(t?.(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Nc(e){return e.connection.inProgress?{...e.connection,to:Ge(e.connection.to,e.transform)}:{...e.connection}}function Cc(e){return Nc}function Mc(e){const t=Cc();return J(t,se)}const Ic=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Pc({containerStyle:e,style:t,type:n,component:o}){const{nodesConnectable:s,width:r,height:i,isValid:a,inProgress:f}=J(Ic,se);return!(r&&s&&f)?null:E.jsx("svg",{style:e,width:r,height:i,className:"react-flow__connectionline react-flow__container",children:E.jsx("g",{className:re(["react-flow__connection",co(a)]),children:E.jsx(us,{style:t,type:n,CustomComponent:o,isValid:a})})})}const us=({style:e,type:t=pe.Bezier,CustomComponent:n,isValid:o})=>{const{inProgress:s,from:r,fromNode:i,fromHandle:a,fromPosition:f,to:d,toNode:g,toHandle:l,toPosition:c}=Mc();if(!s)return;if(n)return E.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:a,fromX:r.x,fromY:r.y,toX:d.x,toY:d.y,fromPosition:f,toPosition:c,connectionStatus:co(o),toNode:g,toHandle:l});let h="";const m={sourceX:r.x,sourceY:r.y,sourcePosition:f,targetX:d.x,targetY:d.y,targetPosition:c};switch(t){case pe.Bezier:[h]=Eo(m);break;case pe.SimpleBezier:[h]=Qo(m);break;case pe.Step:[h]=Tt({...m,borderRadius:0});break;case pe.SmoothStep:[h]=Tt(m);break;default:[h]=vo(m)}return E.jsx("path",{d:h,fill:"none",className:"react-flow__connection-path",style:e})};us.displayName="ConnectionLine";const kc={};function Un(e=kc){C.useRef(e),ne(),C.useEffect(()=>{},[e])}function Dc(){ne(),C.useRef(!1),C.useEffect(()=>{},[])}function fs({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:o,onEdgeClick:s,onNodeDoubleClick:r,onEdgeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:f,onNodeMouseLeave:d,onNodeContextMenu:g,onSelectionContextMenu:l,onSelectionStart:c,onSelectionEnd:h,connectionLineType:m,connectionLineStyle:p,connectionLineComponent:w,connectionLineContainerStyle:x,selectionKeyCode:v,selectionOnDrag:u,selectionMode:y,multiSelectionKeyCode:S,panActivationKeyCode:b,zoomActivationKeyCode:N,deleteKeyCode:M,onlyRenderVisibleElements:I,elementsSelectable:z,defaultViewport:P,translateExtent:k,minZoom:$,maxZoom:_,preventScrolling:H,defaultMarkerColor:L,zoomOnScroll:T,zoomOnPinch:D,panOnScroll:A,panOnScrollSpeed:O,panOnScrollMode:V,zoomOnDoubleClick:R,panOnDrag:Z,onPaneClick:W,onPaneMouseEnter:U,onPaneMouseMove:ee,onPaneMouseLeave:X,onPaneScroll:j,onPaneContextMenu:F,paneClickDistance:K,nodeClickDistance:q,onEdgeContextMenu:Y,onEdgeMouseEnter:G,onEdgeMouseMove:Q,onEdgeMouseLeave:te,reconnectRadius:oe,onReconnect:ie,onReconnectStart:de,onReconnectEnd:ye,noDragClassName:Ue,noWheelClassName:qe,noPanClassName:$e,disableKeyboardA11y:Te,nodeExtent:pt,rfId:Ke,viewport:Ee,onViewportChange:_e}){return Un(e),Un(t),Dc(),Ec(n),vc(Ee),E.jsx(Wa,{onPaneClick:W,onPaneMouseEnter:U,onPaneMouseMove:ee,onPaneMouseLeave:X,onPaneContextMenu:F,onPaneScroll:j,paneClickDistance:K,deleteKeyCode:M,selectionKeyCode:v,selectionOnDrag:u,selectionMode:y,onSelectionStart:c,onSelectionEnd:h,multiSelectionKeyCode:S,panActivationKeyCode:b,zoomActivationKeyCode:N,elementsSelectable:z,zoomOnScroll:T,zoomOnPinch:D,zoomOnDoubleClick:R,panOnScroll:A,panOnScrollSpeed:O,panOnScrollMode:V,panOnDrag:Z,defaultViewport:P,translateExtent:k,minZoom:$,maxZoom:_,onSelectionContextMenu:l,preventScrolling:H,noDragClassName:Ue,noWheelClassName:qe,noPanClassName:$e,disableKeyboardA11y:Te,onViewportChange:_e,isControlledViewport:!!Ee,children:E.jsxs(bc,{children:[E.jsx(xc,{edgeTypes:t,onEdgeClick:s,onEdgeDoubleClick:i,onReconnect:ie,onReconnectStart:de,onReconnectEnd:ye,onlyRenderVisibleElements:I,onEdgeContextMenu:Y,onEdgeMouseEnter:G,onEdgeMouseMove:Q,onEdgeMouseLeave:te,reconnectRadius:oe,defaultMarkerColor:L,noPanClassName:$e,disableKeyboardA11y:Te,rfId:Ke}),E.jsx(Pc,{style:p,type:m,component:w,containerStyle:x}),E.jsx("div",{className:"react-flow__edgelabel-renderer"}),E.jsx(ec,{nodeTypes:e,onNodeClick:o,onNodeDoubleClick:r,onNodeMouseEnter:a,onNodeMouseMove:f,onNodeMouseLeave:d,onNodeContextMenu:g,nodeClickDistance:q,onlyRenderVisibleElements:I,noPanClassName:$e,noDragClassName:Ue,disableKeyboardA11y:Te,nodeExtent:pt,rfId:Ke}),E.jsx("div",{className:"react-flow__viewport-portal"})]})})}fs.displayName="GraphView";const Ac=C.memo(fs),qn=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:s,height:r,fitView:i,fitViewOptions:a,minZoom:f=.5,maxZoom:d=2,nodeOrigin:g,nodeExtent:l}={})=>{const c=new Map,h=new Map,m=new Map,p=new Map,w=o??t??[],x=n??e??[],v=g??[0,0],u=l??ze;Mo(m,p,w);const y=Lt(x,c,h,{nodeOrigin:v,nodeExtent:u,elevateNodesOnSelect:!1});let S=[0,0,1];if(i&&s&&r){const b=Ye(c,{filter:z=>!!((z.width||z.initialWidth)&&(z.height||z.initialHeight))}),{x:N,y:M,zoom:I}=Zt(b,s,r,f,d,a?.padding??.1);S=[N,M,I]}return{rfId:"1",width:s??0,height:r??0,transform:S,nodes:x,nodesInitialized:y,nodeLookup:c,parentLookup:h,edges:w,edgeLookup:p,connectionLookup:m,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:o!==void 0,panZoom:null,minZoom:f,maxZoom:d,translateExtent:ze,nodeExtent:u,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Pe.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:v,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:a,fitViewResolver:null,connection:{...ao},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Yr,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:io}},Hc=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:s,height:r,fitView:i,fitViewOptions:a,minZoom:f,maxZoom:d,nodeOrigin:g,nodeExtent:l})=>qi((c,h)=>{async function m(){const{nodeLookup:p,panZoom:w,fitViewOptions:x,fitViewResolver:v,width:u,height:y,minZoom:S,maxZoom:b}=h();w&&(await Zr({nodes:p,width:u,height:y,panZoom:w,minZoom:S,maxZoom:b},x),v?.resolve(!0),c({fitViewResolver:null}))}return{...qn({nodes:e,edges:t,width:s,height:r,fitView:i,fitViewOptions:a,minZoom:f,maxZoom:d,nodeOrigin:g,nodeExtent:l,defaultNodes:n,defaultEdges:o}),setNodes:p=>{const{nodeLookup:w,parentLookup:x,nodeOrigin:v,elevateNodesOnSelect:u,fitViewQueued:y}=h(),S=Lt(p,w,x,{nodeOrigin:v,nodeExtent:l,elevateNodesOnSelect:u,checkEquality:!0});y&&S?(m(),c({nodes:p,nodesInitialized:S,fitViewQueued:!1,fitViewOptions:void 0})):c({nodes:p,nodesInitialized:S})},setEdges:p=>{const{connectionLookup:w,edgeLookup:x}=h();Mo(w,x,p),c({edges:p})},setDefaultNodesAndEdges:(p,w)=>{if(p){const{setNodes:x}=h();x(p),c({hasDefaultNodes:!0})}if(w){const{setEdges:x}=h();x(w),c({hasDefaultEdges:!0})}},updateNodeInternals:p=>{const{triggerNodeChanges:w,nodeLookup:x,parentLookup:v,domNode:u,nodeOrigin:y,nodeExtent:S,debug:b,fitViewQueued:N}=h(),{changes:M,updatedInternals:I}=hi(p,x,v,u,y,S);I&&(di(x,v,{nodeOrigin:y,nodeExtent:S}),N?(m(),c({fitViewQueued:!1,fitViewOptions:void 0})):c({}),M?.length>0&&(b&&console.log("React Flow: trigger node changes",M),w?.(M)))},updateNodePositions:(p,w=!1)=>{const x=[],v=[],{nodeLookup:u,triggerNodeChanges:y}=h();for(const[S,b]of p){const N=u.get(S),M=!!(N?.expandParent&&N?.parentId&&b?.position),I={id:S,type:"position",position:M?{x:Math.max(0,b.position.x),y:Math.max(0,b.position.y)}:b.position,dragging:w};M&&N.parentId&&x.push({id:S,parentId:N.parentId,rect:{...b.internals.positionAbsolute,width:b.measured.width??0,height:b.measured.height??0}}),v.push(I)}if(x.length>0){const{parentLookup:S,nodeOrigin:b}=h(),N=Ut(x,u,S,b);v.push(...N)}y(v)},triggerNodeChanges:p=>{const{onNodesChange:w,setNodes:x,nodes:v,hasDefaultNodes:u,debug:y}=h();if(p?.length){if(u){const S=Oo(p,v);x(S)}y&&console.log("React Flow: trigger node changes",p),w?.(p)}},triggerEdgeChanges:p=>{const{onEdgesChange:w,setEdges:x,edges:v,hasDefaultEdges:u,debug:y}=h();if(p?.length){if(u){const S=Bo(p,v);x(S)}y&&console.log("React Flow: trigger edge changes",p),w?.(p)}},addSelectedNodes:p=>{const{multiSelectionActive:w,edgeLookup:x,nodeLookup:v,triggerNodeChanges:u,triggerEdgeChanges:y}=h();if(w){const S=p.map(b=>xe(b,!0));u(S);return}u(Me(v,new Set([...p]),!0)),y(Me(x))},addSelectedEdges:p=>{const{multiSelectionActive:w,edgeLookup:x,nodeLookup:v,triggerNodeChanges:u,triggerEdgeChanges:y}=h();if(w){const S=p.map(b=>xe(b,!0));y(S);return}y(Me(x,new Set([...p]))),u(Me(v,new Set,!0))},unselectNodesAndEdges:({nodes:p,edges:w}={})=>{const{edges:x,nodes:v,nodeLookup:u,triggerNodeChanges:y,triggerEdgeChanges:S}=h(),b=p||v,N=w||x,M=b.map(z=>{const P=u.get(z.id);return P&&(P.selected=!1),xe(z.id,!1)}),I=N.map(z=>xe(z.id,!1));y(M),S(I)},setMinZoom:p=>{const{panZoom:w,maxZoom:x}=h();w?.setScaleExtent([p,x]),c({minZoom:p})},setMaxZoom:p=>{const{panZoom:w,minZoom:x}=h();w?.setScaleExtent([x,p]),c({maxZoom:p})},setTranslateExtent:p=>{h().panZoom?.setTranslateExtent(p),c({translateExtent:p})},resetSelectedElements:()=>{const{edges:p,nodes:w,triggerNodeChanges:x,triggerEdgeChanges:v,elementsSelectable:u}=h();if(!u)return;const y=w.reduce((b,N)=>N.selected?[...b,xe(N.id,!1)]:b,[]),S=p.reduce((b,N)=>N.selected?[...b,xe(N.id,!1)]:b,[]);x(y),v(S)},setNodeExtent:p=>{const{nodes:w,nodeLookup:x,parentLookup:v,nodeOrigin:u,elevateNodesOnSelect:y,nodeExtent:S}=h();p[0][0]===S[0][0]&&p[0][1]===S[0][1]&&p[1][0]===S[1][0]&&p[1][1]===S[1][1]||(Lt(w,x,v,{nodeOrigin:u,nodeExtent:p,elevateNodesOnSelect:y,checkEquality:!1}),c({nodeExtent:p}))},panBy:p=>{const{transform:w,width:x,height:v,panZoom:u,translateExtent:y}=h();return pi({delta:p,panZoom:u,transform:w,translateExtent:y,width:x,height:v})},setCenter:async(p,w,x)=>{const{width:v,height:u,maxZoom:y,panZoom:S}=h();if(!S)return Promise.resolve(!1);const b=typeof x?.zoom<"u"?x.zoom:y;return await S.setViewport({x:v/2-p*b,y:u/2-w*b,zoom:b},{duration:x?.duration,ease:x?.ease,interpolate:x?.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{c({connection:{...ao}})},updateConnection:p=>{c({connection:p})},reset:()=>c({...qn()})}},Object.is);function $c({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:o,initialWidth:s,initialHeight:r,initialMinZoom:i,initialMaxZoom:a,initialFitViewOptions:f,fitView:d,nodeOrigin:g,nodeExtent:l,children:c}){const[h]=C.useState(()=>Hc({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:s,height:r,fitView:d,minZoom:i,maxZoom:a,fitViewOptions:f,nodeOrigin:g,nodeExtent:l}));return E.jsx(Ki,{value:h,children:E.jsx(ba,{children:c})})}function Tc({children:e,nodes:t,edges:n,defaultNodes:o,defaultEdges:s,width:r,height:i,fitView:a,fitViewOptions:f,minZoom:d,maxZoom:g,nodeOrigin:l,nodeExtent:c}){return C.useContext(ut)?E.jsx(E.Fragment,{children:e}):E.jsx($c,{initialNodes:t,initialEdges:n,defaultNodes:o,defaultEdges:s,initialWidth:r,initialHeight:i,fitView:a,initialFitViewOptions:f,initialMinZoom:d,initialMaxZoom:g,nodeOrigin:l,nodeExtent:c,children:e})}const _c={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Lc({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,className:s,nodeTypes:r,edgeTypes:i,onNodeClick:a,onEdgeClick:f,onInit:d,onMove:g,onMoveStart:l,onMoveEnd:c,onConnect:h,onConnectStart:m,onConnectEnd:p,onClickConnectStart:w,onClickConnectEnd:x,onNodeMouseEnter:v,onNodeMouseMove:u,onNodeMouseLeave:y,onNodeContextMenu:S,onNodeDoubleClick:b,onNodeDragStart:N,onNodeDrag:M,onNodeDragStop:I,onNodesDelete:z,onEdgesDelete:P,onDelete:k,onSelectionChange:$,onSelectionDragStart:_,onSelectionDrag:H,onSelectionDragStop:L,onSelectionContextMenu:T,onSelectionStart:D,onSelectionEnd:A,onBeforeDelete:O,connectionMode:V,connectionLineType:R=pe.Bezier,connectionLineStyle:Z,connectionLineComponent:W,connectionLineContainerStyle:U,deleteKeyCode:ee="Backspace",selectionKeyCode:X="Shift",selectionOnDrag:j=!1,selectionMode:F=Ve.Full,panActivationKeyCode:K="Space",multiSelectionKeyCode:q=Be()?"Meta":"Control",zoomActivationKeyCode:Y=Be()?"Meta":"Control",snapToGrid:G,snapGrid:Q,onlyRenderVisibleElements:te=!1,selectNodesOnDrag:oe,nodesDraggable:ie,autoPanOnNodeFocus:de,nodesConnectable:ye,nodesFocusable:Ue,nodeOrigin:qe=zo,edgesFocusable:$e,edgesReconnectable:Te,elementsSelectable:pt=!0,defaultViewport:Ke=da,minZoom:Ee=.5,maxZoom:_e=2,translateExtent:Qt=ze,preventScrolling:Ss=!0,nodeExtent:mt,defaultMarkerColor:vs="#b1b1b7",zoomOnScroll:Ns=!0,zoomOnPinch:Cs=!0,panOnScroll:Ms=!1,panOnScrollSpeed:Is=.5,panOnScrollMode:Ps=we.Free,zoomOnDoubleClick:ks=!0,panOnDrag:Ds=!0,onPaneClick:As,onPaneMouseEnter:Hs,onPaneMouseMove:$s,onPaneMouseLeave:Ts,onPaneScroll:_s,onPaneContextMenu:Ls,paneClickDistance:Rs=0,nodeClickDistance:js=0,children:zs,onReconnect:Vs,onReconnectStart:Os,onReconnectEnd:Bs,onEdgeContextMenu:Fs,onEdgeDoubleClick:Zs,onEdgeMouseEnter:Ws,onEdgeMouseMove:Ys,onEdgeMouseLeave:Xs,reconnectRadius:Gs=10,onNodesChange:Us,onEdgesChange:qs,noDragClassName:Ks="nodrag",noWheelClassName:Qs="nowheel",noPanClassName:Jt="nopan",fitView:en,fitViewOptions:tn,connectOnClick:Js,attributionPosition:er,proOptions:tr,defaultEdgeOptions:nr,elevateNodesOnSelect:or,elevateEdgesOnSelect:sr,disableKeyboardA11y:nn=!1,autoPanOnConnect:rr,autoPanOnNodeDrag:ir,autoPanSpeed:ar,connectionRadius:cr,isValidConnection:lr,onError:dr,style:ur,id:on,nodeDragThreshold:fr,connectionDragThreshold:gr,viewport:hr,onViewportChange:pr,width:mr,height:yr,colorMode:xr="light",debug:wr,onScroll:sn,ariaLabelConfig:br,...Er},Sr){const yt=on||"1",vr=ha(xr),Nr=C.useCallback(rn=>{rn.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),sn?.(rn)},[sn]);return E.jsx("div",{"data-testid":"rf__wrapper",...Er,onScroll:Nr,style:{...ur,..._c},ref:Sr,className:re(["react-flow",s,vr]),id:on,role:"application",children:E.jsxs(Tc,{nodes:e,edges:t,width:mr,height:yr,fitView:en,fitViewOptions:tn,minZoom:Ee,maxZoom:_e,nodeOrigin:qe,nodeExtent:mt,children:[E.jsx(Ac,{onInit:d,onNodeClick:a,onEdgeClick:f,onNodeMouseEnter:v,onNodeMouseMove:u,onNodeMouseLeave:y,onNodeContextMenu:S,onNodeDoubleClick:b,nodeTypes:r,edgeTypes:i,connectionLineType:R,connectionLineStyle:Z,connectionLineComponent:W,connectionLineContainerStyle:U,selectionKeyCode:X,selectionOnDrag:j,selectionMode:F,deleteKeyCode:ee,multiSelectionKeyCode:q,panActivationKeyCode:K,zoomActivationKeyCode:Y,onlyRenderVisibleElements:te,defaultViewport:Ke,translateExtent:Qt,minZoom:Ee,maxZoom:_e,preventScrolling:Ss,zoomOnScroll:Ns,zoomOnPinch:Cs,zoomOnDoubleClick:ks,panOnScroll:Ms,panOnScrollSpeed:Is,panOnScrollMode:Ps,panOnDrag:Ds,onPaneClick:As,onPaneMouseEnter:Hs,onPaneMouseMove:$s,onPaneMouseLeave:Ts,onPaneScroll:_s,onPaneContextMenu:Ls,paneClickDistance:Rs,nodeClickDistance:js,onSelectionContextMenu:T,onSelectionStart:D,onSelectionEnd:A,onReconnect:Vs,onReconnectStart:Os,onReconnectEnd:Bs,onEdgeContextMenu:Fs,onEdgeDoubleClick:Zs,onEdgeMouseEnter:Ws,onEdgeMouseMove:Ys,onEdgeMouseLeave:Xs,reconnectRadius:Gs,defaultMarkerColor:vs,noDragClassName:Ks,noWheelClassName:Qs,noPanClassName:Jt,rfId:yt,disableKeyboardA11y:nn,nodeExtent:mt,viewport:hr,onViewportChange:pr}),E.jsx(ga,{nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:h,onConnectStart:m,onConnectEnd:p,onClickConnectStart:w,onClickConnectEnd:x,nodesDraggable:ie,autoPanOnNodeFocus:de,nodesConnectable:ye,nodesFocusable:Ue,edgesFocusable:$e,edgesReconnectable:Te,elementsSelectable:pt,elevateNodesOnSelect:or,elevateEdgesOnSelect:sr,minZoom:Ee,maxZoom:_e,nodeExtent:mt,onNodesChange:Us,onEdgesChange:qs,snapToGrid:G,snapGrid:Q,connectionMode:V,translateExtent:Qt,connectOnClick:Js,defaultEdgeOptions:nr,fitView:en,fitViewOptions:tn,onNodesDelete:z,onEdgesDelete:P,onDelete:k,onNodeDragStart:N,onNodeDrag:M,onNodeDragStop:I,onSelectionDrag:H,onSelectionDragStart:_,onSelectionDragStop:L,onMove:g,onMoveStart:l,onMoveEnd:c,noPanClassName:Jt,nodeOrigin:qe,rfId:yt,autoPanOnConnect:rr,autoPanOnNodeDrag:ir,autoPanSpeed:ar,onError:dr,connectionRadius:cr,isValidConnection:lr,selectNodesOnDrag:oe,nodeDragThreshold:fr,connectionDragThreshold:gr,onBeforeDelete:O,debug:wr,ariaLabelConfig:br}),E.jsx(la,{onSelectionChange:$}),zs,E.jsx(sa,{proOptions:tr,position:er}),E.jsx(oa,{rfId:yt,disableKeyboardA11y:nn})]})})}var Rc=Fo(Lc);function jc(e){const[t,n]=C.useState(e),o=C.useCallback(s=>n(r=>Oo(s,r)),[]);return[t,n,o]}function zc(e){const[t,n]=C.useState(e),o=C.useCallback(s=>n(r=>Bo(s,r)),[]);return[t,n,o]}function Vc({dimensions:e,lineWidth:t,variant:n,className:o}){return E.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:re(["react-flow__background-pattern",n,o])})}function Oc({radius:e,className:t}){return E.jsx("circle",{cx:e,cy:e,r:e,className:re(["react-flow__background-pattern","dots",t])})}var ue;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(ue||(ue={}));const Bc={[ue.Dots]:1,[ue.Lines]:1,[ue.Cross]:6},Fc=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function gs({id:e,variant:t=ue.Dots,gap:n=20,size:o,lineWidth:s=1,offset:r=0,color:i,bgColor:a,style:f,className:d,patternClassName:g}){const l=C.useRef(null),{transform:c,patternId:h}=J(Fc,se),m=o||Bc[t],p=t===ue.Dots,w=t===ue.Cross,x=Array.isArray(n)?n:[n,n],v=[x[0]*c[2]||1,x[1]*c[2]||1],u=m*c[2],y=Array.isArray(r)?r:[r,r],S=w?[u,u]:v,b=[y[0]*c[2]||1+S[0]/2,y[1]*c[2]||1+S[1]/2],N=`${h}${e||""}`;return E.jsxs("svg",{className:re(["react-flow__background",d]),style:{...f,...gt,"--xy-background-color-props":a,"--xy-background-pattern-color-props":i},ref:l,"data-testid":"rf__background",children:[E.jsx("pattern",{id:N,x:c[0]%v[0],y:c[1]%v[1],width:v[0],height:v[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${b[0]},-${b[1]})`,children:p?E.jsx(Oc,{radius:u/2,className:g}):E.jsx(Vc,{dimensions:S,lineWidth:s,variant:t,className:g})}),E.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${N})`})]})}gs.displayName="Background";const Zc=C.memo(gs);function Wc(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:E.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Yc(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:E.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Xc(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:E.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Gc(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:E.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Uc(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:E.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Le({children:e,className:t,...n}){return E.jsx("button",{type:"button",className:re(["react-flow__controls-button",t]),...n,children:e})}const qc=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function hs({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:s,onZoomIn:r,onZoomOut:i,onFitView:a,onInteractiveChange:f,className:d,children:g,position:l="bottom-left",orientation:c="vertical","aria-label":h}){const m=ne(),{isInteractive:p,minZoomReached:w,maxZoomReached:x,ariaLabelConfig:v}=J(qc,se),{zoomIn:u,zoomOut:y,fitView:S}=qt(),b=()=>{u(),r?.()},N=()=>{y(),i?.()},M=()=>{S(s),a?.()},I=()=>{m.setState({nodesDraggable:!p,nodesConnectable:!p,elementsSelectable:!p}),f?.(!p)},z=c==="horizontal"?"horizontal":"vertical";return E.jsxs(ft,{className:re(["react-flow__controls",z,d]),position:l,style:e,"data-testid":"rf__controls","aria-label":h??v["controls.ariaLabel"],children:[t&&E.jsxs(E.Fragment,{children:[E.jsx(Le,{onClick:b,className:"react-flow__controls-zoomin",title:v["controls.zoomIn.ariaLabel"],"aria-label":v["controls.zoomIn.ariaLabel"],disabled:x,children:E.jsx(Wc,{})}),E.jsx(Le,{onClick:N,className:"react-flow__controls-zoomout",title:v["controls.zoomOut.ariaLabel"],"aria-label":v["controls.zoomOut.ariaLabel"],disabled:w,children:E.jsx(Yc,{})})]}),n&&E.jsx(Le,{className:"react-flow__controls-fitview",onClick:M,title:v["controls.fitView.ariaLabel"],"aria-label":v["controls.fitView.ariaLabel"],children:E.jsx(Xc,{})}),o&&E.jsx(Le,{className:"react-flow__controls-interactive",onClick:I,title:v["controls.interactive.ariaLabel"],"aria-label":v["controls.interactive.ariaLabel"],children:p?E.jsx(Uc,{}):E.jsx(Gc,{})}),g]})}hs.displayName="Controls";const Kc=C.memo(hs);function Qc({id:e,x:t,y:n,width:o,height:s,style:r,color:i,strokeColor:a,strokeWidth:f,className:d,borderRadius:g,shapeRendering:l,selected:c,onClick:h}){const{background:m,backgroundColor:p}=r||{},w=i||m||p;return E.jsx("rect",{className:re(["react-flow__minimap-node",{selected:c},d]),x:t,y:n,rx:g,ry:g,width:o,height:s,style:{fill:w,stroke:a,strokeWidth:f},shapeRendering:l,onClick:h?x=>h(x,e):void 0})}const Jc=C.memo(Qc),el=e=>e.nodes.map(t=>t.id),Dt=e=>e instanceof Function?e:()=>e;function tl({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:o=5,nodeStrokeWidth:s,nodeComponent:r=Jc,onClick:i}){const a=J(el,se),f=Dt(t),d=Dt(e),g=Dt(n),l=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return E.jsx(E.Fragment,{children:a.map(c=>E.jsx(ol,{id:c,nodeColorFunc:f,nodeStrokeColorFunc:d,nodeClassNameFunc:g,nodeBorderRadius:o,nodeStrokeWidth:s,NodeComponent:r,onClick:i,shapeRendering:l},c))})}function nl({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:o,nodeBorderRadius:s,nodeStrokeWidth:r,shapeRendering:i,NodeComponent:a,onClick:f}){const{node:d,x:g,y:l,width:c,height:h}=J(m=>{const{internals:p}=m.nodeLookup.get(e),w=p.userNode,{x,y:v}=p.positionAbsolute,{width:u,height:y}=fe(w);return{node:w,x,y:v,width:u,height:y}},se);return!d||d.hidden||!po(d)?null:E.jsx(a,{x:g,y:l,width:c,height:h,style:d.style,selected:!!d.selected,className:o(d),color:t(d),borderRadius:s,strokeColor:n(d),strokeWidth:r,shapeRendering:i,onClick:f,id:d.id})}const ol=C.memo(nl);var sl=C.memo(tl);const rl=200,il=150,al=e=>!e.hidden,cl=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ho(Ye(e.nodeLookup,{filter:al}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},ll="react-flow__minimap-desc";function ps({style:e,className:t,nodeStrokeColor:n,nodeColor:o,nodeClassName:s="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:a,bgColor:f,maskColor:d,maskStrokeColor:g,maskStrokeWidth:l,position:c="bottom-right",onClick:h,onNodeClick:m,pannable:p=!1,zoomable:w=!1,ariaLabel:x,inversePan:v,zoomStep:u=1,offsetScale:y=5}){const S=ne(),b=C.useRef(null),{boundingRect:N,viewBB:M,rfId:I,panZoom:z,translateExtent:P,flowWidth:k,flowHeight:$,ariaLabelConfig:_}=J(cl,se),H=e?.width??rl,L=e?.height??il,T=N.width/H,D=N.height/L,A=Math.max(T,D),O=A*H,V=A*L,R=y*A,Z=N.x-(O-N.width)/2-R,W=N.y-(V-N.height)/2-R,U=O+R*2,ee=V+R*2,X=`${ll}-${I}`,j=C.useRef(0),F=C.useRef();j.current=A,C.useEffect(()=>{if(b.current&&z)return F.current=Ni({domNode:b.current,panZoom:z,getTransform:()=>S.getState().transform,getViewScale:()=>j.current}),()=>{F.current?.destroy()}},[z]),C.useEffect(()=>{F.current?.update({translateExtent:P,width:k,height:$,inversePan:v,pannable:p,zoomStep:u,zoomable:w})},[p,w,v,u,P,k,$]);const K=h?G=>{const[Q,te]=F.current?.pointer(G)||[0,0];h(G,{x:Q,y:te})}:void 0,q=m?C.useCallback((G,Q)=>{const te=S.getState().nodeLookup.get(Q).internals.userNode;m(G,te)},[]):void 0,Y=x??_["minimap.ariaLabel"];return E.jsx(ft,{position:c,style:{...e,"--xy-minimap-background-color-props":typeof f=="string"?f:void 0,"--xy-minimap-mask-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-color-props":typeof g=="string"?g:void 0,"--xy-minimap-mask-stroke-width-props":typeof l=="number"?l*A:void 0,"--xy-minimap-node-background-color-props":typeof o=="string"?o:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:re(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:E.jsxs("svg",{width:H,height:L,viewBox:`${Z} ${W} ${U} ${ee}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":X,ref:b,onClick:K,children:[Y&&E.jsx("title",{id:X,children:Y}),E.jsx(sl,{onClick:q,nodeColor:o,nodeStrokeColor:n,nodeBorderRadius:r,nodeClassName:s,nodeStrokeWidth:i,nodeComponent:a}),E.jsx("path",{className:"react-flow__minimap-mask",d:`M${Z-R},${W-R}h${U+R*2}v${ee+R*2}h${-U-R*2}z
        M${M.x},${M.y}h${M.width}v${M.height}h${-M.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}ps.displayName="MiniMap";const dl=C.memo(ps),ul=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,fl={[He.Line]:"right",[He.Handle]:"bottom-right"};function gl({nodeId:e,position:t,variant:n=He.Handle,className:o,style:s=void 0,children:r,color:i,minWidth:a=10,minHeight:f=10,maxWidth:d=Number.MAX_VALUE,maxHeight:g=Number.MAX_VALUE,keepAspectRatio:l=!1,resizeDirection:c,autoScale:h=!0,shouldResize:m,onResizeStart:p,onResize:w,onResizeEnd:x}){const v=Xo(),u=typeof e=="string"?e:v,y=ne(),S=C.useRef(null),b=n===He.Handle,N=J(C.useCallback(ul(b&&h),[b,h]),se),M=C.useRef(null),I=t??fl[n];C.useEffect(()=>{if(!(!S.current||!u))return M.current||(M.current=ji({domNode:S.current,nodeId:u,getStoreItems:()=>{const{nodeLookup:P,transform:k,snapGrid:$,snapToGrid:_,nodeOrigin:H,domNode:L}=y.getState();return{nodeLookup:P,transform:k,snapGrid:$,snapToGrid:_,nodeOrigin:H,paneDomNode:L}},onChange:(P,k)=>{const{triggerNodeChanges:$,nodeLookup:_,parentLookup:H,nodeOrigin:L}=y.getState(),T=[],D={x:P.x,y:P.y},A=_.get(u);if(A&&A.expandParent&&A.parentId){const O=A.origin??L,V=P.width??A.measured.width??0,R=P.height??A.measured.height??0,Z={id:A.id,parentId:A.parentId,rect:{width:V,height:R,...mo({x:P.x??A.position.x,y:P.y??A.position.y},{width:V,height:R},A.parentId,_,O)}},W=Ut([Z],_,H,L);T.push(...W),D.x=P.x?Math.max(O[0]*V,P.x):void 0,D.y=P.y?Math.max(O[1]*R,P.y):void 0}if(D.x!==void 0&&D.y!==void 0){const O={id:u,type:"position",position:{...D}};T.push(O)}if(P.width!==void 0&&P.height!==void 0){const V={id:u,type:"dimensions",resizing:!0,setAttributes:c?c==="horizontal"?"width":"height":!0,dimensions:{width:P.width,height:P.height}};T.push(V)}for(const O of k){const V={...O,type:"position"};T.push(V)}$(T)},onEnd:({width:P,height:k})=>{const $={id:u,type:"dimensions",resizing:!1,dimensions:{width:P,height:k}};y.getState().triggerNodeChanges([$])}})),M.current.update({controlPosition:I,boundaries:{minWidth:a,minHeight:f,maxWidth:d,maxHeight:g},keepAspectRatio:l,resizeDirection:c,onResizeStart:p,onResize:w,onResizeEnd:x,shouldResize:m}),()=>{M.current?.destroy()}},[I,a,f,d,g,l,p,w,x,m]);const z=I.split("-");return E.jsx("div",{className:re(["react-flow__resize-control","nodrag",...z,n,o]),ref:S,style:{...s,scale:N,...i&&{[b?"backgroundColor":"borderColor"]:i}},children:r})}C.memo(gl);function ms(e,t,n,o){let s=e;for(;;){const a=t(s);if(a.length===1&&!o(s)){s=a[0];continue}break}const i=t(s).filter(a=>a!==null).map(a=>ms(a,t,n,o));return n(s,i)}function hl(e){return ms(e,t=>(t.Syntactic?.children??[]).filter(n=>n!==null),(t,n)=>{const o=structuredClone(t);return o.Syntactic?{...o,Syntactic:{...o.Syntactic,children:structuredClone(n)}}:o},t=>t.Syntactic?.prodInfo.some(n=>n.type==="terminal")??!1)}const zt=300,pl=200;function ys(e,t=0,n=null,o=1){const s=e.Syntactic?.children.filter(i=>i!==null)??[],r={ast:e,children:[],x:0,y:t*pl,mod:0,ancestor:null,change:0,shift:0,number:o,parent:n};return r.ancestor=r,r.children=s.map((i,a)=>ys(i,t+1,r,a+1)),r}function xs(e){if(e.children.length===0)nt(e)?e.x=nt(e).x+zt:e.x=0;else{let t=e.children[0];for(const s of e.children)xs(s),t=ml(s,t);xl(e);const n=(e.children[0].x+e.children[e.children.length-1].x)/2,o=nt(e);o?(e.x=o.x+zt,e.mod=e.x-n):e.x=n}}function ml(e,t){const n=nt(e);if(!n)return t;let o=e,s=e,r=n,i=bl(e),a=o.mod,f=s.mod,d=r.mod,g=i.mod;for(;Ne(r)&&ve(o);){r=Ne(r),o=ve(o),i=ve(i),s=Ne(s);const l=r.x+d-(o.x+a)+zt;l>0&&(yl(wl(r,e,t),e,l),a+=l,f+=l),d+=r.mod,a+=o.mod,g+=i.mod,f+=s.mod}return Ne(r)&&!Ne(s)&&(s.thread=Ne(r),s.mod+=d-f),ve(o)&&!ve(i)&&(i.thread=ve(o),i.mod+=a-g),t}function yl(e,t,n){const o=t.number-e.number;t.change-=n/o,t.shift+=n,e.change+=n/o,t.x+=n,t.mod+=n}function xl(e){let t=0,n=0;for(let o=e.children.length-1;o>=0;o--){const s=e.children[o];s.x+=t,s.mod+=t,n+=s.change,t+=s.shift+n}}function ws(e,t=0){e.x+=t;for(const n of e.children)ws(n,t+e.mod)}function wl(e,t,n){return t.parent.children.includes(e.ancestor)?e.ancestor:n}function bl(e){return e.parent.children[0]}function ve(e){return e.children.length>0?e.children[0]:e.thread}function Ne(e){return e.children.length>0?e.children[e.children.length-1]:e.thread}function nt(e){if(!e.parent)return null;const t=e.parent.children.indexOf(e);return t>0?e.parent.children[t-1]:null}function bs(e){return{node:e.ast,x:e.x,y:e.y,children:e.children.map(bs)}}function El(e){const t=ys(e);return xs(t),ws(t),bs(t)}function Sl(e){const t=[],n=[];let o=0;function s(r,i=null){const a=String(o++),f=r.node.Syntactic?r.node.Syntactic.name:`${r.node.Lexical.str} : ${r.node.Lexical.name}`,d=r.node.Syntactic?"syntactic":"lexical";t.push({id:a,position:{x:r.x,y:r.y},data:{label:f,ast:r.node,index:0,depth:r.y},type:d}),i!==null&&n.push({id:`e${i}-${a}`,source:i,target:a});for(const g of r.children)s(g,a);return a}return s(e),{nodes:t,edges:n}}function Es(e){const t=El(e);return Sl(t)}function Vt([e,t],n){const[o,s]=n??[-1,-1];if(e===-1||t===-1||o===-1||s===-1)return;const r=e===o&&s===t,i=e>=o&&s>=t,a=e<=o&&s<=t;return r?"exact":a?"descendants":i?"ancestors":void 0}const Kn=`w-[256px] h-fit py-4 pl-2 dark:bg-neutral-900
  data-[highlight=exact]:bg-yellow-400 data-[highlight=ancestors]:bg-yellow-50 data-[highlight=descendants]:bg-yellow-200
  data-[highlight=exact]:dark:bg-yellow-600 data-[highlight=ancestors]:dark:bg-yellow-950  data-[highlight=descendants]:dark:bg-yellow-800
  rounded-lg border-2 border-neutral-300 dark:border-neutral-700 transition-colors
  `,vl={syntactic:C.memo(({data:e})=>{const t=Re(At),{Syntactic:n}=e.ast;return E.jsxs(E.Fragment,{children:[E.jsx(me,{type:"target",position:B.Top}),E.jsxs("div",{"data-highlight":Vt(t,n?.loc),className:Kn,children:[E.jsxs("div",{className:"line-clamp-1 font-serif",children:[n?.name," :"]}),E.jsx("div",{className:"space-x-1 line-clamp-1",children:n?.prodInfo.map(({type:o,value:s})=>E.jsx("span",{"data-prod-type":o,className:"data-[prod-type=terminal]:font-mono data-[prod-type=nonterminal]:font-serif",children:s},s))})]}),E.jsx(me,{type:"source",position:B.Bottom})]})}),lexical:C.memo(({data:e})=>{const t=Re(At),{Lexical:n}=e.ast;return E.jsxs(E.Fragment,{children:[E.jsx(me,{type:"target",position:B.Top}),E.jsxs("div",{"data-highlight":Vt(t,n?.loc),className:Kn,children:[E.jsx("div",{className:"line-clamp-1 font-serif",children:n?.name}),E.jsx("div",{className:"font-mono",children:n?.str})]}),E.jsx(me,{type:"source",position:B.Bottom})]})})},Nl=Ot(e=>{const t=e(no);if(!t)return null;const{nodes:n,edges:o}=Es(t);return{nodes:n,edges:o}}),Cl=Ot(e=>{const t=e(no);if(!t)return null;const{nodes:n,edges:o}=Es(hl(t));return{nodes:n,edges:o}}),Ml=Ot(!0);function kl(){const[e,t]=Ir(Ml),n=C.useRef(null),o=Re(Cl),s=Re(Nl),r=Re(At),[i,a,f]=jc([]),[d,g,l]=zc([]);C.useEffect(()=>{e||(s?(a([...s.nodes]),g([...s.edges])):(a([]),g([])))},[e,s,a,g]),C.useEffect(()=>{e&&(o?(a([...o.nodes]),g([...o.edges])):(a([]),g([])))},[e,o,a,g]);const c=C.useMemo(()=>JSON.stringify(i.filter(m=>{const p=Vt(r,m.data.ast.Syntactic?.loc??m.data.ast.Lexical?.loc);return p==="exact"||p==="descendants"}).map(m=>m.id)),[i,r]),h=C.useCallback(()=>{const[m,p]=r;if(n.current&&m!==-1&&p!==-1){const w=JSON.parse(c);n.current.fitView({nodes:i.filter(x=>w.includes(x.id)),duration:Qn,padding:Jn})}else setTimeout(()=>{n.current?.fitView({duration:Qn,padding:Jn})})},[c,r]);return C.useEffect(()=>{setTimeout(()=>{h()},1)},[h]),E.jsx("div",{className:"size-full",children:E.jsxs(Rc,{nodes:i,edges:d,colorMode:"system",minZoom:.0625,onNodesChange:f,onEdgesChange:l,onInit:m=>{n.current=m},nodesDraggable:!1,edgesFocusable:!1,edgesReconnectable:!1,nodesConnectable:!1,elementsSelectable:!1,nodeTypes:vl,onlyRenderVisibleElements:!0,children:[E.jsx(Kc,{children:E.jsx(Le,{onClick:()=>t(m=>!m),title:e?"Expand AST":"Compress AST",children:e?E.jsx(_r,{}):E.jsx(Tr,{})})}),i.length===0&&E.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-neutral-500",children:"No AST to display."}),E.jsx(dl,{zoomable:!0,pannable:!0}),E.jsx(Zc,{variant:ue.Dots,gap:16,size:0})]})})}const Qn=500,Jn=.1;export{kl as default};
